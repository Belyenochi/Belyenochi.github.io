<!DOCTYPE html>
<html>
<head>
  <title>
    从零开始的编译原理之旅----Parser篇(四) - The Tao of Jason
  </title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="shortcut icon" href="/favicon.ico" />
  

  <link rel="stylesheet" href="/css/utils/clear.css">
  <link rel="stylesheet" href="/css/style.css">

  <link href="https://google-fonts.mirrors.sjtug.sjtu.edu.cn/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <link href="https://cdn.bootcss.com/highlight.js/9.15.6/styles/default.min.css" rel="stylesheet">
</head>

<body>
  <div class="title">
  <img class="title_img" src="/images/icon.png"/><br>
  <p id="site_title">&nbspThe Tao of Jason&nbsp</p>
</div>

  <div class="navi">
    <a id="navi_item" href="/#" class="menu-item-link">Home</a>
    <a id="navi_item" href="/tags" class="menu-item-link">Tags</a>
    <a id="navi_item" href="/about" class="menu-item-link">About</a>
    <a id="navi_item" href="/search" class="menu-item-link">Search</a>
    
        <a id="navi_item" href="/friendlink" class="menu-item-link">Friendlink</a>
    
</div>

<hr/>


  <div class="main">
    <link rel="stylesheet" href="/css/post.css">
<post>

  <div class="post_title">
    从零开始的编译原理之旅----Parser篇(四)
  </div>

  <br/><br/>

  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/xcode.min.css">
  <script src="/js/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <div id="post_content">
    <p>本篇主要阐述使用递归下降非回溯或回溯解析LL(1)文法，并比较两者优缺点</p>
<h3 id="1-目录"><a href="#1-目录" class="headerlink" title="1 目录"></a>1 目录</h3><p>本系列旨在学习各种parser思路及技巧，分为以下几个部分</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> 清晨入古寺—-论世间parser为何物</a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> 初日照高林—-初探First集，Follow集 </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> 曲径通幽处—-预测分析表的构建 </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> 禅房花木深—-实现LL(1) parser </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> 山光悦鸟性—-递归下降的两种实现 <strong>[本篇]</strong> </a></li>
<li>潭影空人心—-浅谈recursive ascent parser(SLR,LALR(1))</li>
<li>万籁此俱寂—-parser combinator（从ohm.js源码说起）</li>
<li>但余钟磬音—-反思与总结</li>
</ol>
<h3 id="2-什么是递归下降？"><a href="#2-什么是递归下降？" class="headerlink" title="2 什么是递归下降？"></a>2 什么是递归下降？</h3><p>一个递归下降语法分析程序由一组过程组成，每个非终结符有一个对应的过程。程序的执行从开始符号对应的过程开始，如果这个过程扫描了整个输入串，它就停止执行并宣布语法分析成功完成。<br>举一个直观的栗子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;cAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|a</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<font color="red">使用递归下降解析文法通俗的讲就是调用compilerS()根据函数调用是否成功（判断是否有非法字符串）且输入串是否完全匹配（是否有多余字符）来判断解析是否成功</font><br>### 3 为什么使用递归下降解析LL（1）文法<br>上一章介绍了使用显式的维护一个stack来解析LL（1）文法，这种方法不如直接使用递归隐式的维护call stack来的直观，<font color="blue">本质上两者是等价的，唯一的区别是一个使用了系统的控制流一个自己构造控制流。</font>

<h3 id="4-递归下降的预测分析（不带回溯）"><a href="#4-递归下降的预测分析（不带回溯）" class="headerlink" title="4 递归下降的预测分析（不带回溯）"></a>4 递归下降的预测分析（不带回溯）</h3><p>这种递归下降属于递归下降中一种特殊的情况，不需要回溯的前提是LL（1）文法中每个非终结符的产生式<font color="red">不存在可以合并的左公因子</font>,举个栗子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		eat(<span class="string">'s'</span>);</span><br><span class="line">		<span class="keyword">this</span>.compilerA();</span><br><span class="line">		eat(<span class="string">'d'</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.input[cursor] === <span class="string">'a'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'a'</span>);</span><br><span class="line">			eat(<span class="string">'b'</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.input[cursor] === <span class="string">'c'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'c'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码如上，可以看出并不需要回溯，但是我们来分析一下之前定义的文法，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">	Grammar:</span><br><span class="line">		S-&gt;sAd</span><br><span class="line">		A-&gt;ab|a</span><br><span class="line">*/</span><br></pre></td></tr></table></figure></p>
<p>你会发现在解析A这个终结符的时候，hmmm，它第一个字母竟然是相同的也就是说没办法通过第一个字母来区分进入哪个分支，你可能会觉得这时候看第二个不就行了吗，是行了，不过因为这里的例子简单，看第二个字母的hack不会太丑，实际上编程语言的解析比这复杂很多，如果一直写，看第二个，看第三个的代码，那么代码会异常难看（我第一次不信邪的写出来过），还有同学可能会觉得这时候手动合并左公因子就行了嘛，嗯，这确实是一种方法，实际上一种更为优雅的方式就是<strong>回溯</strong>，通过回溯进入每一个分支看看是否正确。</p>
<h3 id="5-递归下降的预测分析（带回溯）"><a href="#5-递归下降的预测分析（带回溯）" class="headerlink" title="5 递归下降的预测分析（带回溯）"></a>5 递归下降的预测分析（带回溯）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|a</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		eat(<span class="string">'s'</span>);</span><br><span class="line">		<span class="keyword">this</span>.compilerA();</span><br><span class="line">		eat(<span class="string">'d'</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="keyword">if</span>(firstOf(A) === <span class="string">'a'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'a'</span>);</span><br><span class="line">			eat(<span class="string">'b'</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(firstOf(A) === <span class="string">'c'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'c'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里又出现一个问题，假如进行回溯那么意味着要遍历所有分支，假如有n个非终结符，m个产生式，那么时间复杂度就是O（n*m），这势必会降低效率，所以会采取一些优化，比如使用动态规划缓存结果，之后在讲解ohm.js源码的时候会详述 Incremental Packrat Parsing（递归下降回溯的优化），计算机科学嘛总是要在空间和时间之间做一个trade off。</p>
<p>到底使用表驱动的非递归预测分析算法还是采用递归下降就要看需求仁者见仁智者见智了。</p>
<h3 id="6-递归下降的非回溯实现"><a href="#6-递归下降的非回溯实现" class="headerlink" title="6 递归下降的非回溯实现"></a>6 递归下降的非回溯实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">        <span class="keyword">this</span>.input  = input;</span><br><span class="line">        <span class="keyword">this</span>.cursor = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerS() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'s'</span>);</span><br><span class="line">        <span class="keyword">this</span>.compilerA();</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'d'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA() &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor] === <span class="string">'a'</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'a'</span>);</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'b'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor] === <span class="string">'c'</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'c'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.input.length !== <span class="keyword">this</span>.cursor) &#123; <span class="comment">// deal with Extra unmatched characters</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected Extra unmatched characters with <span class="subst">$&#123;<span class="keyword">this</span>.input.slice(<span class="keyword">this</span>.cursor)&#125;</span>`</span> +</span><br><span class="line">                 <span class="string">`at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span> in inputstring: <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    eat(inputChar) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputChar === <span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor]) &#123;</span><br><span class="line">            <span class="keyword">this</span>.cursor++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected match <span class="subst">$&#123;inputChar&#125;</span> with <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span> at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbds"</span>).run() === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbd"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"ssbds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabd"</span>).run()   === <span class="literal">true</span>);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-递归下降的回溯实现"><a href="#7-递归下降的回溯实现" class="headerlink" title="7 递归下降的回溯实现"></a>7 递归下降的回溯实现</h3><p>递归下降的DFS算法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">        <span class="keyword">this</span>.input  = input;</span><br><span class="line">        <span class="keyword">this</span>.cursor = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerS() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'s'</span>);</span><br><span class="line">        <span class="keyword">this</span>.compilerA();</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'d'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA() &#123;</span><br><span class="line">        <span class="keyword">let</span> save;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (save = <span class="keyword">this</span>.saveCursor(<span class="keyword">this</span>.cursor) , <span class="keyword">this</span>.compilerA1()) ||</span><br><span class="line">            (<span class="keyword">this</span>.backtrack(save) , <span class="keyword">this</span>.compilerA2());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA1() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.eat(<span class="string">'a'</span>) &amp;&amp; <span class="keyword">this</span>.eat(<span class="string">'b'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA2() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.eat(<span class="string">'c'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.input.length !== <span class="keyword">this</span>.cursor) &#123; <span class="comment">// deal with Extra unmatched characters</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected Extra unmatched characters with <span class="subst">$&#123;<span class="keyword">this</span>.input.slice(<span class="keyword">this</span>.cursor)&#125;</span>`</span> +</span><br><span class="line">                    <span class="string">`at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span> in input string: <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// help function</span></span><br><span class="line"></span><br><span class="line">    eat(inputChar) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputChar === <span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor]) &#123;</span><br><span class="line">            <span class="keyword">this</span>.cursor++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    backtrack(fn) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cursor = fn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    saveCursor(cursor) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbds"</span>).run() === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbd"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"ssbds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabd"</span>).run()   === <span class="literal">true</span>);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>

  </div>

  <br/>

  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">This post has been read：<span id="busuanzi_value_page_pv"></span>times</span>
  
  <br/><br/>


  

  <div class="copyright" >

    <a class="license-image" rel="license" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by
-nc
-sa
/4.0/80x15.png" />
    </a>

      <p>本作品采用
      <a class="license-word-hyper" rel="license" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/">
        知识共享署名
-非商业性使用
-相同方式共享
4.0 国际许可协议</a>
      进行许可。</p>
  </div>


  <div id="top">
    <a href="#">▲</a>
    <a href="#footer">▼</a>
</div>

  
  <script defer src="https://commento.pcrab.xyz/js/commento.js"></script>
<div id="commento"></div>
<noscript>Please enable JavaScript to load the comments.</noscript>


</post>

  </div>

  <foot id="footer">
  <hr class="boldline"/>
  <br>

  <p class="center font">
    
      <a href="https://github.com/pcrab">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
   <path class="icon_path" d="M427.392 853.504a61.44 61.44 0 0 1-1.450667 15.530667 92.586667 92.586667 0 0 1-10.965333 27.605333c-15.061333 25.301333-40.661333 42.154667-73.642667 42.154667-77.653333 0-108.117333-38.101333-146.261333-133.504C169.216 740.693333 157.013333 725.461333 128 725.461333v-85.333333c77.653333 0 108.117333 38.101333 146.261333 133.504 25.856 64.597333 38.058667 79.786667 67.072 79.786667 0-12.373333-0.170667-23.296-0.512-38.144-0.853333-34.816-0.938667-41.941333 0.554667-51.2 0.64-20.352 5.888-34.773333 16.384-49.066667-95.232-20.736-159.445333-63.573333-196.309333-132.992l-13.824-32.426667C134.186667 510.848 128 467.072 128 416.426667c0-58.24 17.749333-110.336 50.944-153.856-10.368-41.386667-8.96-91.989333 13.909333-149.077334l7.466667-18.688 19.2-6.101333c2.56-0.853333 5.632-1.578667 9.301333-2.133333 37.290667-5.888 90.325333 8.106667 159.701334 52.48a565.930667 565.930667 0 0 1 127.274666-14.208c38.741333 0 77.226667 3.882667 114.048 11.605333 67.456-42.24 119.04-55.509333 155.306667-49.92 3.626667 0.597333 6.741333 1.322667 9.258667 2.133333l19.285333 6.101334 7.466667 18.773333c20.010667 50.218667 23.424 96.469333 16.128 136.96C875.434667 296.32 896 352.597333 896 416.512c0 53.888-3.84 94.378667-14.933333 133.802667l-11.733334 32.170666c-30.677333 69.333333-98.304 112.64-202.538666 133.248 10.837333 15.018667 15.872 30.250667 15.872 52.394667v42.666667l-0.042667 42.666666a13.013333 13.013333 0 0 0 0.341333 2.730667L682.666667 938.794667c-36.352 0-63.36-17.706667-76.672-45.653334a88.277333 88.277333 0 0 1-8.661334-40.277333v-84.736c0-3.584-0.128-3.797333-8.832-12.501333-23.296-23.296-33.834667-40.874667-33.834666-72.832v-38.613334l38.4-3.84c114.346667-11.52 176.512-43.221333 197.12-89.6l9.6-26.325333c7.68-27.562667 10.88-61.098667 10.88-107.946667 0-49.706667-17.365333-90.837333-50.218667-123.648L742.4 274.773333l7.381333-24.448c6.528-21.717333 8.106667-47.402667 1.152-76.714666a158.634667 158.634667 0 0 0-3.584 0.938666c-22.826667 6.4-51.370667 20.053333-85.76 43.008l-15.658666 10.453334-18.304-4.522667a467.754667 467.754667 0 0 0-111.829334-13.269333c-42.709333 0-84.906667 5.418667-123.946666 16.042666l-19.029334 5.205334-16.256-11.136c-35.541333-24.32-65.109333-38.826667-88.746666-45.568a158.293333 158.293333 0 0 0-4.864-1.28c-8.234667 33.92-4.992 61.781333 3.413333 82.688l9.984 25.088-18.346667 19.797333C228.693333 332.629333 213.333333 370.986667 213.333333 416.512c0 41.685333 4.864 76.202667 13.824 102.229333l11.178667 26.453334c27.904 52.352 87.168 83.84 192.853333 95.146666l38.144 4.096v38.357334c0 32-10.538667 49.536-33.834666 72.832-8.704 8.704-8.832 8.96-8.832 12.501333l-0.725334 7.893333c-0.512 2.56-0.512 9.258667 0.170667 37.205334 0.298667 12.8 0.469333 22.997333 0.554667 33.621333a33.962667 33.962667 0 0 1 0.725333 6.656z"/>
  </svg>
 </a>

    
    
      <a href="mailto:pcrab@mailbox.org">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M513.78 602.99c-27.28 0.45-53.79-9.09-74.53-26.83l-65.96-56.64c-15.64-13.37-17.48-36.9-4.1-52.54 13.38-15.65 36.9-17.48 52.54-4.1l65.96 56.64c13.68 11.1 33.27 11.1 46.95 0L881.2 253.08l-708.02-2.61c-20.58 0-37.26-16.69-37.26-37.26s16.68-37.26 37.26-37.26H881.2c41.09-2.36 76.32 29.05 78.67 70.14a74.519 74.519 0 0 1-32.46 65.87L580.86 578.38a111.842 111.842 0 0 1-67.08 24.61z m444.57 133.4V438.28c0-20.58-16.68-37.26-37.26-37.26s-37.26 16.69-37.26 37.26V736.4c0 20.58-16.68 37.26-37.26 37.26h-521.7c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h521.7c61.72 0.01 111.78-50.05 111.78-111.79zM362.12 363.75c0-20.58-16.68-37.26-37.26-37.26h-223.6c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h223.59c20.58 0.01 37.27-16.68 37.27-37.26z m0 298.12c0-20.58-16.68-37.26-37.26-37.26h-111.8c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h111.79c20.58 0 37.27-16.69 37.27-37.26z"/>
  </svg>
</a>

    
    
      <a href="https://t.me/Pcrab">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M834.24 127.872a95.168 95.168 0 0 0-29.856 7.136h-0.128c-9.12 3.616-52.48 21.856-118.4 49.504l-236.224 99.488c-169.504 71.36-336.128 141.632-336.128 141.632l1.984-0.768s-11.488 3.776-23.488 12a64.96 64.96 0 0 0-18.752 18.144c-5.888 8.64-10.624 21.856-8.864 35.52 2.88 23.104 17.856 36.96 28.608 44.608 10.88 7.744 21.248 11.36 21.248 11.36h0.256l156.256 52.64c7.008 22.496 47.616 156 57.376 186.752 5.76 18.368 11.36 29.856 18.368 38.624 3.392 4.48 7.36 8.224 12.128 11.232a35.808 35.808 0 0 0 7.872 3.392l-1.6-0.384c0.48 0.128 0.864 0.512 1.216 0.64 1.28 0.352 2.144 0.48 3.776 0.736 24.736 7.488 44.608-7.872 44.608-7.872l1.12-0.896 92.256-84 154.624 118.624 3.52 1.504c32.224 14.144 64.864 6.272 82.112-7.616 17.376-13.984 24.128-31.872 24.128-31.872l1.12-2.88 119.488-612.128c3.392-15.104 4.256-29.248 0.512-42.976a57.824 57.824 0 0 0-24.992-33.504 59.904 59.904 0 0 0-34.144-8.64z m-3.232 65.6c-0.128 2.016 0.256 1.792-0.64 5.664v0.352l-118.368 605.76c-0.512 0.864-1.376 2.752-3.744 4.64-2.496 1.984-4.48 3.232-14.88-0.896l-189.12-144.992-114.24 104.128 24-153.28 308.992-288c12.736-11.84 8.48-14.336 8.48-14.336 0.896-14.528-19.232-4.256-19.232-4.256l-389.632 241.376-0.128-0.64-186.752-62.88v-0.128l-0.48-0.096a8.64 8.64 0 0 0 0.96-0.384l1.024-0.512 0.992-0.352s166.752-70.272 336.256-141.632c84.864-35.744 170.368-71.744 236.128-99.52 65.76-27.616 114.368-47.872 117.12-48.96 2.624-1.024 1.376-1.024 3.264-1.024z"/>
  </svg>
</a>

    
    
    
    
    
    
    
    
      <a href="/atom.xml">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M122.88 720.213333a128 128 0 0 0 0 180.906667 128 128 0 0 0 180.906667 0 128 128 0 0 0-180.906667-180.906667z m120.746667 120.746667a42.666667 42.666667 0 0 1-60.586667-60.586667 42.666667 42.666667 0 0 1 60.586667 0 42.666667 42.666667 0 0 1 0 60.586667zM213.333333 512a42.666667 42.666667 0 0 0 0 85.333333 213.333333 213.333333 0 0 1 213.333334 213.333334 42.666667 42.666667 0 0 0 85.333333 0 298.666667 298.666667 0 0 0-298.666667-298.666667z m0-170.666667a42.666667 42.666667 0 0 0 0 85.333334 384 384 0 0 1 384 384 42.666667 42.666667 0 0 0 85.333334 0 472.746667 472.746667 0 0 0-137.386667-331.946667A472.746667 472.746667 0 0 0 213.333333 341.333333z m452.693334 16.64A644.693333 644.693333 0 0 0 213.333333 170.666667a42.666667 42.666667 0 0 0 0 85.333333 554.666667 554.666667 0 0 1 554.666667 554.666667 42.666667 42.666667 0 0 0 85.333333 0 644.693333 644.693333 0 0 0-187.306666-452.693334z"/>
  </svg>
</a>

    
  <p>
  <br>
  <p id="hitokoto">:D 获取中...</p>
  <script src="https://v1.hitokoto.cn/?c=a&encode=js&select=%23hitokoto" defer></script>
  <br>
  <p class="center font">
    &copy - <a href="http://www.woaitucao.xyz">Jason</a> -  2020 -  2021 - Powered by <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/pcrab/hexo-theme-quark"> Quark </a> 
  </p>
  <p>
    <a href="https://beian.miit.gov.cn/" target="_blank"></a>
  </p>
  <br/>
</foot>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
