<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>The Tao of Jason</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="The Tao of Jason" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">The Tao of Jason</a></h1>
		<h2 class="header__subtitle"></h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2018/09/06/parser_04/">ä»é›¶å¼€å§‹çš„ç¼–è¯‘åŸç†ä¹‹æ—…----Parserç¯‡(å››)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-09-06</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/parser/">parser</a>
			</span>
		
	</div>

	

	
		<p>æœ¬ç¯‡ä¸»è¦é˜è¿°ä½¿ç”¨é€’å½’ä¸‹é™éå›æº¯æˆ–å›æº¯è§£æLL(1)æ–‡æ³•ï¼Œå¹¶æ¯”è¾ƒä¸¤è€…ä¼˜ç¼ºç‚¹</p>
<h3 id="1-ç›®å½•"><a href="#1-ç›®å½•" class="headerlink" title="1 ç›®å½•"></a>1 ç›®å½•</h3><p>æœ¬ç³»åˆ—æ—¨åœ¨å­¦ä¹ å„ç§parseræ€è·¯åŠæŠ€å·§ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> æ¸…æ™¨å…¥å¤å¯ºâ€”-è®ºä¸–é—´parserä¸ºä½•ç‰©</a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> åˆæ—¥ç…§é«˜æ—â€”-åˆæ¢Firsté›†ï¼ŒFollowé›† </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> æ›²å¾„é€šå¹½å¤„â€”-é¢„æµ‹åˆ†æè¡¨çš„æ„å»º </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> ç¦…æˆ¿èŠ±æœ¨æ·±â€”-å®ç°LL(1) parser </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> å±±å…‰æ‚¦é¸Ÿæ€§â€”-é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç° <strong>[æœ¬ç¯‡]</strong> </a></li>
<li>æ½­å½±ç©ºäººå¿ƒâ€”-æµ…è°ˆrecursive ascent parser(SLR,LALR(1))</li>
<li>ä¸‡ç±æ­¤ä¿±å¯‚â€”-parser combinatorï¼ˆä»ohm.jsæºç è¯´èµ·ï¼‰</li>
<li>ä½†ä½™é’Ÿç£¬éŸ³â€”-åæ€ä¸æ€»ç»“</li>
</ol>
<h3 id="2-ä»€ä¹ˆæ˜¯é€’å½’ä¸‹é™ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯é€’å½’ä¸‹é™ï¼Ÿ" class="headerlink" title="2 ä»€ä¹ˆæ˜¯é€’å½’ä¸‹é™ï¼Ÿ"></a>2 ä»€ä¹ˆæ˜¯é€’å½’ä¸‹é™ï¼Ÿ</h3><p>ä¸€ä¸ªé€’å½’ä¸‹é™è¯­æ³•åˆ†æç¨‹åºç”±ä¸€ç»„è¿‡ç¨‹ç»„æˆï¼Œæ¯ä¸ªéç»ˆç»“ç¬¦æœ‰ä¸€ä¸ªå¯¹åº”çš„è¿‡ç¨‹ã€‚ç¨‹åºçš„æ‰§è¡Œä»å¼€å§‹ç¬¦å·å¯¹åº”çš„è¿‡ç¨‹å¼€å§‹ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹æ‰«æäº†æ•´ä¸ªè¾“å…¥ä¸²ï¼Œå®ƒå°±åœæ­¢æ‰§è¡Œå¹¶å®£å¸ƒè¯­æ³•åˆ†ææˆåŠŸå®Œæˆã€‚<br>ä¸¾ä¸€ä¸ªç›´è§‚çš„æ —å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;cAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|a</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<font color="red">ä½¿ç”¨é€’å½’ä¸‹é™è§£ææ–‡æ³•é€šä¿—çš„è®²å°±æ˜¯è°ƒç”¨compilerS()æ ¹æ®å‡½æ•°è°ƒç”¨æ˜¯å¦æˆåŠŸï¼ˆåˆ¤æ–­æ˜¯å¦æœ‰éæ³•å­—ç¬¦ä¸²ï¼‰ä¸”è¾“å…¥ä¸²æ˜¯å¦å®Œå…¨åŒ¹é…ï¼ˆæ˜¯å¦æœ‰å¤šä½™å­—ç¬¦ï¼‰æ¥åˆ¤æ–­è§£ææ˜¯å¦æˆåŠŸ</font><br>### 3 ä¸ºä»€ä¹ˆä½¿ç”¨é€’å½’ä¸‹é™è§£æLLï¼ˆ1ï¼‰æ–‡æ³•<br>ä¸Šä¸€ç« ä»‹ç»äº†ä½¿ç”¨æ˜¾å¼çš„ç»´æŠ¤ä¸€ä¸ªstackæ¥è§£æLLï¼ˆ1ï¼‰æ–‡æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸å¦‚ç›´æ¥ä½¿ç”¨é€’å½’éšå¼çš„ç»´æŠ¤call stackæ¥çš„ç›´è§‚ï¼Œ<font color="blue">æœ¬è´¨ä¸Šä¸¤è€…æ˜¯ç­‰ä»·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸€ä¸ªä½¿ç”¨äº†ç³»ç»Ÿçš„æ§åˆ¶æµä¸€ä¸ªè‡ªå·±æ„é€ æ§åˆ¶æµã€‚</font>

<h3 id="4-é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆä¸å¸¦å›æº¯ï¼‰"><a href="#4-é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆä¸å¸¦å›æº¯ï¼‰" class="headerlink" title="4 é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆä¸å¸¦å›æº¯ï¼‰"></a>4 é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆä¸å¸¦å›æº¯ï¼‰</h3><p>è¿™ç§é€’å½’ä¸‹é™å±äºé€’å½’ä¸‹é™ä¸­ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œä¸éœ€è¦å›æº¯çš„å‰ææ˜¯LLï¼ˆ1ï¼‰æ–‡æ³•ä¸­æ¯ä¸ªéç»ˆç»“ç¬¦çš„äº§ç”Ÿå¼<font color="red">ä¸å­˜åœ¨å¯ä»¥åˆå¹¶çš„å·¦å…¬å› å­</font>,ä¸¾ä¸ªæ —å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		eat(<span class="string">'s'</span>);</span><br><span class="line">		<span class="keyword">this</span>.compilerA();</span><br><span class="line">		eat(<span class="string">'d'</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.input[cursor] === <span class="string">'a'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'a'</span>);</span><br><span class="line">			eat(<span class="string">'b'</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.input[cursor] === <span class="string">'c'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'c'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç å¦‚ä¸Šï¼Œå¯ä»¥çœ‹å‡ºå¹¶ä¸éœ€è¦å›æº¯ï¼Œä½†æ˜¯æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¹‹å‰å®šä¹‰çš„æ–‡æ³•ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">	Grammar:</span><br><span class="line">		S-&gt;sAd</span><br><span class="line">		A-&gt;ab|a</span><br><span class="line">*/</span><br></pre></td></tr></table></figure></p>
<p>ä½ ä¼šå‘ç°åœ¨è§£æAè¿™ä¸ªç»ˆç»“ç¬¦çš„æ—¶å€™ï¼Œhmmmï¼Œå®ƒç¬¬ä¸€ä¸ªå­—æ¯ç«Ÿç„¶æ˜¯ç›¸åŒçš„ä¹Ÿå°±æ˜¯è¯´æ²¡åŠæ³•é€šè¿‡ç¬¬ä¸€ä¸ªå­—æ¯æ¥åŒºåˆ†è¿›å…¥å“ªä¸ªåˆ†æ”¯ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ—¶å€™çœ‹ç¬¬äºŒä¸ªä¸å°±è¡Œäº†å—ï¼Œæ˜¯è¡Œäº†ï¼Œä¸è¿‡å› ä¸ºè¿™é‡Œçš„ä¾‹å­ç®€å•ï¼Œçœ‹ç¬¬äºŒä¸ªå­—æ¯çš„hackä¸ä¼šå¤ªä¸‘ï¼Œå®é™…ä¸Šç¼–ç¨‹è¯­è¨€çš„è§£ææ¯”è¿™å¤æ‚å¾ˆå¤šï¼Œå¦‚æœä¸€ç›´å†™ï¼Œçœ‹ç¬¬äºŒä¸ªï¼Œçœ‹ç¬¬ä¸‰ä¸ªçš„ä»£ç ï¼Œé‚£ä¹ˆä»£ç ä¼šå¼‚å¸¸éš¾çœ‹ï¼ˆæˆ‘ç¬¬ä¸€æ¬¡ä¸ä¿¡é‚ªçš„å†™å‡ºæ¥è¿‡ï¼‰ï¼Œè¿˜æœ‰åŒå­¦å¯èƒ½ä¼šè§‰å¾—è¿™æ—¶å€™æ‰‹åŠ¨åˆå¹¶å·¦å…¬å› å­å°±è¡Œäº†å˜›ï¼Œå—¯ï¼Œè¿™ç¡®å®æ˜¯ä¸€ç§æ–¹æ³•ï¼Œå®é™…ä¸Šä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼å°±æ˜¯<strong>å›æº¯</strong>ï¼Œé€šè¿‡å›æº¯è¿›å…¥æ¯ä¸€ä¸ªåˆ†æ”¯çœ‹çœ‹æ˜¯å¦æ­£ç¡®ã€‚</p>
<h3 id="5-é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆå¸¦å›æº¯ï¼‰"><a href="#5-é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆå¸¦å›æº¯ï¼‰" class="headerlink" title="5 é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆå¸¦å›æº¯ï¼‰"></a>5 é€’å½’ä¸‹é™çš„é¢„æµ‹åˆ†æï¼ˆå¸¦å›æº¯ï¼‰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|a</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	compilerS() &#123;</span><br><span class="line">		eat(<span class="string">'s'</span>);</span><br><span class="line">		<span class="keyword">this</span>.compilerA();</span><br><span class="line">		eat(<span class="string">'d'</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	compilerA() &#123;</span><br><span class="line">		<span class="keyword">if</span>(firstOf(A) === <span class="string">'a'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'a'</span>);</span><br><span class="line">			eat(<span class="string">'b'</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(firstOf(A) === <span class="string">'c'</span>) &#123;</span><br><span class="line">			eat(<span class="string">'c'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	run() &#123;</span><br><span class="line">		<span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚è¿›è¡Œå›æº¯é‚£ä¹ˆæ„å‘³ç€è¦éå†æ‰€æœ‰åˆ†æ”¯ï¼Œå‡å¦‚æœ‰nä¸ªéç»ˆç»“ç¬¦ï¼Œmä¸ªäº§ç”Ÿå¼ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±æ˜¯Oï¼ˆn*mï¼‰ï¼Œè¿™åŠ¿å¿…ä¼šé™ä½æ•ˆç‡ï¼Œæ‰€ä»¥ä¼šé‡‡å–ä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨åŠ¨æ€è§„åˆ’ç¼“å­˜ç»“æœï¼Œä¹‹ååœ¨è®²è§£ohm.jsæºç çš„æ—¶å€™ä¼šè¯¦è¿° Incremental Packrat Parsingï¼ˆé€’å½’ä¸‹é™å›æº¯çš„ä¼˜åŒ–ï¼‰ï¼Œè®¡ç®—æœºç§‘å­¦å˜›æ€»æ˜¯è¦åœ¨ç©ºé—´å’Œæ—¶é—´ä¹‹é—´åšä¸€ä¸ªtrade offã€‚</p>
<p>åˆ°åº•ä½¿ç”¨è¡¨é©±åŠ¨çš„éé€’å½’é¢„æµ‹åˆ†æç®—æ³•è¿˜æ˜¯é‡‡ç”¨é€’å½’ä¸‹é™å°±è¦çœ‹éœ€æ±‚ä»è€…è§ä»æ™ºè€…è§æ™ºäº†ã€‚</p>
<h3 id="6-é€’å½’ä¸‹é™çš„éå›æº¯å®ç°"><a href="#6-é€’å½’ä¸‹é™çš„éå›æº¯å®ç°" class="headerlink" title="6 é€’å½’ä¸‹é™çš„éå›æº¯å®ç°"></a>6 é€’å½’ä¸‹é™çš„éå›æº¯å®ç°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">        <span class="keyword">this</span>.input  = input;</span><br><span class="line">        <span class="keyword">this</span>.cursor = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerS() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'s'</span>);</span><br><span class="line">        <span class="keyword">this</span>.compilerA();</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'d'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA() &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor] === <span class="string">'a'</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'a'</span>);</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'b'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor] === <span class="string">'c'</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.eat(<span class="string">'c'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.input.length !== <span class="keyword">this</span>.cursor) &#123; <span class="comment">// deal with Extra unmatched characters</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected Extra unmatched characters with <span class="subst">$&#123;<span class="keyword">this</span>.input.slice(<span class="keyword">this</span>.cursor)&#125;</span>`</span> +</span><br><span class="line">                 <span class="string">`at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span> in inputstring: <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    eat(inputChar) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputChar === <span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor]) &#123;</span><br><span class="line">            <span class="keyword">this</span>.cursor++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected match <span class="subst">$&#123;inputChar&#125;</span> with <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span> at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbds"</span>).run() === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbd"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"ssbds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabd"</span>).run()   === <span class="literal">true</span>);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-é€’å½’ä¸‹é™çš„å›æº¯å®ç°"><a href="#7-é€’å½’ä¸‹é™çš„å›æº¯å®ç°" class="headerlink" title="7 é€’å½’ä¸‹é™çš„å›æº¯å®ç°"></a>7 é€’å½’ä¸‹é™çš„å›æº¯å®ç°</h3><p>é€’å½’ä¸‹é™çš„DFSç®—æ³•<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Grammar:</span></span><br><span class="line"><span class="comment">		S-&gt;sAd</span></span><br><span class="line"><span class="comment">		A-&gt;ab|c</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">compilerEngile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(input) &#123;</span><br><span class="line">        <span class="keyword">this</span>.input  = input;</span><br><span class="line">        <span class="keyword">this</span>.cursor = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerS() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'s'</span>);</span><br><span class="line">        <span class="keyword">this</span>.compilerA();</span><br><span class="line">        <span class="keyword">this</span>.eat(<span class="string">'d'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA() &#123;</span><br><span class="line">        <span class="keyword">let</span> save;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (save = <span class="keyword">this</span>.saveCursor(<span class="keyword">this</span>.cursor) , <span class="keyword">this</span>.compilerA1()) ||</span><br><span class="line">            (<span class="keyword">this</span>.backtrack(save) , <span class="keyword">this</span>.compilerA2());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA1() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.eat(<span class="string">'a'</span>) &amp;&amp; <span class="keyword">this</span>.eat(<span class="string">'b'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compilerA2() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.eat(<span class="string">'c'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.compilerS(); <span class="comment">// Start !!!</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.input.length !== <span class="keyword">this</span>.cursor) &#123; <span class="comment">// deal with Extra unmatched characters</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`unexpected Extra unmatched characters with <span class="subst">$&#123;<span class="keyword">this</span>.input.slice(<span class="keyword">this</span>.cursor)&#125;</span>`</span> +</span><br><span class="line">                    <span class="string">`at position <span class="subst">$&#123;<span class="keyword">this</span>.cursor&#125;</span> in input string: <span class="subst">$&#123;<span class="keyword">this</span>.input&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// help function</span></span><br><span class="line"></span><br><span class="line">    eat(inputChar) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputChar === <span class="keyword">this</span>.input[<span class="keyword">this</span>.cursor]) &#123;</span><br><span class="line">            <span class="keyword">this</span>.cursor++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    backtrack(fn) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cursor = fn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    saveCursor(cursor) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbds"</span>).run() === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasbd"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"ssbds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sasds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabds"</span>).run()  === <span class="literal">false</span>); <span class="comment">// true</span></span><br><span class="line">assert(<span class="keyword">new</span> compilerEngile(<span class="string">"sabd"</span>).run()   === <span class="literal">true</span>);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/09/06/parser_03/">ä»é›¶å¼€å§‹çš„ç¼–è¯‘åŸç†ä¹‹æ—…----Parserç¯‡(ä¸‰)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-09-06</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/parser/">parser</a>
			</span>
		
	</div>

	

	
		<p>æœ¬ç¯‡å°†ä½¿ç”¨éé€’å½’çš„é¢„æµ‹åˆ†ææ¥æ„å»ºLL(1) Parserï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬å¼€å§‹å§:-)</p>
<h3 id="1-ç›®å½•"><a href="#1-ç›®å½•" class="headerlink" title="1 ç›®å½•"></a>1 ç›®å½•</h3><p>æœ¬ç³»åˆ—æ—¨åœ¨å­¦ä¹ å„ç§parseræ€è·¯åŠæŠ€å·§ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> æ¸…æ™¨å…¥å¤å¯ºâ€”-è®ºä¸–é—´parserä¸ºä½•ç‰©</a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> åˆæ—¥ç…§é«˜æ—â€”-åˆæ¢Firsté›†ï¼ŒFollowé›† </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> æ›²å¾„é€šå¹½å¤„â€”-é¢„æµ‹åˆ†æè¡¨çš„æ„å»º </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> ç¦…æˆ¿èŠ±æœ¨æ·±â€”-å®ç°LL(1) parser <strong>[æœ¬ç¯‡]</strong></a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> å±±å…‰æ‚¦é¸Ÿæ€§â€”-é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç° </a></li>
<li>æ½­å½±ç©ºäººå¿ƒâ€”-æµ…è°ˆrecursive ascent parser(SLR,LALR(1))</li>
<li>ä¸‡ç±æ­¤ä¿±å¯‚â€”-parser combinatorï¼ˆä»ohm.jsæºç è¯´èµ·ï¼‰</li>
<li>ä½†ä½™é’Ÿç£¬éŸ³â€”-åæ€ä¸æ€»ç»“</li>
</ol>
<h3 id="2-éé€’å½’çš„é¢„æµ‹åˆ†æ"><a href="#2-éé€’å½’çš„é¢„æµ‹åˆ†æ" class="headerlink" title="2 éé€’å½’çš„é¢„æµ‹åˆ†æ"></a>2 éé€’å½’çš„é¢„æµ‹åˆ†æ</h3><p>æ‰€è°“çš„éé€’å½’é¢„æµ‹åˆ†æå°±æ˜¯ä½¿ç”¨ä¹‹å‰æ„å»ºçš„parsing table+stackæ¥è§£æinput bufferã€‚<br>ç®—æ³•å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">stack=[<span class="string">'S'</span>,<span class="string">'$'</span>]; <span class="comment">// Sä»£è¡¨Startï¼Œè¡¨ç¤ºèµ·å§‹ç¬¦å·ï¼Œ$è¡¨ç¤ºæ ˆä¸ºç©º</span></span><br><span class="line">cursor=ç¬¬ä¸€ä¸ªè¾“å…¥ç¬¦å·ï¼›</span><br><span class="line">top=æ ˆé¡¶ç¬¦å·ï¼›</span><br><span class="line"><span class="keyword">while</span>ï¼ˆtop != $ï¼‰ &#123; <span class="comment">// $ è¡¨ç¤ºç©ºçš„å«ä¹‰</span></span><br><span class="line">	<span class="keyword">if</span> (isTerminal(top)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (top === input[cursor]) &#123;</span><br><span class="line">		stack.pop();</span><br><span class="line">		cursor++;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">SyntaxError</span>(<span class="string">`can't match <span class="subst">$&#123;input[cursor]&#125;</span> with <span class="subst">$&#123;top&#125;</span>`</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!getProduction) &#123; <span class="comment">// é¢„æµ‹è¡¨ä¸å­˜åœ¨å¯¹åº”çš„äº§ç”Ÿå¼</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"parsing table don't match $&#123;top&#125; item"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// æ‰¾åˆ°äº†é¢„æµ‹è¡¨å¯¹åº”çš„äº§ç”Ÿå¼</span></span><br><span class="line">			stack.pop();</span><br><span class="line">			productionå­—ç¬¦ä¾æ¬¡å‹æ ˆ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	æ›´æ–°topæŒ‡å‘æ–°çš„æ ˆé¡¶;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-éé€’å½’çš„é¢„æµ‹åˆ†æå®ç°"><a href="#3-éé€’å½’çš„é¢„æµ‹åˆ†æå®ç°" class="headerlink" title="3 éé€’å½’çš„é¢„æµ‹åˆ†æå®ç°"></a>3 éé€’å½’çš„é¢„æµ‹åˆ†æå®ç°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * = LL parser =</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * by Dmitry Soshnikov &lt;dmitry.soshnikov@gmail.com&gt;</span></span><br><span class="line"><span class="comment"> * MIT Style license</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Often one can see manually written LL parsers implemented as</span></span><br><span class="line"><span class="comment"> * recursive descent. Approach in this diff is a classical parse table</span></span><br><span class="line"><span class="comment"> * state machine.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  LL parser consists of:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. input buffer (source code)</span></span><br><span class="line"><span class="comment"> * 2. stack</span></span><br><span class="line"><span class="comment"> * 3. parsing table (state machine)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Parsing table:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   Table is used to get the next production number to apply, based on current</span></span><br><span class="line"><span class="comment"> *   symbol from the buffer, and the symbol (terminal or non-terminal)</span></span><br><span class="line"><span class="comment"> *   on top of the stack.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Rows in the table are non-terminals</span></span><br><span class="line"><span class="comment"> *   - Columns are terminals</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Parsing algorithm:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - if the top of the stack is *terminal*, and matches current symbol in</span></span><br><span class="line"><span class="comment"> *     buffer, then just discard it from the stack, and move cursor further.</span></span><br><span class="line"><span class="comment"> *     (if doesn't match -- parse error).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   - Else (it must be a non-terminal), replace it with an</span></span><br><span class="line"><span class="comment"> *     alternative production, corresponding to the production number.</span></span><br><span class="line"><span class="comment"> *     (if no production -- parse error).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * $ - is a special symbol used to mark bottom of the stack</span></span><br><span class="line"><span class="comment"> *     and end of the buffer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * S - is a start symbol.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * At the beginning stack is:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [S, $]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Grammar:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. S -&gt; F</span></span><br><span class="line"><span class="comment"> *   2. S -&gt; (S + F)</span></span><br><span class="line"><span class="comment"> *   3. F -&gt; a</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Input:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (a + a)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Parse table:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *   |    (  )  a  +  $ |</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *   | S  2  -  1  -  - |</span></span><br><span class="line"><span class="comment"> *   | F  -  -  3  -  - |</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The production rules which are applied to parse `(a + a)` are: 2, 1, 3, 3:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * S -&gt; ( S + F ) -&gt; ( F + F ) -&gt; ( a + F ) -&gt; ( a + a )</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * We see that each time the *left most* non-terminal is replaced. Hence, the</span></span><br><span class="line"><span class="comment"> * name of the parser: LL - scan source from Left to right, and apply the</span></span><br><span class="line"><span class="comment"> * Left most derivation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Our grammar representation. Key is a production number from</span></span><br><span class="line"><span class="comment"> * the grammar, the value is: 0 - LHS, 1 - RHS of the production.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> grammar = &#123;</span><br><span class="line">    <span class="number">1</span>: [<span class="string">'S'</span>, <span class="string">'F'</span>],       <span class="comment">// 1. S -&gt; F</span></span><br><span class="line">    <span class="number">2</span>: [<span class="string">'S'</span>, <span class="string">'(S + F)'</span>], <span class="comment">// 2. S -&gt; (S + F)</span></span><br><span class="line">    <span class="number">3</span>: [<span class="string">'F'</span>, <span class="string">'a'</span>],       <span class="comment">// 3. F -&gt; a</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Initial stack: bottom is the "end of the stack" ($),</span></span><br><span class="line"><span class="comment"> * and the start symbol ('S' in our case) is there too.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> stack = [<span class="string">'S'</span>, <span class="string">'$'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> parseFromTable(source, buildTable(grammar, source));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printGrammar</span>(<span class="params">grammar</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Grammar:\n'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> grammar) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'  '</span> + k + <span class="string">'.'</span>, grammar[k][<span class="number">0</span>], <span class="string">'-&gt;'</span>, grammar[k][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Builds a state-machine table where table[non-terminal][terminal]</span></span><br><span class="line"><span class="comment"> * coordinates determine which next production rule to apply.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildTable</span>(<span class="params">grammar, source</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// For now we assume a correct table was already built from</span></span><br><span class="line">    <span class="comment">// the grammar and source for us. We'll cover how to build it</span></span><br><span class="line">    <span class="comment">// automatically in the next lessons (see "first" and "follow"</span></span><br><span class="line">    <span class="comment">// sets topic). We encode only valid rules here and skip all other</span></span><br><span class="line">    <span class="comment">// (they return `undefined` meaning a parse error).</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// +------------------+</span></span><br><span class="line">    <span class="comment">// |    (  )  a  +  $ |</span></span><br><span class="line">    <span class="comment">// +------------------+</span></span><br><span class="line">    <span class="comment">// | S  2  -  1  -  - |</span></span><br><span class="line">    <span class="comment">// | F  -  -  3  -  - |</span></span><br><span class="line">    <span class="comment">// +------------------+</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'S'</span>: &#123;<span class="string">'('</span>: <span class="number">2</span>, <span class="string">'a'</span>: <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="string">'F'</span>: &#123;<span class="string">'a'</span>: <span class="number">3</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> productionNumbers = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Parses a source using parse table.</span></span><br><span class="line"><span class="comment"> * Doesn't build a parse tree yet, but just checks a source</span></span><br><span class="line"><span class="comment"> * string for acceptance (prints production rules appled in case</span></span><br><span class="line"><span class="comment"> * of successful parse, or throws on parse errors).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseFromTable</span>(<span class="params">source, table</span>) </span>&#123;</span><br><span class="line">    printGrammar(grammar);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Source:'</span>, source);</span><br><span class="line">    source = source.replace(<span class="regexp">/\s+/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> cursor = <span class="number">0</span>; cursor &lt; source.length;) &#123;</span><br><span class="line">        <span class="keyword">var</span> current = source[cursor];</span><br><span class="line">        <span class="keyword">var</span> top = stack.shift();</span><br><span class="line">        <span class="comment">// Terminal is on the stack, just advance.</span></span><br><span class="line">        <span class="keyword">if</span> (isTerminal(top, table) &amp;&amp; top === current) &#123;</span><br><span class="line">            <span class="comment">// We already shifted the symbol from the stack,</span></span><br><span class="line">            <span class="comment">// so just advance the cursor.</span></span><br><span class="line">            cursor++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Else, it's a non-terminal, do derivation (replace it</span></span><br><span class="line">        <span class="comment">// in the stack with corresponding production).</span></span><br><span class="line">        stack.unshift.apply(stack, getProduction(table, top, current));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Accepted. Productions:'</span>, productionNumbers.join(<span class="string">', '</span>), <span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isTerminal</span>(<span class="params">symbol, table</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !table.hasOwnProperty(symbol);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getProduction</span>(<span class="params">table, top, current</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nextProductionNumber = table[top][current];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!nextProductionNumber) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Parse error, unexpected token: '</span> + current);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> nextProduction = grammar[nextProductionNumber];</span><br><span class="line"></span><br><span class="line">    productionNumbers.push(nextProductionNumber);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return an array of symbols from a production, e.g.</span></span><br><span class="line">    <span class="comment">// '(', 'S', '+', 'F', ')' for '(S + F)', since</span></span><br><span class="line">    <span class="comment">// each symbol should be pushed onto the stack.</span></span><br><span class="line">    <span class="keyword">return</span> nextProduction[<span class="number">1</span>].split(<span class="regexp">/\s*/</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test:</span></span><br><span class="line">parse(<span class="string">'(a + a)'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Grammar:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   1. S -&gt; F</span></span><br><span class="line"><span class="comment">//   2. S -&gt; (S + F)</span></span><br><span class="line"><span class="comment">//   3. F -&gt; a</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source: (a + a)</span></span><br><span class="line"><span class="comment">// Accepted. Productions: 2, 1, 3, 3</span></span><br></pre></td></tr></table></figure>
<font color="red">å¯ä»¥çœ‹åˆ°è¡¨é©±åŠ¨çš„LL(1)Parser generatorå°±å®Œæˆäº†ï¼Œåæ–‡è®²è§£ohm.jsè¿˜å¯ä»¥çœ‹åˆ°é€’å½’ä¸‹é™çš„parser generatorï¼Œä¸è¿‡ä¸‹æ–‡é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç°éƒ½æ˜¯æ‰‹å†™é€’å½’ä¸‹é™çš„parser.</font>

<h3 id="4-Reference"><a href="#4-Reference" class="headerlink" title="4 Reference"></a>4 Reference</h3><p><a href="https://gist.github.com/DmitrySoshnikov/29f7a9425cdab69ea68f" title="DmitrySoshnikov gist" target="_blank" rel="noopener">DmitrySoshnikov gist</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/09/04/parser_02/">ä»é›¶å¼€å§‹çš„ç¼–è¯‘åŸç†ä¹‹æ—…----Parserç¯‡(äºŒ)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-09-04</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/parser/">parser</a>
			</span>
		
	</div>

	

	
		<h3 id="1-ç›®å½•"><a href="#1-ç›®å½•" class="headerlink" title="1 ç›®å½•"></a>1 ç›®å½•</h3><p>æœ¬ç³»åˆ—æ—¨åœ¨å­¦ä¹ å„ç§parseræ€è·¯åŠæŠ€å·§ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> æ¸…æ™¨å…¥å¤å¯ºâ€”-è®ºä¸–é—´parserä¸ºä½•ç‰©</a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> åˆæ—¥ç…§é«˜æ—â€”-åˆæ¢Firsté›†ï¼ŒFollowé›† </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> æ›²å¾„é€šå¹½å¤„â€”-é¢„æµ‹åˆ†æè¡¨çš„æ„å»º <strong>[æœ¬ç¯‡]</strong></a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> ç¦…æˆ¿èŠ±æœ¨æ·±â€”-å®ç°LL(1) parser </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> å±±å…‰æ‚¦é¸Ÿæ€§â€”-é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç° </a></li>
<li>æ½­å½±ç©ºäººå¿ƒâ€”-æµ…è°ˆrecursive ascent parser(SLR,LALR(1))</li>
<li>ä¸‡ç±æ­¤ä¿±å¯‚â€”-parser combinatorï¼ˆä»ohm.jsæºç è¯´èµ·ï¼‰</li>
<li>ä½†ä½™é’Ÿç£¬éŸ³â€”-åæ€ä¸æ€»ç»“</li>
</ol>
<h3 id="2-ä»€ä¹ˆæ˜¯é¢„æµ‹åˆ†æè¡¨"><a href="#2-ä»€ä¹ˆæ˜¯é¢„æµ‹åˆ†æè¡¨" class="headerlink" title="2 ä»€ä¹ˆæ˜¯é¢„æµ‹åˆ†æè¡¨"></a>2 ä»€ä¹ˆæ˜¯é¢„æµ‹åˆ†æè¡¨</h3><p>é¢„æµ‹åˆ†æè¡¨æ˜¯åœ¨è¯­æ³•åˆ†æä¸­ç”¨äºè¿›è¡Œé¢„æµ‹åˆ†æçš„æ•°æ®ç»“æ„ï¼Œé¾™ä¹¦ä¸Šæœ‰æ¯”è¾ƒè¯¦ç»†çš„å®šä¹‰ï¼Œåœ¨è¿™é‡Œå°±ä¸¾ä¸€ä¸ªæ —å­æ¥è¯´æ˜ï¼š</p>
<p>å‡å®šæœ‰å¦‚ä¸‹æ–‡æ³•ï¼š</p>
<pre><code>S -&gt; F
S -&gt; (S + F)
F -&gt; a
</code></pre><p>å®ƒçš„é¢„æµ‹åˆ†æè¡¨é•¿è¿™ä¸ªæ ·ï¼š</p>
<table>
<thead>
<tr>
<th>éç»ˆç»“ç¬¦/ç»ˆç»“ç¬¦</th>
<th style="text-align:right">(</th>
<th style="text-align:center">)</th>
<th>a</th>
<th>+</th>
<th>$</th>
</tr>
</thead>
<tbody>
<tr>
<td>S</td>
<td style="text-align:right">S -&gt; (S + F)</td>
<td style="text-align:center">-</td>
<td>S -&gt; F</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>F</td>
<td style="text-align:right">-</td>
<td style="text-align:center">-</td>
<td>F -&gt; a</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>å‡å¦‚è¿™æ—¶æˆ‘ä»¬è¦è§£æä¸€ä¸ªå­—ç¬¦ä¸²â€(a + a)â€</p>
<ol>
<li>è¯»å…¥â€(â€œ</li>
<li>æŸ¥è¯¢é¢„æµ‹åˆ†æè¡¨</li>
<li>æ ¹æ®é¢„æµ‹åˆ†æè¡¨ç»“æœï¼Œè¿›å…¥ç›¸åº”çš„äº§ç”Ÿå¼ï¼ˆä¹Ÿå¯ç§°å±•å¼€äº§ç”Ÿå¼ï¼‰</li>
<li>è¿™é‡Œæœ‰ä¸¤ç§ç­‰ä»·çš„æ–¹å¼å®ç°åŒ¹é…<br>4.1 ä½¿ç”¨ç¨‹åºçš„è°ƒç”¨æ ˆé€’å½’è¿›è¡Œé¢„æµ‹åˆ†æï¼Œå½“ç¨‹åºæ­£å¸¸ç»“æŸä¸”è¾“å…¥å®Œå…¨åŒ¹é…æ—¶ï¼Œè¯­æ³•åˆ†ææˆåŠŸ<br>4.2 ä½¿ç”¨æ ˆæ•°æ®ç»“æ„æ¥éé€’å½’çš„é¢„æµ‹åˆ†æï¼Œå½“æ ˆä¸ºç©ºä¸”å®Œå…¨åŒ¹é…æ—¶ï¼Œè¯­æ³•åˆ†ææˆåŠŸ</li>
</ol>
<p><font color="red">Tip:è¿™é‡Œæœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥æ€»æ˜¯èƒ½ç”¨éé€’å½’æ¥æ¨¡æ‹Ÿé€’å½’ï¼Ÿ</font><br>å…¶å®åœ¨Forthançš„å¹´ä»£ï¼Œäººä»¬è¿˜æœ¨æœ‰æ„è¯†åˆ°é€’å½’å¯¹äºç¨‹åºçš„ç”¨å¤„ï¼Œç¬¬ä¸€ä¸ªå€¡å¯¼ç¼–ç¨‹è¯­è¨€åº”è¯¥å®ç°é€’å½’çš„å°±æ˜¯å¤§åé¼é¼çš„Dijkstra ï¼Œéšç€<a href="https://dijkstrascry.com/node/4" title="Dijkstraçš„è®ºæ–‡" target="_blank" rel="noopener">Dijkstraçš„è®ºæ–‡</a>å‘è¡¨ï¼Œåœ¨ é‚£ä¹‹åçš„è¯­è¨€æ¯”å¦‚ALGOL 60ä¾¿ä½¿ç”¨äº†call stackè¿™ä¸ªæ¦‚å¿µæ¥å®ç°é€’å½’ï¼Œä¸è¿‡æ®è¯´åœ¨forthançš„å¹´ä»£ï¼ˆä¹Ÿå°±æ˜¯50å¹´ä»£æ—©æœŸï¼‰IBMçš„æœºå™¨è¿˜æ²¡æœ‰å †æ ˆå®ç°ï¼Œå¹¶ä¸”æœºå™¨å¾ˆå°ï¼Œä¼°è®¡ç”¨äº†é€’å½’æ•ˆç‡ä¹Ÿå¤Ÿå‘›ï¼Œä¸è¿‡é€’å½’çš„å¨åŠ›æ—©åœ¨Churchæå‡ºlambda calculusä»¥åŠ Church encodingå°±å·²ç»æ˜¾ç°å‡ºæ¥äº†ã€‚</p>
<h3 id="3-ä¸ºä»€ä¹ˆéœ€è¦é¢„æµ‹åˆ†æè¡¨"><a href="#3-ä¸ºä»€ä¹ˆéœ€è¦é¢„æµ‹åˆ†æè¡¨" class="headerlink" title="3 ä¸ºä»€ä¹ˆéœ€è¦é¢„æµ‹åˆ†æè¡¨"></a>3 ä¸ºä»€ä¹ˆéœ€è¦é¢„æµ‹åˆ†æè¡¨</h3><p>å…¶å®ä½ ä¹Ÿå¯ä»¥ä¸ç”¨å®ç°é¢„æµ‹åˆ†æè¡¨ï¼Œé¢„æµ‹åˆ†æè¡¨çš„æœ¬è´¨å°±æ˜¯å¯¹å½“å‰å­—ç¬¦è¿›è¡Œåˆ†æ”¯åˆ¤æ–­å—ï¼Œåªä¸è¿‡è¿™åˆ†æ”¯æ¯”è¾ƒå¤šï¼Œç„¶åä½ æ‡‚çš„ä»£ç å†™å‡ºæ¥éƒ½æ˜¯if-elseï¼ŒåµŒå¥—if-elseï¼Œè¿™ä¸€ç‚¹éƒ½ä¸ä¼˜é›…ï¼šï¼ˆï¼Œæ®è¯´ä¼˜é›…çš„ç¨‹åºå‘˜èƒ½æ‰¾åˆ°å¥³æœ‹å‹ï¼šï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢„æµ‹åˆ†æè¡¨æ¥é©±åŠ¨é¢„æµ‹è¯­ä¹‰åˆ†æï¼ˆè¿™éƒ¨åˆ†é¾™ä¹¦è¯­æ³•åˆ†æéƒ¨åˆ†è®²çš„æŒºç»†ï¼‰</p>
<h3 id="4-å®ç°é¢„æµ‹åˆ†æè¡¨"><a href="#4-å®ç°é¢„æµ‹åˆ†æè¡¨" class="headerlink" title="4 å®ç°é¢„æµ‹åˆ†æè¡¨"></a>4 å®ç°é¢„æµ‹åˆ†æè¡¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Building LL(1) parsing table from First and Follow sets.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * by Dmitry Soshnikov &lt;dmitry.soshnikov@gmail.com&gt;</span></span><br><span class="line"><span class="comment"> * MIT Style License</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This diff is a continuation of what we started in the previous two diffs:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Dependencies:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. Actual LL Parser, that uses parsing table:</span></span><br><span class="line"><span class="comment"> *      https://gist.github.com/DmitrySoshnikov/29f7a9425cdab69ea68f</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   2. First and Follow sets construction:</span></span><br><span class="line"><span class="comment"> *      https://gist.github.com/DmitrySoshnikov/924ceefb1784b30c5ca6</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * As we implemented in diff (1), LL Parser uses a parsing table. This</span></span><br><span class="line"><span class="comment"> * table is built based on First and Follow sets which we built in</span></span><br><span class="line"><span class="comment"> * the diff (2). In this diff we finishing constructing the parsing table</span></span><br><span class="line"><span class="comment"> * based on the data from previous analysis.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The purpose of the parsing table is to tell which next production to use</span></span><br><span class="line"><span class="comment"> * based on the symbol on the stack, and the current symbol in the buffer.</span></span><br><span class="line"><span class="comment"> * As we said in (1), rows of the table are non-terminals, and columns are</span></span><br><span class="line"><span class="comment"> * terminals.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Grammar:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. S -&gt; F</span></span><br><span class="line"><span class="comment"> *   2. S -&gt; (S + F)</span></span><br><span class="line"><span class="comment"> *   3. F -&gt; a</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Parsing table:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *   |    (  )  a  +  $ |</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *   | S  2  -  1  -  - |</span></span><br><span class="line"><span class="comment"> *   | F  -  -  3  -  - |</span></span><br><span class="line"><span class="comment"> *   +------------------+</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The rules for constructing the table are the following:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. Scan all non-terminals in the grammar, and put their derivations under</span></span><br><span class="line"><span class="comment"> *      the columns which are in the First set of the RHS for this non-terminal.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   2. If this non-terminal has `Îµ` (epsilon, "empty" symbol) as one of its</span></span><br><span class="line"><span class="comment"> *      derivations, then put the corresponding Îµ-derivation into the columns</span></span><br><span class="line"><span class="comment"> *      which are in the Follow set of this non-terminal.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Let's see it on the implementation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Special "empty" symbol.</span></span><br><span class="line"><span class="keyword">let</span> EPSILON = <span class="string">'Îµ'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Given a grammar builds a LL(1) parsing table based on the</span></span><br><span class="line"><span class="comment"> * First and Follow sets of this grammar.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildParsingTable</span>(<span class="params">grammar, firstSets, followSets</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> parsingTable = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> grammar) &#123;</span><br><span class="line">        <span class="keyword">let</span> production = grammar[k];</span><br><span class="line">        <span class="keyword">let</span> LHS = getLHS(production);</span><br><span class="line">        <span class="keyword">let</span> RHS = getRHS(production);</span><br><span class="line">        <span class="keyword">let</span> productionNumber = <span class="built_in">Number</span>(k);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Init columns for this non-terminal.</span></span><br><span class="line">        <span class="keyword">if</span> (!parsingTable[LHS]) &#123;</span><br><span class="line">            parsingTable[LHS] = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// All productions goes under the terminal column, if</span></span><br><span class="line">        <span class="comment">// this terminal is not epsilon.</span></span><br><span class="line">        <span class="keyword">if</span> (RHS !== EPSILON) &#123;</span><br><span class="line">            getFirstSetOfRHS(RHS, firstSets).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">terminal</span>) </span>&#123;</span><br><span class="line">                parsingTable[LHS][terminal] = productionNumber;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Otherwise, this Îµ-production goes under the columns from</span></span><br><span class="line">            <span class="comment">// the Follow set.</span></span><br><span class="line">            followSets[LHS].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">terminal</span>) </span>&#123;</span><br><span class="line">                parsingTable[LHS][terminal] = productionNumber;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parsingTable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Given production `S -&gt; F`, returns `S`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLHS</span>(<span class="params">production</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> production.split(<span class="string">'-&gt;'</span>)[<span class="number">0</span>].replace(<span class="regexp">/\s+/g</span>, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Given production `S -&gt; F`, returns `F`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRHS</span>(<span class="params">production</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> production.split(<span class="string">'-&gt;'</span>)[<span class="number">1</span>].replace(<span class="regexp">/\s+/g</span>, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns First set of RHS.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFirstSetOfRHS</span>(<span class="params">RHS, firstSets</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For simplicity, in this educational parser, we assume that</span></span><br><span class="line">    <span class="comment">// the first symbol (if it's a non-terminal) cannot produces `Îµ`.</span></span><br><span class="line">    <span class="comment">// Since in real parser, we need to get the First set of the whole RHS.</span></span><br><span class="line">    <span class="comment">// This means, that if `B` in the production `X -&gt; BC` can be `Îµ`, then</span></span><br><span class="line">    <span class="comment">// the First set should of course include First(C) as well, i.e. RHS[1], etc.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// That is, in a real parser, one usually combines steps of building a</span></span><br><span class="line">    <span class="comment">// parsing table, First and Follow sets in one step: when a parsing table</span></span><br><span class="line">    <span class="comment">// needs the First set of a RHS, it's calculated in place.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// But here we just return First of RHS[0].</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> firstSets[RHS[<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Testing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Example 1 of a simple grammar, generates: a, or (a + a), etc.</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// We just manually define our First and Follow sets for a given grammar,</span></span><br><span class="line"><span class="comment">// see again diff (2) where we automatically generated these sets.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grammar_1 = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'S -&gt; F'</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">'S -&gt; (S + F)'</span>,</span><br><span class="line">    <span class="number">3</span>: <span class="string">'F -&gt; a'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// See https://gist.github.com/DmitrySoshnikov/924ceefb1784b30c5ca6</span></span><br><span class="line"><span class="comment">// for the sets construction.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstSets_1 = &#123;</span><br><span class="line">    <span class="string">'S'</span>: [<span class="string">'a'</span>, <span class="string">'('</span>],</span><br><span class="line">    <span class="string">'F'</span>: [<span class="string">'a'</span>],</span><br><span class="line">    <span class="string">'a'</span>: [<span class="string">'a'</span>],</span><br><span class="line">    <span class="string">'('</span>: [<span class="string">'('</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> followSets_1 = &#123;</span><br><span class="line">    <span class="string">'S'</span>: [<span class="string">'$'</span>, <span class="string">'+'</span>],</span><br><span class="line">    <span class="string">'F'</span>: [<span class="string">'$'</span>, <span class="string">'+'</span>, <span class="string">')'</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(buildParsingTable(grammar_1, firstSets_1, followSets_1));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// S: &#123; a: 1, '(': 2 &#125;</span></span><br><span class="line"><span class="comment">// F: &#123; a: 3 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// That corresponds to the following table:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// +------------------+</span></span><br><span class="line"><span class="comment">// |    (  )  a  +  $ |</span></span><br><span class="line"><span class="comment">// +------------------+</span></span><br><span class="line"><span class="comment">// | S  2  -  1  -  - |</span></span><br><span class="line"><span class="comment">// | F  -  -  3  -  - |</span></span><br><span class="line"><span class="comment">// +------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Example 2, for the "calculator" grammar, e.g. (a + a) * a.</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grammar_2 = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'E -&gt; TX'</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">'X -&gt; +TX'</span>,</span><br><span class="line">    <span class="number">3</span>: <span class="string">'X -&gt; Îµ'</span>,</span><br><span class="line">    <span class="number">4</span>: <span class="string">'T -&gt; FY'</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">'Y -&gt; *FY'</span>,</span><br><span class="line">    <span class="number">6</span>: <span class="string">'Y -&gt; Îµ'</span>,</span><br><span class="line">    <span class="number">7</span>: <span class="string">'F -&gt; a'</span>,</span><br><span class="line">    <span class="number">8</span>: <span class="string">'F -&gt; (E)'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// See https://gist.github.com/DmitrySoshnikov/924ceefb1784b30c5ca6</span></span><br><span class="line"><span class="comment">// for the sets construction.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstSets_2 = &#123;</span><br><span class="line">    <span class="string">'E'</span>: [<span class="string">'a'</span>, <span class="string">'('</span>],</span><br><span class="line">    <span class="string">'T'</span>: [<span class="string">'a'</span>, <span class="string">'('</span>],</span><br><span class="line">    <span class="string">'F'</span>: [<span class="string">'a'</span>, <span class="string">'('</span>],</span><br><span class="line">    <span class="string">'a'</span>: [<span class="string">'a'</span>],</span><br><span class="line">    <span class="string">'('</span>: [<span class="string">'('</span>],</span><br><span class="line">    <span class="string">'X'</span>: [<span class="string">'+'</span>, <span class="string">'Îµ'</span>],</span><br><span class="line">    <span class="string">'+'</span>: [<span class="string">'+'</span>],</span><br><span class="line">    <span class="string">'Y'</span>: [<span class="string">'*'</span>, <span class="string">'Îµ'</span>],</span><br><span class="line">    <span class="string">'*'</span>: [<span class="string">'*'</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> followSets_2 = &#123;</span><br><span class="line">    <span class="string">'E'</span>: [<span class="string">'$'</span>, <span class="string">')'</span>],</span><br><span class="line">    <span class="string">'X'</span>: [<span class="string">'$'</span>, <span class="string">')'</span>],</span><br><span class="line">    <span class="string">'T'</span>: [<span class="string">'+'</span>, <span class="string">'$'</span>, <span class="string">')'</span>],</span><br><span class="line">    <span class="string">'Y'</span>: [<span class="string">'+'</span>, <span class="string">'$'</span>, <span class="string">')'</span>],</span><br><span class="line">    <span class="string">'F'</span>: [<span class="string">'*'</span>, <span class="string">'+'</span>, <span class="string">'$'</span>, <span class="string">')'</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(buildParsingTable(grammar_2,firstSets_2,followSets_2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// E: &#123; a: 1, '(': 1 &#125;,</span></span><br><span class="line"><span class="comment">// X: &#123; '+': 2, '$': 3, ')': 3 &#125;,</span></span><br><span class="line"><span class="comment">// T: &#123; a: 4, '(': 4 &#125;,</span></span><br><span class="line"><span class="comment">// Y: &#123; '*': 5, '+': 6, '$': 6, ')': 6 &#125;,</span></span><br><span class="line"><span class="comment">// F: &#123; a: 7, '(': 8 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// That corresponds to the following table:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// +---------------------+</span></span><br><span class="line"><span class="comment">// |    a  +  *  (  )  $ |</span></span><br><span class="line"><span class="comment">// +---------------------+</span></span><br><span class="line"><span class="comment">// | E  1  -  -  1  -  - |</span></span><br><span class="line"><span class="comment">// | X  -  2  -  -  3  3 |</span></span><br><span class="line"><span class="comment">// | T  4  -  -  4  -  - |</span></span><br><span class="line"><span class="comment">// | Y  -  6  5  -  6  6 |</span></span><br><span class="line"><span class="comment">// | F  7  -  -  8  -  - |</span></span><br><span class="line"><span class="comment">// +---------------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="4-Reference"><a href="#4-Reference" class="headerlink" title="4 Reference"></a>4 Reference</h3><p><a href="https://en.wikipedia.org/wiki/Parse_table" title="parsing table" target="_blank" rel="noopener">parsing table</a><br><a href="chrome-extension://cdonnmffkdaoajfknoeeecmchibpmkmg/static/pdf/web/viewer.html?file=http%3A%2F%2Fwww.yorku.ca%2Fwalker%2Fmath2320%2FDijkstra.pdf" title="Dijikstraâ€™s Algorithm" target="_blank" rel="noopener">Dijikstraâ€™s Algorithm</a><br><a href="https://gist.github.com/DmitrySoshnikov/644383a86b045a3a8ad3" title="DmitrySoshnikov blog" target="_blank" rel="noopener">DmitrySoshnikov gitst</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/09/03/parser_01/">ä»é›¶å¼€å§‹çš„ç¼–è¯‘åŸç†ä¹‹æ—…----Parserç¯‡(ä¸€)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-09-03</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/parser/">parser</a>
			</span>
		
	</div>

	

	
		<h3 id="1-ç›®å½•"><a href="#1-ç›®å½•" class="headerlink" title="1 ç›®å½•"></a>1 ç›®å½•</h3><p>æœ¬ç³»åˆ—æ—¨åœ¨å­¦ä¹ å„ç§parseræ€è·¯åŠæŠ€å·§ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> æ¸…æ™¨å…¥å¤å¯ºâ€”-è®ºä¸–é—´parserä¸ºä½•ç‰©</a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> åˆæ—¥ç…§é«˜æ—â€”-åˆæ¢Firsté›†ï¼ŒFollowé›† <strong>[æœ¬ç¯‡]</strong></a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> æ›²å¾„é€šå¹½å¤„â€”-é¢„æµ‹åˆ†æè¡¨çš„æ„å»º </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> ç¦…æˆ¿èŠ±æœ¨æ·±â€”-å®ç°LL(1) parser </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> å±±å…‰æ‚¦é¸Ÿæ€§â€”-é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç° </a></li>
<li>æ½­å½±ç©ºäººå¿ƒâ€”-æµ…è°ˆrecursive ascent parser(SLR,LALR(1))</li>
<li>ä¸‡ç±æ­¤ä¿±å¯‚â€”-parser combinatorï¼ˆä»ohm.jsæºç è¯´èµ·ï¼‰</li>
<li>ä½†ä½™é’Ÿç£¬éŸ³â€”-åæ€ä¸æ€»ç»“</li>
</ol>
<h3 id="1-ä½•è°“Firsté›†ï¼Œä½•è°“Followé›†åˆ"><a href="#1-ä½•è°“Firsté›†ï¼Œä½•è°“Followé›†åˆ" class="headerlink" title="1 ä½•è°“Firsté›†ï¼Œä½•è°“Followé›†åˆ"></a>1 ä½•è°“Firsté›†ï¼Œä½•è°“Followé›†åˆ</h3><p>æ‰€è°“Firsté›†å°±æ˜¯ä½ åœ¨æ ¹æ®éç»ˆç»“ç¬¦æ¨å¯¼äº§ç”Ÿå¼çš„ä¾æ®ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S -&gt; aAb</span><br><span class="line">A -&gt; a | &lt;epsilon&gt;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨åˆ†æSè¿™ä¸ªéç»ˆç»“ç¬¦çš„æ—¶å€™ï¼Œåˆ¤æ–­è¿›å…¥Säº§ç”Ÿå¼å°±éœ€è¦æŸ¥çœ‹Säº§ç”Ÿå¼çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸è¾“å…¥å­—ç¬¦ä¸²åŒ¹é…ï¼Œåƒä¸Šé¢ä¾‹å­ä¸­æ¯ä¸ªäº§ç”Ÿå¼å¯ä»¥ä»å·¦å¾€å³æ¨å¯¼ï¼Œå¹¶ä¸”åªéœ€è¦ä¸€ä¸ªå‰çœ‹å­—ç¬¦å°±å¯ä»¥åˆ¤æ–­è¿›å…¥å“ªä¸ªäº§ç”Ÿå¼ï¼Œæˆ‘ä»¬å°±è¯´å®ƒæ˜¯LLï¼ˆ1ï¼‰æ–‡æ³•,å®é™…ä¸Šfirsté›†æ˜¯é€’å½’ä¸‹é™åˆ†æè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡å¯¹å‰çœ‹å­—ç¬¦çš„é¢„æµ‹åˆ†æï¼ˆpredicitive parsingï¼‰å¯ä»¥æ¶ˆé™¤å¯¹éç»ˆç»“ç¬¦è§£æçš„äºŒä¹‰æ€§ï¼Œé‚£ä¹ˆä¸ºå•¥è¿˜éœ€è¦followé›†å‘¢ï¼Œç­”æ¡ˆæ˜¯å¯èƒ½å­˜åœ¨ç›¸åŒçš„Firsté›†ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S -&gt; aEb</span><br><span class="line">E -&gt; &apos;a&apos; | Îµ</span><br></pre></td></tr></table></figure></p>
<p>åŠ å…¥æˆ‘ä»¬è¦è§£æå­—ç¬¦ä¸²â€abâ€ï¼Œä»Sï¼ˆStartï¼‰å¼€å§‹ï¼Œaï¼ˆåŒ¹é…ï¼‰ï¼ŒEï¼ˆåŒ¹é…ä¸­ï¼‰ï¼Œå’¦ï¼ŒEçš„Firsté›†æ²¡æœ‰äº§ç”Ÿå¼ä¸ºç»ˆç»“ç¬¦â€™bâ€™å•Šï¼Œéš¾é“æˆ‘å°±è¦æŠ›å‡ºä¸€ä¸ªè§£æå¤±è´¥çš„å¼‚å¸¸å—ï¼Ÿå…„å¼Ÿåˆ«æ€¥ï¼Œå¦‚æœéç»ˆç»“ç¬¦çš„äº§ç”Ÿå¼åŒ…å«äº†Îµï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±è¦æŸ¥çœ‹Follow(E),æ­¤å¤„çš„Follow(E) = {b},è¿™æ—¶æ–‡æ³•è§£æå™¨çœ‹åˆ°b match follow(E)å°±å®‰å¿ƒçš„åœ¨Eè¿™ä¸ªç»ˆç»“ç¬¦å¤„é€‰æ‹©äº†Îµè¿™ä¸ªäº§ç”Ÿå¼ï¼Œæ¥ç€Sçš„äº§ç”Ÿå¼åŒ¹é…bï¼Œæ•´ä¸ªå­—ç¬¦ä¸²åŒ¹é…æˆåŠŸï¼šï¼‰ã€‚</p>
<p>è¿™é‡Œæœ‰åŒå­¦å¯èƒ½ä¼šå¥½å¥‡ä¸ºå•¥å¹³ç™½æ— æ•…çš„æˆ‘å®šä¹‰ä¸€ä¸ªéç»ˆç»“ç¬¦Eç”Ÿæˆäº§ç”Ÿå¼Îµå‘¢ï¼Ÿ<br>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢çš„æ–‡æ³•æ²¡æœ‰ä½¿ç”¨Îµï¼ˆè¡¨ç¤ºç©ºï¼‰å®šä¹‰çš„æƒ…å†µï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S -&gt; Sb</span><br></pre></td></tr></table></figure></p>
<p>æ€»ç»“ä¸€ä¸‹Firsté›†å’ŒFollowé›†çš„ä½¿ç”¨ï¼š<br>Firsté›†ç”¨æ¥åšåˆ†æ”¯é¢„æµ‹ï¼Œfollowé›†ç”¨æ¥å‡ºæ¥éç»ˆç»“ç¬¦ä¸­å«æœ‰Îµï¼ˆç©ºï¼‰çš„æƒ…å†µã€‚<br>å¯¹ä¸LLï¼ˆ1ï¼‰æ–‡æ³•ä¸€ç§ç®€å•æœ‰æ•ˆçš„è§£ææ‰‹æ³•æ˜¯ä½¿ç”¨é€’å½’ä¸‹é™ï¼Œæ‰€è°“çš„é€’å½’ä¸‹é™å°±æ˜¯å°†æ¯ä¸€ä¸ªéç»ˆç»“ç¬¦å¯¹åº”ä¸€ä¸ªè§£æå‡½æ•°ã€‚ä¸¾ä¸ªæ —å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">S</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	eat(<span class="string">'a'</span>)</span><br><span class="line">	E()</span><br><span class="line">	eat(<span class="string">'b'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">E</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(First(<span class="string">'a'</span>).indexOf(input) !== <span class="number">-1</span>) &#123;</span><br><span class="line">		eat(<span class="string">'a'</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Follow(E).indexOf(input) !== <span class="number">-1</span>) &#123;</span><br><span class="line">		eat(<span class="string">'Îµ'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ç²—æš´ï¼Œå¦‚æœä½ æ²¡æœ‰Îµä»£ç å°±ä¼šå†™æˆè¿™æ ·</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">S</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	S()</span><br><span class="line">	eat(<span class="string">'b'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯å·¦é€’å½’ï¼Œè°ƒç”¨æ ˆå¾ˆå¿«å°±æ»¡äº†ä¸æ˜¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ¶ˆé™¤å·¦é€’å½’å°±å¼•å…¥äº†Îµ</p>
<h3 id="2-å¦‚ä½•æ„é€ Firsté›†ï¼ŒFollowé›†åˆ"><a href="#2-å¦‚ä½•æ„é€ Firsté›†ï¼ŒFollowé›†åˆ" class="headerlink" title="2 å¦‚ä½•æ„é€ Firsté›†ï¼ŒFollowé›†åˆ"></a>2 å¦‚ä½•æ„é€ Firsté›†ï¼ŒFollowé›†åˆ</h3><h4 id="2-1-firsté›†çš„æ„é€ "><a href="#2-1-firsté›†çš„æ„é€ " class="headerlink" title="2.1 firsté›†çš„æ„é€ "></a>2.1 firsté›†çš„æ„é€ </h4><ul>
<li>If X is a terminal then First(X) is just X!</li>
<li>If there is a Production X â†’ Îµ then add Îµ to first(X)</li>
<li>If there is a Production X â†’ Y1Y2..Yk then add first(Y1Y2..Yk) to first(X)</li>
<li>First(Y1Y2..Yk) is either<ul>
<li>First(Y1) (if First(Y1) doesnâ€™t contain Îµ)</li>
<li>OR (if First(Y1) does contain Îµ) then First (Y1Y2..Yk) is everything in First(Y1) <except for="" Îµ=""> as well as everything in First(Y2..Yk)</except></li>
<li>If First(Y1) First(Y2)..First(Yk) all contain Îµ then add Îµ<br>to First(Y1Y2..Yk) as well.</li>
</ul>
</li>
</ul>
<h4 id="2-2-followé›†çš„æ„é€ "><a href="#2-2-followé›†çš„æ„é€ " class="headerlink" title="2.2 followé›†çš„æ„é€ "></a>2.2 followé›†çš„æ„é€ </h4><ul>
<li>First put $ (the end of input marker) in Follow(S) (S is the start symbol)</li>
<li>If there is a production A â†’ aBb, (where a can be a whole string) then everything in FIRST(b) except for Îµ is placed in FOLLOW(B).</li>
<li>If there is a production A â†’ aB, then everything in FOLLOW(A) is in FOLLOW(B)</li>
<li>If there is a production A â†’ aBb, where FIRST(b) contains Îµ, then everything in FOLLOW(A) is in FOLLOW(B)</li>
</ul>
<h4 id="2-3å®ä¾‹è®²è§£"><a href="#2-3å®ä¾‹è®²è§£" class="headerlink" title="2.3å®ä¾‹è®²è§£"></a>2.3å®ä¾‹è®²è§£</h4><p>é¦–å…ˆå®šä¹‰ä¸€ç»„Grammar</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">The Grammar</span><br><span class="line"></span><br><span class="line">E â†’ TE&apos;</span><br><span class="line"></span><br><span class="line">E&apos; â†’ +TE&apos;</span><br><span class="line"></span><br><span class="line">E&apos; â†’ Îµ</span><br><span class="line"></span><br><span class="line">T â†’ FT&apos;</span><br><span class="line"></span><br><span class="line">T&apos; â†’ *FT&apos;</span><br><span class="line"></span><br><span class="line">T&apos; â†’ Îµ</span><br><span class="line"></span><br><span class="line">F â†’ (E)</span><br><span class="line"></span><br><span class="line">F â†’ id</span><br></pre></td></tr></table></figure>
<p><img src="/images/parser_01/1.png" alt=""><br><img src="/images/parser_01/2.png" alt=""><br><img src="/images/parser_01/3.png" alt=""></p>
<p><font color="red">ä»¥ä¸‹ä¸ºå¯¹firsté›†åˆå’Œfollowé›†æ±‚è§£çš„ä»£ç å®ç°</font><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Special "empty" symbol.</span></span><br><span class="line"><span class="keyword">let</span> EPSILON = <span class="string">"Îµ"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Rules for First Sets</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - If X is a terminal then First(X) is just X!</span></span><br><span class="line"><span class="comment"> * - If there is a Production X â†’ Îµ then add Îµ to first(X)</span></span><br><span class="line"><span class="comment"> * - If there is a Production X â†’ Y1Y2..Yk then add first(Y1Y2..Yk) to first(X)</span></span><br><span class="line"><span class="comment"> * - First(Y1Y2..Yk) is either</span></span><br><span class="line"><span class="comment"> *     - First(Y1) (if First(Y1) doesn't contain Îµ)</span></span><br><span class="line"><span class="comment"> *     - OR (if First(Y1) does contain Îµ) then First (Y1Y2..Yk) is everything</span></span><br><span class="line"><span class="comment"> *       in First(Y1) &lt;except for Îµ &gt; as well as everything in First(Y2..Yk)</span></span><br><span class="line"><span class="comment"> *     - If First(Y1) First(Y2)..First(Yk) all contain Îµ then add Îµ</span></span><br><span class="line"><span class="comment"> *       to First(Y1Y2..Yk) as well.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFirstSets</span>(<span class="params">grammar, Sets</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> buildSet(firstOf, grammar, Sets, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">firstOf</span>(<span class="params">symbol, firstSets</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A set may already be built from some previous analysis</span></span><br><span class="line">  <span class="comment">// of a RHS, so check whether it's already there and don't rebuild.</span></span><br><span class="line">  <span class="keyword">if</span> (firstSets[symbol]) &#123;</span><br><span class="line">    <span class="keyword">return</span> firstSets[symbol];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Else init and calculate.</span></span><br><span class="line">  <span class="keyword">let</span> first = firstSets[symbol] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If it's a terminal, its first set is just itself.</span></span><br><span class="line">  <span class="keyword">if</span> (isTerminal(symbol)) &#123;</span><br><span class="line">    first[symbol] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> firstSets[symbol];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> productionsForSymbol = getProductionsForSymbol(symbol,grammar);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> productionsForSymbol) &#123;</span><br><span class="line">    <span class="keyword">let</span> production = getRHS(productionsForSymbol[k]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; production.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> productionSymbol = production[i];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Epsilon goes to the first set.</span></span><br><span class="line">      <span class="keyword">if</span> (productionSymbol === EPSILON) &#123;</span><br><span class="line">        first[EPSILON] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Else, the first is a non-terminal,</span></span><br><span class="line">      <span class="comment">// then first of it goes to first of our symbol</span></span><br><span class="line">      <span class="comment">// (unless it's an epsilon).</span></span><br><span class="line">      <span class="keyword">let</span> firstOfNonTerminal = firstOf(productionSymbol, firstSets);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If first non-terminal of the RHS production doesn't</span></span><br><span class="line">      <span class="comment">// contain epsilon, then just merge its set with ours.</span></span><br><span class="line">      <span class="keyword">if</span> (!firstOfNonTerminal[EPSILON]) &#123;</span><br><span class="line">        merge(first, firstOfNonTerminal);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Else (we got epsilon in the first non-terminal),</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">//   - merge all except for epsilon</span></span><br><span class="line">      <span class="comment">//   - eliminate this non-terminal and advance to the next symbol</span></span><br><span class="line">      <span class="comment">//     (i.e. don't break this loop)</span></span><br><span class="line">      merge(first, firstOfNonTerminal, [EPSILON]);</span><br><span class="line">      <span class="comment">// don't break, go to the next `productionSymbol`.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * We have the following data structure for our grammars:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * let grammar = &#123;</span></span><br><span class="line"><span class="comment"> *   1: 'S -&gt; F',</span></span><br><span class="line"><span class="comment"> *   2: 'S -&gt; (S + F)',</span></span><br><span class="line"><span class="comment"> *   3: 'F -&gt; a',</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Given symbol `S`, the function returns `S -&gt; F`,</span></span><br><span class="line"><span class="comment"> * and `S -&gt; (S + F)` productions.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getProductionsForSymbol</span>(<span class="params">symbol,grammar</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> productionsForSymbol = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> grammar) &#123;</span><br><span class="line">    <span class="keyword">if</span> (grammar[k][<span class="number">0</span>] === symbol) &#123;</span><br><span class="line">      productionsForSymbol[k] = grammar[k];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> productionsForSymbol;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Given production `S -&gt; F`, returns `S`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLHS</span>(<span class="params">production</span>) </span>&#123;</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">function getLHS(production) &#123;</span></span><br><span class="line"><span class="regexp">function getLHS(production) &#123;</span></span><br><span class="line"><span class="regexp">  return production.split('-&gt;')[0].replace(/</span>\s+<span class="regexp">/g, '');</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * Given production <span class="string">`S -&gt; F`</span>, returns <span class="string">`F`</span>.</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">function getRHS(production) &#123;</span></span><br><span class="line"><span class="regexp">  return production.split('-&gt;')[1].replace(/</span>\s+<span class="regexp">/g, '');</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * Rules <span class="keyword">for</span> Follow Sets</span><br><span class="line"> *</span><br><span class="line"> * - First put $ (the end <span class="keyword">of</span> input marker) <span class="keyword">in</span> Follow(S) (S is the start symbol)</span><br><span class="line"> * - If there is a production A â†’ aBb, (where a can be a whole string)</span><br><span class="line"> *   then everything <span class="keyword">in</span> FIRST(b) except <span class="keyword">for</span> Îµ is placed <span class="keyword">in</span> FOLLOW(B).</span><br><span class="line"> * - If there is a production A â†’ aB, then everything <span class="keyword">in</span></span><br><span class="line"> *   FOLLOW(A) is <span class="keyword">in</span> FOLLOW(B)</span><br><span class="line"> * - If there is a production A â†’ aBb, where FIRST(b) contains Îµ,</span><br><span class="line"> *   then everything <span class="keyword">in</span> FOLLOW(A) is <span class="keyword">in</span> FOLLOW(B)</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function buildFollowSets(grammar, Sets) &#123;</span></span><br><span class="line"><span class="regexp">  return buildSet(followOf,grammar, Sets, 1);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function followOf(symbol, firstSets, followSets) &#123;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ If was already calculated from some previous run.</span></span><br><span class="line"><span class="regexp">  if (followSets[symbol]) &#123;</span></span><br><span class="line"><span class="regexp">    return followSets[symbol];</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ Else init and calculate.</span></span><br><span class="line"><span class="regexp">  let follow = followSets[symbol] = &#123;&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ Start symbol always contain `$` in its follow set.</span></span><br><span class="line"><span class="regexp">  if (symbol === START_SYMBOL) &#123;</span></span><br><span class="line"><span class="regexp">    follow['$'] = true;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ We need to analyze all productions where our</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ symbol is used (i.e. where it appears on RHS).</span></span><br><span class="line"><span class="regexp">  let productionsWithSymbol = getProductionsWithSymbol(symbol);</span></span><br><span class="line"><span class="regexp">  for (let k in productionsWithSymbol) &#123;</span></span><br><span class="line"><span class="regexp">    let production = productionsWithSymbol[k];</span></span><br><span class="line"><span class="regexp">    let RHS = getRHS(production);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ Get the follow symbol of our symbol.</span></span><br><span class="line"><span class="regexp">    let symbolIndex = RHS.indexOf(symbol);</span></span><br><span class="line"><span class="regexp">    let followIndex = symbolIndex + 1;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ We need to get the following symbol, which can be `$` or</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ may contain epsilon in its first set. If it contains epsilon, then</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ we should take the next following symbol: `A -&gt; aBCD`: if `C` (the</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ follow of `B`) can be epsilon, we should consider first of `D` as well</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ as the follow of `B`.</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    while (true) &#123;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      if (followIndex === RHS.length) &#123; /</span><span class="regexp">/ "$"</span></span><br><span class="line"><span class="regexp">        let LHS = getLHS(production);</span></span><br><span class="line"><span class="regexp">        if (LHS !== symbol) &#123; /</span><span class="regexp">/ To avoid cases like: B -&gt; aB</span></span><br><span class="line"><span class="regexp">          merge(follow, followOf(LHS, followSets, firstSets));</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      let followSymbol = RHS[followIndex];</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ Follow of our symbol is anything in the first of the following symbol:</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ followOf(symbol) is firstOf(followSymbol), except for epsilon.</span></span><br><span class="line"><span class="regexp">      let firstOfFollow = firstOf(followSymbol, firstSets);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ If there is no epsilon, just merge.</span></span><br><span class="line"><span class="regexp">      if (!firstOfFollow[EPSILON]) &#123;</span></span><br><span class="line"><span class="regexp">        merge(follow, firstOfFollow);</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      merge(follow, firstOfFollow, [EPSILON]);</span></span><br><span class="line"><span class="regexp">      followIndex++;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return follow;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function buildSet(builder, grammar, Sets, index) &#123;</span></span><br><span class="line"><span class="regexp">  for (let k in grammar) &#123;</span></span><br><span class="line"><span class="regexp">    builder(grammar[k][0], ...Sets);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 0 stand for first Set 1 stands for follow Set</span></span><br><span class="line"><span class="regexp">  return Sets[index];</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * Finds productions where a non-terminal is used. E.g., <span class="keyword">for</span> the</span><br><span class="line"> * symbol <span class="string">`S`</span> it finds production <span class="string">`(S + F)`</span>, and <span class="keyword">for</span> the symbol <span class="string">`F`</span></span><br><span class="line"> * it finds productions <span class="string">`F`</span> and <span class="string">`(S + F)`</span>.</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">function getProductionsWithSymbol(symbol) &#123;</span></span><br><span class="line"><span class="regexp">  let productionsWithSymbol = &#123;&#125;;</span></span><br><span class="line"><span class="regexp">  for (let k in grammar) &#123;</span></span><br><span class="line"><span class="regexp">    let production = grammar[k];</span></span><br><span class="line"><span class="regexp">    let RHS = getRHS(production);</span></span><br><span class="line"><span class="regexp">    if (RHS.indexOf(symbol) !== -1) &#123;</span></span><br><span class="line"><span class="regexp">      productionsWithSymbol[k] = production;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return productionsWithSymbol;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function isTerminal(symbol) &#123;</span></span><br><span class="line"><span class="regexp">  return !/</span>[A-Z]/.test(symbol);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">to, from, exclude</span>) </span>&#123;</span><br><span class="line">  exclude || (exclude = []);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> <span class="keyword">from</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (exclude.indexOf(k) === <span class="number">-1</span>) &#123;</span><br><span class="line">      to[k] = <span class="keyword">from</span>[k];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printGrammar</span>(<span class="params">grammar</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Grammar:\n'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> grammar) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'  '</span>, grammar[k]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printSet</span>(<span class="params">name, set</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name + <span class="string">': \n'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> set) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'  '</span>, k, <span class="string">':'</span>, <span class="built_in">Object</span>.keys(set[k]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Testing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Example 1 of a simple grammar, generates: a, or (a + a), etc.</span></span><br><span class="line"><span class="comment">// --------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grammar = &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">'S -&gt; F'</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">'S -&gt; (S + F)'</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">'F -&gt; a'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> START_SYMBOL = <span class="string">'S'</span>;</span><br><span class="line"></span><br><span class="line">printGrammar(grammar);</span><br><span class="line"></span><br><span class="line">printSet(<span class="string">'First sets'</span>, buildFirstSets(grammar, [&#123;&#125;]));</span><br><span class="line"></span><br><span class="line">printSet(<span class="string">'Follow sets'</span>, buildFollowSets(grammar, [buildFirstSets(grammar, [&#123;&#125;]),&#123;&#125;]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Grammar:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    S -&gt; F</span></span><br><span class="line"><span class="comment">//    S -&gt; (S + F)</span></span><br><span class="line"><span class="comment">//    F -&gt; a</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// First sets:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    S : [ 'a', '(' ]</span></span><br><span class="line"><span class="comment">//    F : [ 'a' ]</span></span><br><span class="line"><span class="comment">//    a : [ 'a' ]</span></span><br><span class="line"><span class="comment">//    ( : [ '(' ]</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Follow sets:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    S : [ '$', '+' ]</span></span><br><span class="line"><span class="comment">//    F : [ '$', '+', ')' ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Example 2 of a "calculator" grammar (with removed left recursion, which</span></span><br><span class="line"><span class="comment">// is replaced with a right recursion and epsilons), it generates language</span></span><br><span class="line"><span class="comment">// for e.g. (a + a) * a.</span></span><br><span class="line"><span class="comment">// --------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grammar = &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">'E -&gt; TX'</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">'X -&gt; +TX'</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">'X -&gt; Îµ'</span>,</span><br><span class="line">  <span class="number">4</span>: <span class="string">'T -&gt; FY'</span>,</span><br><span class="line">  <span class="number">5</span>: <span class="string">'Y -&gt; *FY'</span>,</span><br><span class="line">  <span class="number">6</span>: <span class="string">'Y -&gt; Îµ'</span>,</span><br><span class="line">  <span class="number">7</span>: <span class="string">'F -&gt; a'</span>,</span><br><span class="line">  <span class="number">8</span>: <span class="string">'F -&gt; (E)'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> START_SYMBOL = <span class="string">'E'</span>;</span><br><span class="line"></span><br><span class="line">printGrammar(grammar);</span><br><span class="line"></span><br><span class="line">printSet(<span class="string">'First sets'</span>, buildFirstSets(grammar, [&#123;&#125;]));</span><br><span class="line"></span><br><span class="line">printSet(<span class="string">'Follow sets'</span>, buildFollowSets(grammar, [buildFirstSets(grammar, [&#123;&#125;]),&#123;&#125;]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Results:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Grammar:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    E -&gt; TX</span></span><br><span class="line"><span class="comment">//    X -&gt; +TX</span></span><br><span class="line"><span class="comment">//    X -&gt; Îµ</span></span><br><span class="line"><span class="comment">//    T -&gt; FY</span></span><br><span class="line"><span class="comment">//    Y -&gt; *FY</span></span><br><span class="line"><span class="comment">//    Y -&gt; Îµ</span></span><br><span class="line"><span class="comment">//    F -&gt; a</span></span><br><span class="line"><span class="comment">//    F -&gt; (E)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// First sets:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    E : [ 'a', '(' ]</span></span><br><span class="line"><span class="comment">//    T : [ 'a', '(' ]</span></span><br><span class="line"><span class="comment">//    F : [ 'a', '(' ]</span></span><br><span class="line"><span class="comment">//    a : [ 'a' ]</span></span><br><span class="line"><span class="comment">//    ( : [ '(' ]</span></span><br><span class="line"><span class="comment">//    X : [ '+', 'Îµ' ]</span></span><br><span class="line"><span class="comment">//    + : [ '+' ]</span></span><br><span class="line"><span class="comment">//    Y : [ '*', 'Îµ' ]</span></span><br><span class="line"><span class="comment">//    * : [ '*' ]</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Follow sets:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    E : [ '$', ')' ]</span></span><br><span class="line"><span class="comment">//    X : [ '$', ')' ]</span></span><br><span class="line"><span class="comment">//    T : [ '+', '$', ')' ]</span></span><br><span class="line"><span class="comment">//    Y : [ '+', '$', ')' ]</span></span><br><span class="line"><span class="comment">//    F : [ '*', '+', '$', ')' ]</span></span><br></pre></td></tr></table></figure></p>
<p>ä»£ç éƒ¨åˆ†å‚è€ƒäº†<a href="https://github.com/DmitrySoshnikov" title="DmitrySoshnikov" target="_blank" rel="noopener">DmitrySoshnikov</a>çš„parser</p>
<h3 id="3-Reference"><a href="#3-Reference" class="headerlink" title="3 Reference"></a>3 Reference</h3><p><a href="compiler-design-first-in-syntax-analysis" title="https://www.geeksforgeeks.org/compiler-design-first-in-syntax-analysis/">compiler-design-first-in-syntax-analysis</a><br><a href="compiler-design-why-first-and-follow" title="https://www.geeksforgeeks.org/compiler-design-why-first-and-follow/">compiler-design-why-first-and-follow</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/09/01/jsys_12_summary/">è®¡ç®—çš„è¦ç´ ç¬¬åäºŒç« æ€»ç»“</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-09-01</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è®¡ç®—æœºä½“ç³»ç»“æ„/">è®¡ç®—æœºä½“ç³»ç»“æ„</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nand2tetris/">Nand2tetris</a>
			</span>
		
	</div>

	

	
		<p>æœ¬ç« æ˜¯é’ˆå¯¹Hack OSå„ä¸ªæ¨¡å—çš„æ¦‚è¿°åŠå…¶å®ç°ï¼Œå…¶ä¸­æŸå‡ ä¸ªæ¨¡å—å®ç°çš„ç®—æ³•å¾ˆæœ‰æ„æ€ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹å§~</p>
<h3 id="1-ä»€ä¹ˆæ˜¯OSï¼ˆä»¥Hack-OSä¸ºä¾‹ï¼‰"><a href="#1-ä»€ä¹ˆæ˜¯OSï¼ˆä»¥Hack-OSä¸ºä¾‹ï¼‰" class="headerlink" title="1 ä»€ä¹ˆæ˜¯OSï¼ˆä»¥Hack OSä¸ºä¾‹ï¼‰"></a>1 ä»€ä¹ˆæ˜¯OSï¼ˆä»¥Hack OSä¸ºä¾‹ï¼‰</h3><ol>
<li>ä»¥ä¸€ç§å¯¹è½¯ä»¶å‹å¥½çš„æ–¹å¼å°è£…äº†ä¸åŒçš„ç¡¬ä»¶æœåŠ¡</li>
<li>ç”¨ä¸åŒçš„å‡½æ•°å’ŒæŠ½è±¡æ•°æ®ç±»å‹æ‰©å±•äº†é«˜çº§è¯­è¨€ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šçš„æ“ä½œç³»ç»Ÿä¸è¯­è¨€çš„æ ‡å‡†ç¨‹åºåº“çš„åˆ†ç•Œçº¿å°±ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚äº‹å®ä¸Šï¼ŒæŸäº›ç°ä»£è¯­è¨€ï¼ˆä¾‹å¦‚Javaï¼‰å°±è¶‹å‘äºå°†å¾ˆå¤šç»å…¸çš„æ“ä½œç³»ç»ŸæœåŠ¡ï¼ˆæ¯”å¦‚GUIç®¡ç†ï¼Œå†…å­˜ç®¡ç†ï¼Œå’Œå¤šä»»åŠ¡å¤„ç†ç­‰ï¼‰è¿åŒå¾ˆå¤šè¯­è¨€æ‹“å±•ä¸€èµ·æ‰“åŒ…åˆ°å…¶æ ‡å‡†ç¨‹åºåº“ä¸­ï¼Œè¿™ä¹ˆåšçš„ç›®çš„ä»¥æˆ‘çš„ç†è§£æ˜¯ä¸ºäº†å±è”½ç³»ç»Ÿå±‚é¢çš„å·®å¼‚ï¼ˆæ¯”å¦‚Cçš„fopenç­‰ï¼‰ä»¥åŠå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼ˆæ¯”å¦‚Javaçš„å†…å­˜ç®¡ç†ï¼Œå‘å†…å­˜ç”³è¯·ä¸€å¤§ç‰‡ç©ºé—´ï¼ŒJava NIOç­‰ï¼‰</li>
</ol>
<h3 id="2-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦OS"><a href="#2-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦OS" class="headerlink" title="2 ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦OS"></a>2 ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦OS</h3><p>è®¡ç®—æœºæ˜¯ç”¨æ¥è§£å†³å®é™…é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„å»ºè®¡ç®—æœºç¡¬ä»¶ç”¨æ¥è®¡ç®—ï¼ŒåŸºäºç¡¬ä»¶æˆ‘ä»¬é€ äº†ç¼–è¯‘å™¨ç”¨æ¥å†™æ›´å¯è¯»çš„æ±‡ç¼–ç¨‹åºï¼Œç„¶åæœ‰äº†ç”¨æ±‡ç¼–ç¨‹åºå†™çš„åº”ç”¨ï¼Œéšç€åº”ç”¨ç¨‹åºè¶Šæ¥è¶Šåˆ°ï¼Œæˆ‘ä»¬éœ€è¦æŠ½è±¡å‡ºèƒ½å¤Ÿå°†æ§åˆ¶ï¼ˆç¡¬ä»¶å’Œå¤–å›´è®¾å¤‡ä»¥åŠè½¯ä»¶ï¼‰å’Œåˆ†é…èµ„æºçš„å¸¸ç”¨åŠŸèƒ½é›†ä¸€ä½“çš„æ¦‚å¿µï¼Œå®ƒå°±æ˜¯Operating Systemï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ã€‚ï¼ˆæœ‰æ—¶é—´å»ç ”ç©¶ç ”ç©¶å‘å‡ºæ¥ï¼‰<br>è®¡ç®—æœºç³»ç»Ÿçš„åŸºæœ¬ç›®æ ‡æ˜¯æ‰§è¡Œç”¨æˆ·ç¨‹åºå¹¶ä»¥æ›´å®¹æ˜“çš„æ–¹å¼è§£å†³ç”¨æˆ·çš„é—®é¢˜ã€‚</p>
<h3 id="3-æ•°å­¦æ“ä½œ"><a href="#3-æ•°å­¦æ“ä½œ" class="headerlink" title="3 æ•°å­¦æ“ä½œ"></a>3 æ•°å­¦æ“ä½œ</h3><p>é¦–å…ˆï¼Œè¿™é‡Œæ˜ç¡®çš„å‘Šè¯‰äº†æˆ‘ä¸‹æ„è¯†æƒ³åˆ°çš„é€šè¿‡ç´¯åŠ å’Œç´¯å‡æ¥å®ç°ä¹˜é™¤æ³•æ¥æ“ä½œç³»ç»Ÿå±‚é¢æ˜¯ä¸å¯è¡Œçš„ï¼ŒåŸå› å¾ˆç®€å•ï¼Œæ•ˆç‡å¤ªä½äº†é«˜è¾¾Oï¼ˆnï¼‰çš„è¾“å…¥æ•æ„Ÿå¤æ‚åº¦ä¼šè®©è®¡ç®—ä¸€ä¸ª100000000000000*10000000000000çš„äººåœ¨å‡³å­ä¸Šåä¸Šå‡ å¤©ï¼ˆåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œæ•°æ®ä¸å…·å¤‡ä»£è¡¨æ€§ï¼‰ï¼Œé‚£ä¹ˆå°±è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹Hack OSçš„åšæ³•</p>
<font color="red">æ³¨ï¼šä»¥ä¸‹æ‰€æœ‰è¿ç®—éƒ½å‡å®šæ“ä½œæ•°ä¸º16ä½ï¼ˆHaclç¡¬ä»¶è§„èŒƒå­—é•¿16ä½ï¼‰</font>

<h4 id="3-1-ä¹˜æ³•"><a href="#3-1-ä¹˜æ³•" class="headerlink" title="3.1 ä¹˜æ³•"></a>3.1 ä¹˜æ³•</h4><p><img src="/images/jsys_12/ä¹˜æ³•.jpg" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>,index = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y.toString(<span class="number">2</span>).padStart(<span class="number">16</span>,<span class="string">"0"</span>).charAt(index) !== <span class="string">"0"</span>) &#123;</span><br><span class="line">        	<span class="built_in">console</span>.log(y, index,y.toString(<span class="number">2</span>).padStart(<span class="number">16</span>,<span class="string">"0"</span>));</span><br><span class="line">             sum = sum + x;</span><br><span class="line">        &#125;</span><br><span class="line">        x = x + x;</span><br><span class="line">       index = index - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å®é™…ä¸Šä¹˜æ³•å°±æ˜¯åœ¨æ¨¡æ‹Ÿæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ä¹˜æ³•ï¼Œé€šè¿‡é€ä½ç›¸ä¹˜ï¼Œå¹¶ä¸”å†æ¯ä¸€æ¬¡ä¹˜å®Œä»¥åå°†è¢«ä¹˜æ•°å·¦ç§»ä¸€ä½ï¼Œè¿­ä»£è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°éå†å®Œæ‰€æœ‰ä½æ•°ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬çœ‹åˆ°æŸä¸ªç®—æœ¯53*20ï¼Œå½“æˆ‘ä»¬å¤„ç†å®Œ5è¿™ä¸€ä½ä¸ä¼šå†ç”¨0å»ä¹˜20ï¼Œä½†æ˜¯åœ¨è®¡ç®—æœºä¸­ä½ éœ€è¦ä¸€å¥—è§„åˆ™å»è¿ç®—ï¼Œè¿™å¥—è§„åˆ™åœ¨è¿™é‡Œå°±æ˜¯éå†å®Œæ“ä½œæ•°çš„æ‰€æœ‰ä½ï¼Œå³ä¾¿å®ƒå…¨æ˜¯0ã€‚</p>
<h4 id="3-2-é™¤æ³•"><a href="#3-2-é™¤æ³•" class="headerlink" title="3.2 é™¤æ³•"></a>3.2 é™¤æ³•</h4><p><img src="/images/jsys_12/é™¤æ³•.jpg" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">divide</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> q,result,flag;</span><br><span class="line"></span><br><span class="line">    flag = !((x &lt; <span class="number">0</span>) ^ (y &lt; <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    x = <span class="built_in">Math</span>.abs(x);</span><br><span class="line">    y = <span class="built_in">Math</span>.abs(y);</span><br><span class="line">    <span class="keyword">if</span>(y &gt; x) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    q = divide(x,y + y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x - (<span class="number">2</span> * q * y) &lt; y) &#123;</span><br><span class="line">        result = q + q;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = q + q + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flag ? result : -result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ€è·¯ä¹Ÿæ˜¯æ¨¡ä»¿äººé™¤æ³•çš„è¿‡ç¨‹ï¼Œé€‰æ‹©ä¸€ä¸ªå°½å¯èƒ½ä»xä¸Šå‡å»yçš„æœ€å¤§å€æ•°ï¼ˆå‡å®šç®—å¼x/yï¼‰ï¼Œç›´åˆ°yæ¯”xå¤§ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„é€’å½’å½¢å¼å¦‚ä¸Šã€‚</p>
<h4 id="3-3-å¹³æ–¹æ ¹"><a href="#3-3-å¹³æ–¹æ ¹" class="headerlink" title="3.3 å¹³æ–¹æ ¹"></a>3.3 å¹³æ–¹æ ¹</h4><p><img src="/images/jsys_12/äºŒå‰æ ‘.jpg" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqrt</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> y,j,temp,tempQ;</span><br><span class="line"></span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(j &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">      temp = y + <span class="built_in">Math</span>.pow(<span class="number">2</span>,j);</span><br><span class="line">      tempQ = temp * temp;</span><br><span class="line">      <span class="comment">//avoid overflow</span></span><br><span class="line">      <span class="keyword">if</span>((tempQ &lt;= x) &amp; (tempQ &gt; <span class="number">0</span>))&#123;</span><br><span class="line">        y = temp;</span><br><span class="line">      &#125;</span><br><span class="line">      j = j - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç®—æ³•å°±æ˜¯æ ¹æ®yÂ²&lt;= x &lt;(y+1)Â²ï¼Œä½¿å¾—yä»0å¼€å§‹é€æ­¥é€¼è¿‘xä½¿å¾—yæ»¡è¶³ä¸Šè¿°åŒºé—´</p>
<h3 id="4-å†…å­˜ç®¡ç†"><a href="#4-å†…å­˜ç®¡ç†" class="headerlink" title="4 å†…å­˜ç®¡ç†"></a>4 å†…å­˜ç®¡ç†</h3><p>å†…å­˜ç®¡ç†å¾ˆæœ‰è¶£ï¼Œé¦–å…ˆè¯´ä¸€è¯´å†…å­˜ç®¡ç†çš„èƒŒæ™¯</p>
<h4 id="4-1-èƒŒæ™¯"><a href="#4-1-èƒŒæ™¯" class="headerlink" title="4.1 èƒŒæ™¯"></a>4.1 èƒŒæ™¯</h4><p>è®¡ç®—æœºçš„ç¨‹åºä¼šå£°æ˜å¹¶ä½¿ç”¨å„ç§ç±»å‹çš„å˜é‡ï¼ŒåŒ…æ‹¬æ•´æ•°ã€å¸ƒå°”æ•°ç­‰ç®€å•çš„æ•°æ®ç±»å‹ä»¥åŠå¦‚æ•°ç»„ã€å¯¹è±¡ç­‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚é«˜çº§è¯­è¨€çš„æœ€å¤§ä¼˜ç‚¹ä¹‹ä¸€æ˜¯ç¨‹åºå‘˜ä¸å¿…å…³å¿ƒå†…å­˜ç®¡ç†ç»†èŠ‚ï¼šæ¯”å¦‚ä¸ºå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼›ä»¥åŠå½“è¯¥å˜é‡ä¸å†ä½¿ç”¨æ—¶ï¼Œå›æ”¶ä¸ºå…¶åˆ†é…çš„å†…å­˜ç©ºé—´ã€‚æ‰€æœ‰å…³äºå†…å­˜ç®¡ç†çš„çç¢å·¥ä½œéƒ½ç”±ç¼–è¯‘å™¨ã€æ“ä½œç³»ç»Ÿå’Œè™šæ‹Ÿæœºåœ¨åç«¯å®Œæˆã€‚<br>ä¸åŒçš„å˜é‡çš„å†…å­˜åœ¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸åŒæ—¶åˆ»è¢«åˆ†é…ã€‚ä¾‹å¦‚ï¼Œ<strong>é™æ€å˜é‡</strong>åœ¨ç¼–è¯‘æœŸé—´ç”±ç¼–è¯‘å™¨ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œè€Œ<strong>å±€éƒ¨å˜é‡</strong>åˆ™åœ¨æ¯ä¸ªå­ç¨‹åºå¼€å§‹è¿è¡Œæ—¶è¢«åˆ†é…åœ¨å †æ ˆå†…ã€‚å…¶ä»–å˜é‡çš„å†…å­˜åˆ™æ˜¯åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«åŠ¨æ€åˆ†é…ï¼Œè¿™æ—¶å€™OSå°±è¦ä¸Šäº†ã€‚<font color="red">æ³¨æ„æ“ä½œç³»ç»Ÿæœ¬èº«å¹¶ä¸è‡ªå¸¦åƒåœ¾å›æ”¶åŠŸèƒ½ï¼Œè¿™æ˜¯é«˜çº§è¯­è¨€æä¾›çš„å†…å­˜ç®¡ç†æ‰‹æ®µï¼Œæ¯”å¦‚Javaï¼ŒJVMå…ˆå‘OSè¯·æ±‚ä¸€å¤§å—å†…å­˜ç”¨äºç¨‹åºè¿è¡Œï¼Œç„¶ååœ¨è¿™å—å†…å­˜ä¸­å¯ä»¥â€œè‡ªåŠ¨å†…å­˜ç®¡ç†â€ï¼Œæœ¬è´¨æ˜¯åœ¨OSå±‚é¢ä¹‹ä¸Šè¿›è¡Œå†…å­˜ç®¡ç†ï¼Œè¿™æ ·å°±ä¸ç”¨é¢‘ç¹çš„è°ƒç”¨ç³»ç»Ÿçš„mallocï¼Œfreeäº†</font></p>
<p>åœ¨OSçœ‹æ¥å†…å­˜å…¶å®å°±æ˜¯ä¸€å—å¤§æ•°ç»„ï¼ˆbig bufferï¼‰ï¼Œå½“ç„¶çœŸå®çš„å†…å­˜å®ç°æˆ‘ä»¬å·²ç»åœ¨ä¹‹å‰çœ‹åˆ°è¿‡äº†(å¤šä¸ªRegister-&gt;å¤šä¸ªRAM-&gt;Memory)ã€‚</p>
<h4 id="4-2-å†…å­˜ç®¡ç†ç®—æ³•"><a href="#4-2-å†…å­˜ç®¡ç†ç®—æ³•" class="headerlink" title="4.2 å†…å­˜ç®¡ç†ç®—æ³•"></a>4.2 å†…å­˜ç®¡ç†ç®—æ³•</h4><h5 id="4-2-1-alloc"><a href="#4-2-1-alloc" class="headerlink" title="4.2.1 alloc"></a>4.2.1 alloc</h5><p><img src="/images/jsys_12/malloc.jpg" alt=""><br>ä¸Šå›¾çš„freeListçš„èŠ‚ç‚¹ä¹çœ‹å¯èƒ½æœ‰ç‚¹ç–‘æƒ‘ï¼Œå…¶å®è¿™é‡Œçš„freeListæ˜¯ç»å†è¿‡deAllocçš„ï¼Œä¸€å¼€æ˜¯freeListåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æ•´å—å†…å­˜åŒºï¼Œç„¶åéšç€alloc-deAllocï¼Œé“¾è¡¨èŠ‚ç‚¹é€æ¸å¢å¤šï¼Œç¢ç‰‡åŒ–ä¹Ÿè¶Šæ¥è¶Šä¸¥é‡â€¦</p>
<h5 id="4-2-2-deAlloc"><a href="#4-2-2-deAlloc" class="headerlink" title="4.2.2 deAlloc"></a>4.2.2 deAlloc</h5><p><img src="/images/jsys_12/delloc.jpg" alt=""><br>deAllocçš„ç®—æ³•å…¶å®å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š<br>å‡è®¾å¾…é‡Šæ”¾èŠ‚ç‚¹å€¼ä¸ºo</p>
<ol>
<li>æ‰¾åˆ°freeListä¸­èŠ‚ç‚¹çš„åœ°å€å€¼æ¯”å¾…é‡Šæ”¾èŠ‚ç‚¹å€¼å¤§çš„èŠ‚ç‚¹ï¼ˆAï¼‰</li>
<li>å°†å¾…é‡Šæ”¾çš„èŠ‚ç‚¹çš„nextåŸŸè®¾ä¸ºAçš„åœ°å€<br>3.å°†Açš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextåŸŸè®¾ä¸ºo</li>
</ol>
<p>ç„¶è€Œæˆ‘åˆšå¼€å§‹çš„åšæ³•æ˜¯ï¼š</p>
<ol>
<li>å°†oçš„nextåŸŸè®¾ä¸ºfreeListæŒ‡å‘çš„èŠ‚ç‚¹</li>
<li>ä¿®æ”¹freeListæŒ‡å‘oçš„åœ°å€ï¼ˆè¿™å’Œä¸Šå›¾Markçš„åšæ³•æœ‰ç‚¹å‡ºè·¯ï¼Œä¸ªäººè§‰å¾—è¿™æ ·å¤´æ’æ•ˆç‡æ¯”æ ¹æ®Addressæ¥çš„é«˜ä¸”ç®€å•ï¼‰<br>å½“ç„¶æˆ‘æ‰€è°“çš„ä¼˜äºï¼Œæ˜¯å»ºç«‹åœ¨æ²¡æœ‰åˆå¹¶çš„åŸºç¡€ä¸Šçš„â€¦</li>
</ol>
<h5 id="4-2-3-defragmentationï¼ˆç¢ç‰‡åˆå¹¶ï¼‰"><a href="#4-2-3-defragmentationï¼ˆç¢ç‰‡åˆå¹¶ï¼‰" class="headerlink" title="4.2.3 defragmentationï¼ˆç¢ç‰‡åˆå¹¶ï¼‰"></a>4.2.3 defragmentationï¼ˆç¢ç‰‡åˆå¹¶ï¼‰</h5><p>ç»†å¿ƒçš„è¯»è€…å·²ç»å‘ç°äº†ï¼Œä¸Šå›¾ä¸­è¿˜åŒ…å«è¿™ç¢ç‰‡åˆå¹¶çš„åŠ¨ä½œï¼Œè¿™ä¸ªç¢ç‰‡åˆå¹¶çš„åŠ¨ä½œå¦‚æœé“¾è¡¨ä¸æ˜¯æ ¹æ®addressæœ‰åºçš„è¯å¤æ‚åº¦æ˜¯Oï¼ˆnÂ²ï¼‰çº§åˆ«çš„ï¼Œè¿™å¸¦æ¥çš„ç›´æ¥åæœå°±æ˜¯ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„ç¨‹åºå…³çš„è¿™ä¹ˆæ…¢ã€‚ã€‚ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨deAllocçš„æ—¶å€™è¦ç”¨ç¬¬ä¸€ä¸ªç®—æ³•çš„åŸå› å°±æ˜¯å¦‚æ­¤ã€‚</p>
<p>defragmentationç®—æ³•å¦‚ä¸‹ï¼š<br>1.éå†é“¾è¡¨<br>2.å¦‚æœå½“å‰èŠ‚ç‚¹çš„åœ°å€å€¼+size+1ï¼ˆå­˜å‚¨sizeçš„å­˜å‚¨å•å…ƒï¼‰ = ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œmerge</p>
<h3 id="5-è¾“å…¥è¾“å‡ºç®¡ç†"><a href="#5-è¾“å…¥è¾“å‡ºç®¡ç†" class="headerlink" title="5 è¾“å…¥è¾“å‡ºç®¡ç†"></a>5 è¾“å…¥è¾“å‡ºç®¡ç†</h3><p>è¿™éƒ¨åˆ†æˆ‘å°±è¯´ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åœ°æ–¹</p>
<h4 id="5-1-è¾“å‡º"><a href="#5-1-è¾“å‡º" class="headerlink" title="5.1 è¾“å‡º"></a>5.1 è¾“å‡º</h4><h5 id="5-1-1-ç»˜åˆ¶ä¸‰è§’å½¢"><a href="#5-1-1-ç»˜åˆ¶ä¸‰è§’å½¢" class="headerlink" title="5.1.1 ç»˜åˆ¶ä¸‰è§’å½¢"></a>5.1.1 ç»˜åˆ¶ä¸‰è§’å½¢</h5><p><img src="/images/jsys_12/sanjiao.jpg" alt=""><br>è¿™é‡Œè¯´ç»˜åˆ¶ä¸‰è§’å½¢ï¼Œä¸å¦‚è¯´å¦‚ä½•æ¨¡æ‹Ÿä¸‰è§’å½¢ï¼Œå®é™…ä¸Šæˆ‘ä»¬ç”»å‡ºçš„ä¸‰è§’å½¢æ˜¯ä»¥å †ç Œä¸€ä¸ªä¸ªåƒç´ å½¢æˆçš„ï¼Œå¯ä»¥æŠŠåƒç´ çœ‹å‡º3*1çš„æ­£æ–¹å½¢ï¼Œè€Œç»˜åˆ¶ä¸‰è§’å½¢çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å¦‚ä½•å †ç Œæ­£æ–¹å½¢è®©å®ƒæ›´åƒä¸‰è§’å½¢ï¼Œä¸‹é¢æ˜¯è¿‡ç¨‹å›¾ç¤º<br><img src="/images/jsys_12/sanjiaoxing.png" alt=""></p>
<p><strong>å›¾ä¸­æœ€å…³é”®çš„ä¸€ç‚¹åœ¨äº    å½“å‰çš„åæ ‡æ–œç‡&lt;=(y2-y1)/(x2-x1),a++ï¼Œå¦åˆ™b++</strong></p>
<h5 id="5-1-2-ç»˜åˆ¶åœ†"><a href="#5-1-2-ç»˜åˆ¶åœ†" class="headerlink" title="5.1.2 ç»˜åˆ¶åœ†"></a>5.1.2 ç»˜åˆ¶åœ†</h5><p><img src="/images/jsys_12/circle.jpg" alt=""><br>ç»˜åˆ¶åœ†çš„æœ¬è´¨å°±æ˜¯ç»˜åˆ¶ä¸€ç³»åˆ—çš„çŸ©å½¢ï¼Œç®—æ³•å¦‚ä¸Š</p>
<h4 id="5-2-è¾“å…¥"><a href="#5-2-è¾“å…¥" class="headerlink" title="5.2 è¾“å…¥"></a>5.2 è¾“å…¥</h4><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æè¿°æ“ä½œç³»ç»Ÿå¦‚ä½•åœ¨ä¸‰ä¸ªé€’å¢çš„æŠ½è±¡å±‚çº§ä¸Šæ¥ç®¡ç†é¢å‘æ–‡æœ¬çš„è¾“å…¥ï¼š</p>
<ol>
<li>æ•è·å•å­—ç¬¦è¾“å…¥</li>
<li>æ•è·å¤šå­—ç¬¦è¾“å…¥</li>
<li>æ•è·å¤šå­—ç¬¦è¾“å…¥ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼‰</li>
</ol>
<h5 id="5-2-1-ä¾¦æµ‹é”®ç›˜è¾“å…¥"><a href="#5-2-1-ä¾¦æµ‹é”®ç›˜è¾“å…¥" class="headerlink" title="5.2.1 ä¾¦æµ‹é”®ç›˜è¾“å…¥"></a>5.2.1 ä¾¦æµ‹é”®ç›˜è¾“å…¥</h5><p><img src="/images/jsys_12/keyboard.jpg" alt=""><br>åœ¨åº•å±‚æ•è·é”®ç›˜è¾“å…¥æ—¶ï¼Œç¨‹åºç›´æ¥ä»ç¡¬ä»¶è·å–æ•°æ®ï¼Œå¹¶ç¡®å®šç”¨æˆ·å½“å‰æŒ‰ä¸‹å“ªä¸ªé”®ã€‚å¯¹è¯¥åŸå§‹æ•°æ®çš„è®¿é—®ä¾èµ–äºé”®ç›˜æ¥å£çš„å…·ä½“ç‰¹æ€§ã€‚æ¯”å¦‚ï¼Œè‹¥æ¥å£æ˜¯è¢«é”®ç›˜æŒç»­æ›´æ–°çš„å†…å­˜æ˜ åƒï¼ˆæ¯”å¦‚Hackï¼‰ï¼Œå°±å¯ä»¥é€šè¿‡æ£€æµ‹å¯¹åº”çš„å†…å­˜æ˜ åƒæ¥ç¡®å®šæŒ‰ä¸‹äº†å“ªä¸ªé”®</p>
<h5 id="5-2-2-è¯»å–å•ä¸€å­—ç¬¦"><a href="#5-2-2-è¯»å–å•ä¸€å­—ç¬¦" class="headerlink" title="5.2.2 è¯»å–å•ä¸€å­—ç¬¦"></a>5.2.2 è¯»å–å•ä¸€å­—ç¬¦</h5><p><img src="/images/jsys_12/readchar.jpg" alt=""></p>
<h5 id="5-2-3-è¯»å–å­—ç¬¦ä¸²"><a href="#5-2-3-è¯»å–å­—ç¬¦ä¸²" class="headerlink" title="5.2.3 è¯»å–å­—ç¬¦ä¸²"></a>5.2.3 è¯»å–å­—ç¬¦ä¸²</h5><p><img src="/images/jsys_12/readLine.jpg" alt=""></p>
<p><strong>å…¶ä»–æ¨¡å—Stringï¼ŒArrayï¼ŒOutputï¼ŒSysæ˜¯åœ¨ä»¥ä¸Šæ¨¡å—ä¸Šçš„å°è£…ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚å°±å‚è€ƒä¹¦å§ã€‚</strong></p>
<h3 id="6-Q-amp-A"><a href="#6-Q-amp-A" class="headerlink" title="6 Q&amp;A"></a>6 Q&amp;A</h3><p>Qï¼šå…³äºå¹³æ–¹æ ¹ç®—æ³•æœ‰æ›´é«˜æ•ˆçš„ç®—æ³•å—ï¼Ÿ<br>Aï¼šé™¤äº†ä¹¦ä¸­æåˆ°çš„ç‰›é¡¿æ³•æ±‚å¹³æ–¹æ ¹ï¼ˆä¸åŠ¨ç‚¹ç®—æ³•ï¼‰ï¼Œæ³°å‹’å±•å¼€ï¼Œ<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/A-more-efficient-square-root-algorithm-td4028140.htmla" title="è¿™é‡Œ" target="_blank" rel="noopener">è¿™é‡Œ</a>å®ç°äº†ä¸€ä¸ªé•¿é™¤æ³•çš„å®ç°ï¼Œé™¤äº†å¹³æ–¹æ ¹ç®—æ³•ï¼Œä¹¦ä¸­å¯¹äºåœ†çš„ç»˜åˆ¶ä¹Ÿæœ‰<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Fast-circle-algorithm-td4030808.html" title="æ›´é«˜æ•ˆçš„ç®—æ³•" target="_blank" rel="noopener">æ›´é«˜æ•ˆçš„ç®—æ³•</a></p>
<h3 id="7-Reference"><a href="#7-Reference" class="headerlink" title="7 Reference"></a>7 Reference</h3><p><a href="http://sites.google.com/site/johnkennedyshome/home/downloadable-papers/bcircle.pdf" title="ç”¨äºç»˜åˆ¶åœ†çš„å¿«é€ŸBresenhamå‹ç®—æ³•ï¼ŒJohn Kennedy" target="_blank" rel="noopener">ç”¨äºç»˜åˆ¶åœ†çš„å¿«é€ŸBresenhamå‹ç®—æ³•ï¼ŒJohn Kennedy</a><br><a href="https://sites.google.com/site/johnkennedyshome/home/downloadable-papers/bcircle.pdf?attredirects=0" title="ç”¨äºç»˜åˆ¶æ¤­åœ†çš„å¿«é€ŸBresenhamå‹ç®—æ³•ï¼ŒJohn Kennedy" target="_blank" rel="noopener">ç”¨äºç»˜åˆ¶æ¤­åœ†çš„å¿«é€ŸBresenhamå‹ç®—æ³•ï¼ŒJohn Kennedy</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/08/31/iterator-00/">è¿­ä»£å™¨å®ç°ï¼ˆé›¶ï¼‰</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-08-31</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Jason-Tomasçš„é€ è½®å­ä¹‹æ—…/">Jason Tomasçš„é€ è½®å­ä¹‹æ—…</a>
			</span>
		
	</div>

	

	
		<h3 id="1-è¿­ä»£å™¨æ˜¯ä»€ä¹ˆ"><a href="#1-è¿­ä»£å™¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="1 è¿­ä»£å™¨æ˜¯ä»€ä¹ˆ"></a>1 è¿­ä»£å™¨æ˜¯ä»€ä¹ˆ</h3><p>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œè¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä½¿ç¨‹åºå‘˜èƒ½å¤Ÿéå†å®¹å™¨ï¼Œç‰¹åˆ«æ˜¯åˆ—è¡¨ã€‚é€šå¸¸é€šè¿‡å®¹å™¨çš„æ¥å£æä¾›å„ç§ç±»å‹çš„è¿­ä»£å™¨ã€‚è™½ç„¶ç»™å®šè¿­ä»£å™¨çš„æ¥å£å’Œè¯­ä¹‰æ˜¯å›ºå®šçš„ï¼Œä½†è¿­ä»£å™¨é€šå¸¸æ˜¯æ ¹æ®å®¹å™¨å®ç°çš„åº•å±‚ç»“æ„å®ç°çš„ï¼Œå¹¶ä¸”é€šå¸¸ç´§å¯†è€¦åˆåˆ°å®¹å™¨ä»¥å¯ç”¨è¿­ä»£å™¨çš„æ“ä½œè¯­ä¹‰ã€‚è¿­ä»£å™¨æ‰§è¡Œéå†å¹¶ä¸”è¿˜å…è®¸è®¿é—®å®¹å™¨ä¸­çš„æ•°æ®å…ƒç´ ï¼Œä½†æœ¬èº«ä¸æ‰§è¡Œè¿­ä»£ï¼ˆå³ï¼Œå¹¶éæ²¡æœ‰é‡‡ç”¨è¯¥æ¦‚å¿µæˆ–ä½¿ç”¨æœ¯è¯­çš„è½»å¾®è‡ªç”±ï¼‰ã€‚è¿­ä»£å™¨åœ¨è¡Œä¸ºä¸Šç±»ä¼¼äºæ•°æ®åº“æ¸¸æ ‡ã€‚è¿­ä»£å™¨å¯ä»¥è¿½æº¯åˆ°1974å¹´çš„CLUç¼–ç¨‹è¯­è¨€ã€‚</p>
<h3 id="2-ä¸ºä»€ä¹ˆä¼šéœ€è¦è¿­ä»£å™¨ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆä¼šéœ€è¦è¿­ä»£å™¨ï¼Ÿ" class="headerlink" title="2 ä¸ºä»€ä¹ˆä¼šéœ€è¦è¿­ä»£å™¨ï¼Ÿ"></a>2 ä¸ºä»€ä¹ˆä¼šéœ€è¦è¿­ä»£å™¨ï¼Ÿ</h3><ol>
<li>ä¾¿äºæ•°æ®æµçš„æ§åˆ¶ï¼Œå‡å®šæœ‰ä¸€ä¸ªæ•°æ®æµï¼Œè¿™æ—¶å¦‚æœæœ‰è¿­ä»£å™¨å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œè¿™ä¸ªæ•°æ®æµï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠè¿­ä»£å™¨ç†è§£ä¸ºå»¶æ—¶æ±‚å€¼ï¼ˆlazy evalï¼‰å•¦</li>
<li>è§£è€¦ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ä½ æƒ³æ‰¾åˆ°æ ‘ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæŸ¥æ‰¾ç®—æ³•ï¼Œä¼ å…¥ä¸€ä¸ªæ ‘å¯¹è±¡å’ŒæŸ¥æ‰¾æ¡ä»¶ï¼Œéå†æ ‘è¿›è¡ŒåŒ¹é…ï¼Œè€Œæ‹¥æœ‰è¿­ä»£å™¨ä¹‹åï¼Œä½ åªéœ€ä¸åœçš„nextç›´åˆ°è¿­ä»£å™¨æœ«å°¾ï¼Œå¤§å¤§å¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ï¼ˆæ¯•ç«Ÿæ˜¯çº¿æ€§çš„ï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è¿­ä»£å™¨å‰</span></span><br><span class="line">select(node, condition,result) &#123;</span><br><span class="line">	<span class="keyword">if</span> (node) &#123;</span><br><span class="line">		<span class="keyword">if</span>(node.left !== <span class="string">''</span>) &#123;</span><br><span class="line">			select(node.left);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (condition(node.value)) &#123;</span><br><span class="line">			result.push(node.value);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(node.right !== <span class="string">''</span>) &#123;</span><br><span class="line">			select(node.right);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è¿­ä»£å™¨å,å¯è¯»æ€§å¢å¼ºäº†</span></span><br><span class="line">select(treeIterator, conditionï¼Œ result) &#123;</span><br><span class="line">	<span class="keyword">for</span>(treeNode <span class="keyword">of</span> treeIterator) &#123; <span class="comment">// å‡å®šè¿™é‡Œfor ofè°ƒç”¨è¿­ä»£å™¨ï¼Œäº‹å®ä¸Šåœ¨JSä¸­ä¹Ÿç¡®å®å¦‚æ­¤</span></span><br><span class="line">		<span class="keyword">if</span>(condition(treeNode)) &#123;</span><br><span class="line">			result.push(treeNode);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶çº¿æ€§çš„ä»£ç æ›´å¯è¯»ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—é€’å½’çš„ä»£ç çœŸçš„å¾ˆç¾â€¦æˆ‘ä¸ªäººåœ¨å¯ä»¥é€’å½’çš„æ¡ä»¶ä¸‹æ˜¯ä¸ä¼šå»å†™è¿­ä»£çš„ï¼ˆé™¤äº†æ•ˆç‡é™åˆ¶ï¼‰ï¼Œä¸è¿‡ç°åœ¨éƒ¨åˆ†ç¼–è¯‘å™¨æ”¯æŒTail call optimizationï¼Œè™½ç„¶JavaScriptæ²¡æœ‰ï¼Œä½†æ˜¯ä½ å¯ä»¥å°†ä»»ä½•é€’å½’ç”¨é»‘é­”æ³• Trampolineè½¬åŒ–ä¸ºå½¢å¼ä¸Šçš„å°¾é€’å½’~</p>
<h3 id="3-å®ç°è¿­ä»£å™¨"><a href="#3-å®ç°è¿­ä»£å™¨" class="headerlink" title="3 å®ç°è¿­ä»£å™¨"></a>3 å®ç°è¿­ä»£å™¨</h3><p>è¿­ä»£å™¨çš„æœ¬è´¨æ˜¯å»¶è¿Ÿæ±‚å€¼æˆ–è€…è¯´éƒ¨åˆ†æ±‚å€¼ï¼ˆä»¤æˆ‘æƒ³åˆ°äº†SICPçš„æµæ¨¡å‹ï¼‰ï¼Œé‚£ä¹ˆç”±äºä¼ ç»Ÿçš„ç¨‹åºæ‰§è¡Œæ¯”å¦‚é€’å½’ï¼Œä½ æ˜¯æ— æ³•æ§åˆ¶ç¨‹åºçš„æ§åˆ¶æµçš„ï¼Œæ‹¿ä¹‹å‰çš„é€’å½’éå†æ ‘çš„ä¾‹å­æ¥çœ‹ï¼Œä½ æ— æ³•åœ¨å®ƒéå†åˆ°æŸä¸ªå­æ ‘ï¼ˆè¿™æ—¶è¿™ä¸ªå­æ ‘çš„å·¦å³èŠ‚ç‚¹è¿˜å­˜åœ¨ï¼‰çš„æƒ…å†µä¸‹é©¬ä¸Šå›åˆ°æ ¹èŠ‚ç‚¹çš„ï¼Œè¿™æ˜¯å› ä¸ºå—é™äºå‡½æ•°çš„è°ƒç”¨æ ˆï¼Œå½“ç„¶ä½ å¯ä»¥é€šè¿‡cpså˜æ¢æ¥æ‰‹åŠ¨æ§åˆ¶ä½ çš„ä»£ç ï¼Œè¿™æ˜¯å¦å¤–ä¸€å›äº‹ï¼Œè¿™é‡Œæš‚ä¸äºˆå±•å¼€ã€‚æ—¢ç„¶æˆ‘ä»¬ä¸èƒ½æ§åˆ¶å‡½æ•°è°ƒç”¨æ ˆï¼Œé‚£æˆ‘ä»¬å°±ä¸€ä¸åšäºŒä¸ä¼‘çš„è‡ªå·±åˆ›å»ºæ ˆæ¥æ¨¡æ‹Ÿä¹‹å‰çš„éå†å‡½æ•°è¿è¡Œï¼Œè¿™æ ·ä»£ç å°±åœ¨æˆ‘ä»¬çš„æŒæ§ä¸‹äº†ï¼ˆåŸºäºæ ˆçš„ç¨‹åºæ§åˆ¶å…¶å®ä½“ç°ç€æ ˆå¼è™šæ‹Ÿæœºçš„æ€æƒ³ï¼Œé€šè¿‡pushå’Œpopæ¥æ§åˆ¶â€è®¡ç®—â€ï¼Œè€ŒCPSå˜æ¢æ›´å¤šçš„ä½“ç°çš„æ˜¯ç»­ç®—ï¼ˆcontinuationï¼‰çš„ä¼ é€’ï¼ŒPLçš„é­”æ³•å•¦ï¼‰</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ï¼ŒåŸºäºæ ˆçš„éé€’å½’éå†å®ç°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäºæ ˆçš„éé€’å½’æŸ¥è¯¢ç®—æ³•çš„å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inorder_tarverse_nonrecursive</span>(<span class="params">node,condition,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">		<span class="comment">// å‹å…¥æ‰€æœ‰å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			stack.push(node);</span><br><span class="line">			node = node.left;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Popå‡ºå·¦å­èŠ‚ç‚¹ï¼Œè¿›å…¥å³å­èŠ‚ç‚¹æˆ–è€…è¿”å›çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">			<span class="keyword">let</span> top = stack.pop();</span><br><span class="line">			<span class="keyword">if</span> (condition(top)) &#123;</span><br><span class="line">				result.push(top.value);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (top.right) &#123;</span><br><span class="line">				node = top.right;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// æ­¤æ—¶æ ¹èŠ‚ç‚¹å’Œæ ¹ä¸­æ‰€æœ‰å·¦å­èŠ‚ç‚¹å·²ç»éå†å®Œæ¯•</span></span><br><span class="line">			<span class="keyword">if</span> (stack.length === <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// éå†å®Œæ¯•æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">if</span> (stack.length === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œç»™å‡ºé€’å½’å®ç°ä»¥åšå¯¹æ¯”<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inorder_traverse</span>(<span class="params">node,condition,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (node) &#123;</span><br><span class="line">		inorder_traverse(node.left);</span><br><span class="line">		<span class="keyword">if</span> (condition(node.value)) &#123;</span><br><span class="line">			result.push(result);</span><br><span class="line">		&#125;;</span><br><span class="line">		inorder_traverse(node.right);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€’å½’çš„è°ƒç”¨æ ˆå’Œéé€’å½’æ¨¡æ‹Ÿçš„ç¨‹åºæ ˆå¯¹æ¯”<br>æ ‘ï¼š<br><img src="/images/tools/iterator/æ ‘.jpg" alt=""></p>
<p>éé€’å½’ï¼š<br><img src="/images/tools/iterator/æ ˆ1.jpg" alt=""><br><img src="/images/tools/iterator/æ ˆ2.jpg" alt=""></p>
<p>é€’å½’<br><img src="/images/tools/iterator/callStack.jpg" alt=""></p>
<font color="red">å¯ä»¥çœ‹å‡ºéé€’å½’æ¨¡æ‹Ÿé€’å½’çš„æœ¬è´¨å°±åœ¨äºç¨‹åºæ§åˆ¶æµçš„æ¨¡æ‹Ÿï¼Œè¿™é‡Œçš„æ§åˆ¶æµå¹¶ä¸æ˜¯è°ƒç”¨æ ˆçš„æ¨¡æ‹Ÿï¼Œè€Œæ˜¯è®¡ç®—é¡ºåºçš„æ¨¡æ‹Ÿï¼ˆä½“ç°åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯å¯¹èŠ‚ç‚¹å€¼çš„è®¿é—®é¡ºåºï¼‰ï¼Œéé€’å½’æ¨¡æ‹Ÿä»£ç å°±æ˜¯ç”¨æ ˆä¸­çš„èŠ‚ç‚¹æ¥æ¨¡æ‹Ÿè®¿é—®çš„æ¬¡åº</font>

<p>æ—¢ç„¶ç°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿç”¨æ ˆæ¥æ¨¡æ‹Ÿæ§åˆ¶æµï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯¹ç¨‹åºçš„éå†çš„æ§åˆ¶å·²ç»å®Œå…¨å—åˆ¶äºæˆ‘ä»¬ï¼ˆè¿™é‡Œçš„å®Œå…¨å—åˆ¶æ˜¯é€»è¾‘ä¸Šçš„ï¼Œå±è”½åº•å±‚ç¼–è¯‘çš„ç»†èŠ‚ï¼‰ï¼Œæˆ‘ä»¬ç»ˆäºæ‘†è„±äº†äº†call stack :)</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è‚†æ„çš„æ“æ§æˆ‘ä»¬çš„éå†ç¨‹åº,æ¥ä¸‹æ¥ç”¨é—­åŒ…ä¿å­˜æ ˆï¼Œæ¯æ¬¡nextè°ƒç”¨popä¸€æ¬¡æ¥å®ç°è¿­ä»£<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeTreeIterator</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> controlStack = [];</span><br><span class="line"></span><br><span class="line">	((<span class="function"><span class="keyword">function</span> <span class="title">InorderIterator</span>(<span class="params">currNode</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// å°†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å…¥æ ˆ</span></span><br><span class="line">		<span class="keyword">while</span> (currNode) &#123;</span><br><span class="line">			controlStack.push(currNode);</span><br><span class="line">			currNode = currNode.left;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)(node))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (controlStack.length) &#123;</span><br><span class="line">				<span class="comment">// å–å‡ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line">				<span class="keyword">let</span> top = controlStack.pop();</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (top.right) &#123;</span><br><span class="line">					<span class="keyword">let</span> currNode = top.right;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// å°†å½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹æ ˆ</span></span><br><span class="line">					<span class="keyword">while</span> (currNode) &#123;</span><br><span class="line">						controlStack.push(currNode);</span><br><span class="line">						currNode = currNode.left;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">return</span> &#123;<span class="attr">value</span>: top.value, <span class="attr">done</span>: <span class="literal">false</span>&#125;;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‹‰å‡ºè¿­ä»£å™¨é›é›<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tree = &#123;</span><br><span class="line">	value: <span class="number">5</span>,</span><br><span class="line">	left: &#123;</span><br><span class="line">		value: <span class="number">4</span>,</span><br><span class="line">		left: <span class="string">''</span>,</span><br><span class="line">		right: <span class="string">''</span></span><br><span class="line">	&#125;,</span><br><span class="line">	right: &#123;</span><br><span class="line">		value: <span class="number">8</span>,</span><br><span class="line">		left: &#123;</span><br><span class="line">			value: <span class="number">6</span>,</span><br><span class="line">			left: <span class="string">''</span>,</span><br><span class="line">			right: <span class="string">''</span></span><br><span class="line">		&#125;,</span><br><span class="line">		right: <span class="string">''</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test = makeTreeIterator(tree),result = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = test.next(); i.done !== <span class="literal">true</span>; i=test.next()) &#123;</span><br><span class="line">	<span class="keyword">if</span> (i.value &lt; <span class="number">5</span>) &#123;</span><br><span class="line">		result.push(i.value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// [4]</span></span><br></pre></td></tr></table></figure></p>
<p>è¿˜æœ‰ä¸€ç§å®ç°è¿­ä»£å™¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨continuationæ¥å®ç°æ§åˆ¶åè½¬å•¦~<br>ä¸‹ä¸€ç¯‡åšå®¢ä¼šå»è®²è§£å¦‚ä½•ç”¨continuationæ¥å®ç°è¿­ä»£å™¨ï¼Œè¿™é‡Œå…ˆç”¨ES6çš„generatoræ¥é¢„çƒ­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">inOrder</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> x;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (node) &#123;</span><br><span class="line">		<span class="keyword">for</span> (x <span class="keyword">of</span> inOrder(node.left)) &#123;</span><br><span class="line">			<span class="keyword">yield</span> x;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">yield</span> node.value;</span><br><span class="line">		<span class="keyword">for</span> (x <span class="keyword">of</span> inOrder(node.right)) &#123;</span><br><span class="line">			<span class="keyword">yield</span> x;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test = inOrder(tree),result = [];</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">of</span> test) &#123;</span><br><span class="line">	<span class="keyword">if</span> (i &lt; <span class="number">5</span>) &#123;</span><br><span class="line">		result.push(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// [4]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4 å°ç»“"></a>4 å°ç»“</h3><p>åŸºäºæ ˆå¯ä»¥æ¨¡æ‹Ÿæ§åˆ¶æµï¼Œè¿™ä¹Ÿæ˜¯æ ˆå¼è™šæ‹Ÿæœºçš„æ€æƒ³ï¼Œå †æ ˆå¤„ç†ä¸æ„§æ˜¯è®¡ç®—æœºé¢†åŸŸå¼ºåŠ²çš„æŠ€æœ¯ï¼Œä»è¿­ä»£å¼•ç”³åˆ°æ§åˆ¶æµï¼Œçœ‹æ¥â€œå–æŒ‡-æ‰§è¡Œâ€æ¨¡å‹ä¸ä»…ä»…ç”¨åœ¨CPUå•Šã€‚</p>
<h3 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5 Reference"></a>5 Reference</h3><p><a href="https://coolshell.cn/articles/9886.html/comment-page-1#comments" title="äºŒå‰æ ‘è¿­ä»£å™¨ç®—æ³•" target="_blank" rel="noopener">äºŒå‰æ ‘è¿­ä»£å™¨ç®—æ³•</a><br><a href="http://effbot.org/pyfaq/what-is-an-iterator.htm" title="What is an iterator?" target="_blank" rel="noopener">What is an iterator?</a><br><a href="https://stackoverflow.com/questions/49052473/folder-iterator-continuation-token-recursive-loop" title="Folder Iterator Continuation Token Recursive Loop" target="_blank" rel="noopener">Folder Iterator Continuation Token Recursive Loop</a><br><a href="http://gallium.inria.fr/blog/generators-iterators-control-and-continuations/" title="generators-iterators-control-and-continuations/" target="_blank" rel="noopener">generators-iterators-control-and-continuations/</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/08/29/jsys_07-08_summary/">è®¡ç®—çš„è¦ç´ ç¬¬ä¸ƒ-å…«ç« å°ç»“</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-08-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è®¡ç®—æœºä½“ç³»ç»“æ„/">è®¡ç®—æœºä½“ç³»ç»“æ„</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nand2tetris/">Nand2tetris</a>
			</span>
		
	</div>

	

	
		<p><em>Programmers are creators of universes for which they alone are responsiable. Universes of virtually unlimited complexity can be created in the form of computer programms. â€”-Joseph Weizenbaum, Computer Power and Human Reason, 1974</em></p>
<p>å› ä¸ºä¹¦ä¸­ç¬¬ä¸ƒç« å’Œç¬¬å…«ç« éƒ½åœ¨è®²è™šæ‹Ÿæœºçš„åç«¯éƒ¨åˆ†ï¼Œæ•…è¿™é‡Œå°†å…¶åˆå¹¶æ€»ç»“ã€‚</p>
<h3 id="1-è™šæ‹Ÿæœº"><a href="#1-è™šæ‹Ÿæœº" class="headerlink" title="1 è™šæ‹Ÿæœº"></a>1 è™šæ‹Ÿæœº</h3><h4 id="1-1-è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆ"><a href="#1-1-è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆ" class="headerlink" title="1.1 è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆ"></a>1.1 è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆ</h4><p><img src="/images/jsys_07-08/VM.jpg" alt=""><br>è™šæ‹Ÿæœºï¼ˆVMï¼‰æ˜¯åœ¨æœ¬æœºæ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„é«˜çº§æŠ½è±¡ï¼Œå®ƒæ¨¡æ‹Ÿç‰©ç†æœºå™¨ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºçš„æ˜¯ä¸­é—´ç¼–è¯‘ç›®æ ‡ï¼Œæ—¢ä¸æ˜¯è¿›ç¨‹è™šæ‹Ÿæœº(process virtual machine)ï¼Œæ¯”å¦‚JVMï¼ŒCLRç­‰è¿è¡Œæ—¶å¹³å°ï¼Œä¹Ÿä¸æ˜¯ç³»ç»Ÿè™šæ‹Ÿæœº(system virtual machine)ï¼Œç³»ç»Ÿè™šæ‹Ÿæœºæä¾›äº†ç³»ç»Ÿçº§çš„ç¡¬ä»¶æŠ½è±¡ï¼Œæ¯”å¦‚VirtualBoxã€‚è™šæ‹Ÿæœºä½¿åŒä¸€å¹³å°èƒ½å¤Ÿåœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä½“ç³»ç»“æ„ä¸Šè¿è¡Œã€‚å¯ä»¥å°†Javaå’ŒPythonçš„è§£é‡Šå™¨ä½œä¸ºç¤ºä¾‹ï¼Œå…¶ä¸­ä»£ç è¢«ç¼–è¯‘ä¸ºJVMç‰¹å®šçš„å­—èŠ‚ç ã€‚åœ¨Microsoft .Netä½“ç³»ç»“æ„ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸åŒçš„æƒ…å†µï¼Œå…¶ä¸­ä»£ç è¢«ç¼–è¯‘ä¸ºCLRï¼ˆå…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼‰çš„ä¸­é—´è¯­è¨€ã€‚è¿™é‡Œæœ‰ä¸€ç¯‡è®²è§£<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/What-does-quot-virtual-machine-quot-and-quot-real-platform-quot-mean-td4028959.html#a4028960" title="Hack VM" target="_blank" rel="noopener">Hack VM</a>çš„ä¾‹å­ä¾›å¤§å®¶å‚è€ƒã€‚<br>è™šæ‹Ÿæœºé€šå¸¸åº”è¯¥å®ç°ä»€ä¹ˆï¼Ÿå®ƒåº”è¯¥æ¨¡æ‹Ÿç‰©ç†CPUæ‰§è¡Œçš„æ“ä½œï¼Œå› æ­¤ç†æƒ³æƒ…å†µä¸‹åº”åŒ…å«ä»¥ä¸‹æ¦‚å¿µï¼š</p>
<ol>
<li>å°†æºè¯­è¨€ç¼–è¯‘ä¸ºVMç‰¹å®šçš„å­—èŠ‚ç </li>
<li>åŒ…å«æŒ‡ä»¤å’Œæ“ä½œæ•°çš„æ•°æ®ç»“æ„ï¼ˆæŒ‡ä»¤å¤„ç†çš„æ•°æ®ï¼‰</li>
<li>ç”¨äºå‡½æ•°è°ƒç”¨æ“ä½œçš„è°ƒç”¨å †æ ˆ</li>
<li>æŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„â€œæŒ‡ä»¤æŒ‡é’ˆâ€ï¼ˆIPï¼‰</li>
<li>ä¸€ä¸ªè™šæ‹Ÿçš„â€™CPUâ€™ - æŒ‡ä»¤è°ƒåº¦ç¨‹åº</li>
<li>è·å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆç”±æŒ‡ä»¤æŒ‡é’ˆå¯»å€ï¼‰</li>
<li>è§£ç æ“ä½œæ•°</li>
<li>æ‰§è¡ŒæŒ‡ä»¤</li>
</ol>
<h4 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿæœºï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿæœºï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿæœºï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿæœºï¼Ÿ</h4><p>é«˜çº§è¯­è¨€ç¨‹åºåœ¨è¿è¡Œåœ¨ç›®æ ‡æœºå™¨ä¸Šä¹‹å‰ï¼Œå¿…é¡»å¾—ç¿»è¯‘æˆå¯¹åº”çš„æœºå™¨è¯­è¨€ã€‚è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹æ˜¯ç›¸å½“å¤æ‚çš„â€¦é€šå¸¸ï¼Œå¿…é¡»ç»™ä»»æ„ç»™å®šçš„é«˜çº§è¯­è¨€å†™å¯¹åº”åˆ°æŒ‡å®šæœºå™¨çš„ç¼–è¯‘å™¨ï¼Œä½†è¿™ç§é«˜çº§è¯­è¨€åˆ°æœºå™¨è¯­è¨€çš„ç›´æ¥æ˜ å°„ç›´æ¥å¯¼è‡´äº†å¼ºä¾èµ–ï¼Œä»è½¯ä»¶å·¥ç¨‹çš„è§’åº¦çœ‹å‡å°‘ä¾èµ–ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚æŠ½è±¡ä¸èƒ½è§£å†³çš„ï¼Œå¦‚æœæœ‰ï¼Œé‚£å°±åŠ ä¸¤å±‚ã€‚<br>ç»“æœå°±æ˜¯ï¼Œä¸ºäº†å‡å°‘ä¾èµ–ï¼Œå°†æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹åˆ’åˆ†ä¸ºå‡ ä¹ç‹¬ç«‹çš„ä¸¤ä¸ªé˜¶æ®µã€‚</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼Œé«˜çº§è¯­è¨€ç¿»è¯‘åˆ°ä¸­é—´è¯­è¨€ï¼ˆIRï¼‰</li>
<li>ç¬¬äºŒé˜¶æ®µï¼Œä¸­é—´è¯­è¨€ç¿»è¯‘åˆ°å¯¹åº”çš„ç¡¬ä»¶æœºå™¨è¯­è¨€</li>
</ul>
<p>ä½ çœ‹è¿™æ ·è¯­è¨€çš„ç¼–è¯‘å™¨å®ç°äººå‘˜åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å°±ä¸ç”¨å†å†™å„ç§å„æ ·çš„ç¼–è¯‘åˆ°æœºå™¨è¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œç§ç§Clojureï¼Œç«™åœ¨JVMçš„è‚©è†€ä¸Šï¼šï¼‰ï¼Œäº‹å®ä¸Šè¿™ç§è¡Œä¸ºä¹Ÿæ˜¯è½¯ä»¶å·¥ç¨‹çš„è‰¯å¥½ä½“ç°ï¼Œè‰¯å¥½çš„æ¨¡å—åŒ–è®¾è®¡ï¼ˆé«˜å±‚æ¨¡å—å’Œåº•å±‚æ¨¡å—ï¼Œæ¨¡å—ä»¶é€šè¿‡VMcodeè¿™ç§è¯­è¨€é€šä¿¡ï¼‰å’ŒæŠ½è±¡å±éšœï¼ˆVMCodeå°±æ˜¯é«˜å±‚å’Œåº•å±‚ä¹‹é—´çš„ä¸‡é‡Œé•¿åŸï¼‰æ„å‘³ç€ç¼–å†™é«˜çº§è¯­è¨€çš„ç¼–è¯‘å™¨çš„ç¨‹åºå‘˜ï¼ˆé«˜å±‚æ¨¡å—ï¼‰å’Œå°†VMcodeç¼–è¯‘åˆ°ç¡¬ä»¶çš„ç¨‹åºå‘˜ï¼ˆåº•å±‚æ¨¡å—ï¼‰å¯ä»¥åˆ†å¤´è¡ŒåŠ¨ï¼ŒæŠ½è±¡å±éšœä¸‡å²ï¼ï¼ï¼</p>
<h4 id="1-3-Stack-based-Virtual-Machine"><a href="#1-3-Stack-based-Virtual-Machine" class="headerlink" title="1.3 Stack based Virtual Machine"></a>1.3 Stack based Virtual Machine</h4><p>VMçš„å®ç°ä¸»æµæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å †æ ˆæ¨¡å‹ï¼Œä¸€ç§æ˜¯å¯„å­˜å™¨æ¨¡å‹ï¼ˆä¸‹ä¸€èŠ‚è®²ï¼‰ï¼Œé€‰æ‹©æ¨¡å‹è¦è€ƒè™‘çš„å…³é”®å› ç´ æ˜¯ï¼š<font color="red">åœ¨VMæ“ä½œä¸­çš„æ“ä½œæ•°å’Œæ“ä½œç»“æœåº”è¯¥æ”¾åœ¨å“ªé‡Œã€‚è€Œåœ¨å †æ ˆæ¨¡å‹ä¸­ï¼Œæ˜¯å°†å…¶æ”¾åœ¨å †æ ˆï¼ˆstackï¼‰è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ã€‚</font><br>åŸºäºæ ˆçš„è™šæ‹Ÿæœºæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹</p>
<ul>
<li>æŒ‡ä»¤é•¿åº¦æ˜¯å›ºå®šçš„</li>
<li>æ‰§è¡Œå¤šä¸ªæ“ä½œæ•°è®¡ç®—æ—¶ï¼Œä¼šå…ˆå°†æ“ä½œæ•°åšå‹å…¥æ ˆï¼Œç”±è¿ç®—æŒ‡ä»¤å–å‡ºå¹¶è®¡ç®—</li>
</ul>
<p>ä¸‹é¢ä»¥AddæŒ‡ä»¤æ¥è¯´æ˜stack machineçš„ä¸€èˆ¬æ“ä½œï¼š<br><img src="/images/jsys_07-08/add.jpg" alt=""></p>
<ol>
<li>PUSH 4 // å½“å‰æ ˆæŒ‡é’ˆæŒ‡å‘çš„åœ°å€èµ‹å€¼4ï¼ŒSP=SP+1</li>
<li>PUSH 5 // å½“å‰æ ˆæŒ‡é’ˆæŒ‡å‘çš„åœ°å€èµ‹å€¼5ï¼ŒSP=SP+1</li>
<li>ADD     // å–å‡ºæ ˆæœ€ä¸Šæ–¹çš„ä¸¤ä¸ªå€¼ç›¸åŠ ï¼Œå‹å…¥SP-2ï¼ŒSP=SP-1</li>
</ol>
<p>å¯ä»¥çœ‹å‡ºåŸºäºå †æ ˆçš„æ¨¡å‹çš„ä¼˜ç‚¹åœ¨äºæ“ä½œæ•°ç”±å †æ ˆæŒ‡é’ˆ(SP)éšå¼åœ°å¯»å€ã€‚è¿™æ„å‘³ç€è™šæ‹Ÿæœºä¸éœ€è¦æ˜¾å¼åœ°çŸ¥é“æ“ä½œæ•°åœ°å€ï¼Œå› ä¸ºè°ƒç”¨å †æ ˆæŒ‡é’ˆå°†ç»™ï¼ˆPopï¼‰ä¸‹ä¸€ä¸ªæ“ä½œæ•°ã€‚åœ¨åŸºäºå †æ ˆçš„VMä¸­ï¼Œæ‰€æœ‰ç®—æœ¯å’Œé€»è¾‘è¿ç®—éƒ½æ˜¯é€šè¿‡pushå’Œpopæ“ä½œæ•°å¹¶åœ¨å †æ ˆä¸­ç”Ÿæˆæ¥æ‰§è¡Œçš„ã€‚</p>
<h4 id="1-4-Register-based-Virtual-Machine"><a href="#1-4-Register-based-Virtual-Machine" class="headerlink" title="1.4 Register based Virtual Machine"></a>1.4 Register based Virtual Machine</h4><p>åœ¨åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºå®ç°ä¸­ï¼Œå­˜å‚¨æ“ä½œæ•°çš„æ•°æ®ç»“æ„åŸºäºCPUçš„å¯„å­˜å™¨ã€‚è¿™é‡Œæ²¡æœ‰PUSHæˆ–POPæ“ä½œï¼Œä½†æ˜¯æŒ‡ä»¤éœ€è¦åŒ…å«æ“ä½œæ•°çš„åœ°å€ï¼ˆå¯„å­˜å™¨ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‡ä»¤çš„æ“ä½œæ•°åœ¨æŒ‡ä»¤ä¸­æ˜ç¡®åœ°è¢«å¯»å€ï¼Œä¸åƒåŸºäºå †æ ˆçš„æ¨¡å‹ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‡å‘æ“ä½œæ•°çš„å †æ ˆæŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºä¸­æ‰§è¡ŒADDæ“ä½œï¼Œåˆ™æŒ‡ä»¤æˆ–å¤šæˆ–å°‘å¦‚ä¸‹ï¼š<br><img src="/images/jsys_07-08/register.jpg" alt=""></p>
<p>æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ²¡æœ‰POPæˆ–PUSHæ“ä½œï¼Œå› æ­¤æ·»åŠ æŒ‡ä»¤åªæ˜¯ä¸€è¡Œã€‚ä½†æ˜¯ä¸å †æ ˆä¸åŒï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®åœ°å°†æ“ä½œæ•°çš„åœ°å€ç§°ä¸ºR1ï¼ŒR2å’ŒR3ã€‚è¿™é‡Œçš„ä¼˜ç‚¹æ˜¯<strong>ä¸å­˜åœ¨å…¥æ ˆå‡ºæ ˆå¼€é”€</strong>ï¼Œå¹¶ä¸”åŸºäºå¯„å­˜å™¨çš„VMä¸­çš„æŒ‡ä»¤åœ¨æŒ‡ä»¤è°ƒåº¦å¾ªç¯å†…æ‰§è¡Œå¾—æ›´å¿«ã€‚</p>
<p>åŸºäºå¯„å­˜å™¨çš„æ¨¡å‹çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®ƒå…è®¸åœ¨åŸºäºå †æ ˆçš„æ–¹æ³•ä¸­æ— æ³•å®Œæˆçš„æŸäº›ä¼˜åŒ–ã€‚ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­æ˜¯å½“ä»£ç ä¸­æœ‰<strong>å…±åŒçš„å­è¡¨è¾¾å¼</strong>æ—¶ï¼Œå¯„å­˜å™¨æ¨¡å‹å¯ä»¥è®¡ç®—ä¸€æ¬¡å¹¶å°†ç»“æœå­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ä»¥ä¾›å°†æ¥ä½¿ç”¨æ—¶å­è¡¨è¾¾å¼å†æ¬¡å‡ºç°ï¼Œè¿™é™ä½äº†é‡æ–°è®¡ç®—è¡¨è¾¾å¼çš„æˆæœ¬ã€‚</p>
<p>åŸºäºå¯„å­˜å™¨çš„æ¨¡å‹çš„<strong>é—®é¢˜</strong>æ˜¯å¹³å‡å¯„å­˜å™¨æŒ‡ä»¤å¤§äºå¹³å‡å †æ ˆæŒ‡ä»¤ï¼ˆæŒ‡ä»¤é•¿åº¦ä¹Ÿä¸æ˜¯å›ºå®šçš„ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ˜ç¡®æŒ‡å®šæ“ä½œæ•°åœ°å€ã€‚ç”±äºå †æ ˆæŒ‡é’ˆå¯¹å †æ ˆæœºå™¨çš„æŒ‡ä»¤å¾ˆçŸ­ï¼Œç›¸åº”çš„å¯„å­˜å™¨æœºå™¨æŒ‡ä»¤éœ€è¦åŒ…å«æ“ä½œæ•°ä½ç½®ï¼Œå¹¶ä¸”ä¸å †æ ˆä»£ç ç›¸æ¯”äº§ç”Ÿæ›´å¤šçš„å¯„å­˜å™¨ä»£ç ï¼Œå¹¶ä¸”å¦‚æœåˆ©ç”¨å¯„å­˜å™¨åšæ•°æ®äº¤æ¢ï¼Œå°±è¦ç»å¸¸ä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨çš„ç»“æœï¼Œè¿™å°±å¯¼è‡´åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºåœ¨å®ç°ä¸Šè¦æ¯”åŸºäºæ ˆçš„å¤æ‚ï¼Œä»£ç ç¼–è¯‘ä¹Ÿè¦å¤æ‚å¾—å¤š</p>
<p>æˆ‘é‡åˆ°çš„ä¸€ç¯‡å¾ˆæ£’çš„åšå®¢æ–‡ç« ï¼ˆåœ¨æ­¤é“¾æ¥ä¸­ï¼‰åŒ…å«åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºçš„è§£é‡Šæ€§å’Œç®€å•çš„Cå®ç°ã€‚å¦‚æœå®ç°è™šæ‹Ÿæœºå’Œè§£é‡Šå™¨æ˜¯æ‚¨çš„ä¸»è¦å…´è¶£ï¼Œé‚£ä¹ˆANTLRåˆ›å»ºè€…Terrence Parrçš„ä¹¦åä¸ºâ€œè¯­è¨€å®ç°æ¨¡å¼ï¼šåˆ›å»ºæ‚¨è‡ªå·±çš„ç‰¹å®šé¢†åŸŸå’Œé€šç”¨ç¼–ç¨‹è¯­è¨€â€ï¼Œå¯èƒ½ä¼šéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 id="2-å †æ ˆè¿ç®—"><a href="#2-å †æ ˆè¿ç®—" class="headerlink" title="2 å †æ ˆè¿ç®—"></a>2 å †æ ˆè¿ç®—</h3><h4 id="2-1-ç®—æœ¯å’Œé€»è¾‘å‘½ä»¤"><a href="#2-1-ç®—æœ¯å’Œé€»è¾‘å‘½ä»¤" class="headerlink" title="2.1 ç®—æœ¯å’Œé€»è¾‘å‘½ä»¤"></a>2.1 ç®—æœ¯å’Œé€»è¾‘å‘½ä»¤</h4><p><img src="/images/jsys_07-08/arithic.jpg" alt=""><br>VMæ”¯æŒä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œå‘½ä»¤ã€‚æ ¹æ®å‘½ä»¤çš„æ“ä½œæ•°ä¸ªæ•°ï¼Œä»å †æ ˆä¸­å¼¹å‡ºå¯¹åº”ä¸ªå…ƒç´ ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„è¿ç®—ï¼Œå†å°†ç»“æœå‹å…¥å †æ ˆã€‚è¿™ä¹ˆåšçš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œæ¯æ¬¡æ“ä½œä¸ç”¨ç®¡å †æ ˆçš„å…¶ä½™éƒ¨åˆ†ï¼ˆé™¤äº†æ“ä½œæ•°ï¼‰</p>
<h4 id="2-2-å†…å­˜è®¿é—®å‘½ä»¤"><a href="#2-2-å†…å­˜è®¿é—®å‘½ä»¤" class="headerlink" title="2.2 å†…å­˜è®¿é—®å‘½ä»¤"></a>2.2 å†…å­˜è®¿é—®å‘½ä»¤</h4><p><img src="/images/jsys_07-08/PushPop.jpg" alt=""><br>æ‰€æœ‰çš„å†…å­˜æ®µéƒ½é€šè¿‡ä¸¤ä¸ªå‘½ä»¤æ¥å­˜å–ï¼ŒPUSHï¼ŒPOPï¼Œè¿™ä½¿å¾—å¯¹å†…å­˜çš„æ“ä½œåªéœ€å…³æ³¨æ ˆé¡¶çš„å˜åŒ–ã€‚</p>
<h3 id="3-ç¨‹åºæ§åˆ¶"><a href="#3-ç¨‹åºæ§åˆ¶" class="headerlink" title="3 ç¨‹åºæ§åˆ¶"></a>3 ç¨‹åºæ§åˆ¶</h3><h4 id="3-1-ç¨‹åºæ§åˆ¶æµå‘½ä»¤"><a href="#3-1-ç¨‹åºæ§åˆ¶æµå‘½ä»¤" class="headerlink" title="3.1 ç¨‹åºæ§åˆ¶æµå‘½ä»¤"></a>3.1 ç¨‹åºæ§åˆ¶æµå‘½ä»¤</h4><p><img src="/images/jsys_07-08/goto.jpg" alt=""><br>è®¡ç®—æœºç¨‹åºé»˜è®¤çš„æ‰§è¡Œé¡ºåºæ˜¯çº¿æ€§çš„ï¼Œå³ä¸€ä¸ªå‘½ä»¤æ¥ç€ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œ    ï¼Œè¿™ä¸ªè¿ç»­çš„æ§åˆ¶æµå¶å°”è¢«åˆ†æ”¯å‘½ä»¤æ‰“æ–­ï¼ˆæ¯”å¦‚åœ¨å¾ªç¯ä¸­æ‰§è¡Œè¿­ä»£ï¼‰ã€‚åœ¨åº•å±‚ç¼–ç¨‹ä¸­ï¼Œåˆ†æ”¯é€»è¾‘é‡‡ç”¨goto destination å‘½ä»¤å®ç°ï¼Œè¯¥å‘½ä»¤è®©è®¡ç®—æœºè·³è½¬åˆ°ç›®æ ‡å‚æ•°æŒ‡å®šçš„ä½ç½®ï¼ˆHackæ˜¯gotoåˆ°ROMçš„æŒ‡å®šä½ç½®ï¼‰ï¼Œè€Œä¸æ˜¯æ¥ç€åŸæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çº¿æ€§æ‰§è¡Œã€‚ç›®çš„åœ°å€çš„æŒ‡å®šæ–¹å¼å¯ä»¥æœ‰å¤šç§å½¢å¼ï¼Œæœ€åŸå§‹çš„ä¸€ç§å°±æ˜¯æŒ‡å®šå³å°†æ‰§è¡Œçš„æŒ‡ä»¤çš„ç‰©ç†åœ°å€ã€‚åº”ç”¨æ ‡ç­¾labelæ¥æè¿°jumpçš„ç›®çš„åœ°å€å¯ä»¥å»ºç«‹ç¨å¾®æŠ½è±¡ä¸€ç‚¹çš„é‡å®šå‘å‘½ä»¤ï¼ˆredirection commandï¼‰ã€‚è¿™ç§æ”¹è¿›éœ€è¦ç¨‹åºè¯­è¨€é…æœ‰æ ‡ç­¾æŒ‡ä»¤ï¼ˆlabeling directiveï¼‰ï¼Œå®ƒå¯å°†æ ‡ç­¾ç»‘å®šåˆ°ç¨‹åºä¸­çš„æŒ‡å®šä½ç½®ã€‚</p>
<h4 id="3-2-å‡½æ•°è°ƒç”¨å‘½ä»¤"><a href="#3-2-å‡½æ•°è°ƒç”¨å‘½ä»¤" class="headerlink" title="3.2 å‡½æ•°è°ƒç”¨å‘½ä»¤"></a>3.2 å‡½æ•°è°ƒç”¨å‘½ä»¤</h4><p><img src="/images/jsys_07-08/funCall.jpg" alt=""><br>é«˜çº§è¯­è¨€æ‰€å…·æœ‰çš„è¿™ç§èƒ½å°†è¡¨è¾¾å¼è‡ªç”±ç»„åˆçš„èƒ½åŠ›ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç¼–å†™æŠ½è±¡ä»£ç ï¼Œè®©æˆ‘ä»¬æŠŠä¸»è¦ç²¾åŠ›æ”¾åœ¨ç®—æ³•çš„æ€æƒ³ä¸Šé¢ï¼Œè€Œä¸æ˜¯æœºå™¨çš„æ‰§è¡Œä¸Šã€‚å½“ç„¶é«˜çº§è¯­è¨€æŠ½è±¡çº§åˆ«è¶Šé«˜ï¼Œåœ¨åº•å±‚è¦åšçš„å·¥ä½œå°±è¶Šå¤šã€‚ç‰¹åˆ«æ˜¯ï¼Œå¿…é¡»åœ¨åº•å±‚æ§åˆ¶å­ç¨‹åºï¼ˆcalleeï¼‰å’Œå­ç¨‹åºè°ƒç”¨è€…ï¼ˆcallerï¼‰ä¹‹é—´çš„ç›¸äº’å½±å“ã€‚å¯¹äºåœ¨è¿è¡ŒæœŸçš„æ¯ä¸ªå­ç¨‹åºè°ƒç”¨ï¼Œåº•å±‚å¿…é¡»å¤„ç†ä¸‹é¢çš„ä¸€äº›ç»†èŠ‚</p>
<ul>
<li>å°†å‚æ•°ä»è°ƒç”¨è€…(caller)ä¼ é€’ç»™è¢«è°ƒç”¨è€…(callee)</li>
<li>åœ¨è·³è½¬å¹¶æ‰§è¡Œè¢«è°ƒç”¨è€…ä¹‹å‰ï¼Œå…ˆä¿å­˜è°ƒç”¨è€…çš„çŠ¶æ€</li>
<li>ä¸ºè¢«è°ƒç”¨è€…ä½¿ç”¨çš„å±€éƒ¨å˜é‡åˆ†é…ç©ºé—´</li>
<li>è·³è½¬å¹¶æ‰§è¡Œè¢«è°ƒç”¨è€…</li>
<li>å°†è¢«è°ƒç”¨è€…çš„è¿è¡Œç»“æœè¿”å›ç»™è°ƒç”¨è€…</li>
<li>åœ¨ä»è¢«è°ƒç”¨è€…è¿”å›ä¹‹å‰ï¼Œå›æ”¶å…¶ä½¿ç”¨çš„å†…å­˜ç©ºé—´</li>
<li>æ¢å¤è°ƒç”¨è€…çš„çŠ¶æ€</li>
<li>è¿”å›åˆ°è°ƒç”¨è¯­å¥ä¹‹åçš„ä¸‹ä¸€æ¡è¯­å¥ç»§ç»­æ‰§è¡Œ</li>
</ul>
<p>æœ‰å…³ä¸Šè¿°å‘½ä»¤çš„å®ç°ï¼Œä¹¦ä¸­éƒ½æœ‰è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€å™è¿°ã€‚</p>
<h3 id="4-Q-amp-A"><a href="#4-Q-amp-A" class="headerlink" title="4 Q&amp;A"></a>4 Q&amp;A</h3><p>Qï¼šæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ä¼˜åŒ–ç”Ÿæˆçš„asmä»£ç å—ï¼Ÿ<br>Aï¼š<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Generated-code-size-td1201814.html" title="hack vmtranslatorä¼˜åŒ–" target="_blank" rel="noopener">hack vmtranslatorä¼˜åŒ–</a></p>
<p>Qï¼šHow is the VM really made?<br>Aï¼šVM Translatoråœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè¿è¡Œï¼Œå¹¶å°†.vmæ–‡ä»¶è½¬æ¢ä¸º.asmæ–‡ä»¶ã€‚æˆ‘ç”¨Pythonç¼–å†™äº†æˆ‘çš„VM Translatorã€‚ç¼–å†™æœ¬æœºVMæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ï¼Œéœ€è¦æ¯”Hackæ›´å¤æ‚çš„è®¡ç®—æœºæ‰èƒ½è¿è¡Œã€‚Java VMæ˜¯ç”¨C / C ++ç¼–å†™çš„ã€‚ç‰¹å®šäºå¹³å°çš„ç¼–è¯‘å™¨å…è®¸å®ƒåœ¨å„ç§ä¸åŒçš„ç›®æ ‡ç¡¬ä»¶ä¸Šè¿è¡Œã€‚å·²ç»ç”¨C / C ++ç¼–å†™äº†ä¸ç›®æ ‡æ“ä½œç³»ç»Ÿè¿æ¥çš„åº“ã€‚å½“æ‚¨ä¸º32ä½Windowsç³»ç»Ÿä¸‹è½½Javaæ—¶ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®æ ‡æ˜¯ä¸é€‚å½“çš„Windowsæ”¯æŒåº“é“¾æ¥çš„32ä½Intel å¤„ç†å™¨ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å°½å¯èƒ½å°‘åœ°ç¼–å†™æ±‡ç¼–ä»£ç ã€‚å¯¹äºæˆ‘ï¼ˆMarkï¼‰æ‰€åšçš„åµŒå…¥å¼ç³»ç»Ÿç¼–ç¨‹ï¼Œå·¥å…·ï¼ˆç¼–è¯‘å™¨ç­‰ï¼‰åœ¨Windowsä¸Šè¿è¡Œï¼Œåªæœ‰äºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½åˆ°å®é™…çš„ç¡¬ä»¶ä¸Šã€‚æ‰€æœ‰ä»£ç éƒ½æ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œå¸¦æœ‰ä¸€äº›å°çš„æ±‡ç¼–è¯­è¨€ä¾‹ç¨‹ã€‚512K ROMå’Œ64K RAMæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é…ç½®ã€‚ç°ä»£C / C ++ç¼–è¯‘å™¨æ˜¯ä½¿ç”¨å®ƒä»¬è‡ªå·±çš„æ—©æœŸç‰ˆæœ¬ç¼–å†™çš„ã€‚ç¬¬ä¸€ä¸ªCç¼–è¯‘å™¨å¯èƒ½ç”¨Bè¯­è¨€ç¼–å†™ï¼ŒBè¯­è¨€æ˜¯Cè¯­è¨€çš„å‰èº«ã€‚</p>
<p>Qï¼šæ—¢ç„¶Hack VMåªæ˜¯ä¸ªç›®æ ‡ä»£ç ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨Jackæ¥å®ç°VM æ¨¡æ‹Ÿå™¨å‘¢ï¼ˆç°åœ¨Jackçš„æ ˆå¼è™šæ‹Ÿæœºèƒ½è·‘éƒ½æ˜¯å¤šäºäº†Javaç¼–å†™çš„æ¨¡æ‹Ÿå™¨ï¼Œå®é™…ä¸Šè¿™ä¸ªæ¨¡æ‹Ÿå™¨èµ·äº†ä¸€ä¸ªVMçš„ä½œç”¨ï¼Œé—®é¢˜æ˜¯ç°åœ¨è¦ç”¨Jackè‡ªæˆ‘å®ç°è¿™ä¸ªæ¨¡æ‹Ÿå™¨ï¼Œé€šè¿‡JackOSçš„ç¡¬ä»¶ï¼‰<br>Aï¼šäº‹å®ä¸Šè¿™é‡ŒMarkå·²ç»æœ‰äº†å°è¯•<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Hack-II-Escaping-the-Harvard-straitjacket-td2877780.html" title=" Hack II: Escaping the Harvard straitjacket" target="_blank" rel="noopener"> Hack II: Escaping the Harvard straitjacket</a></p>
<h3 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5 Reference"></a>5 Reference</h3><p><a href="https://en.wikipedia.org/wiki/Virtual_machine" title="Virtual Machine" target="_blank" rel="noopener">Virtual Machine</a><br><a href="https://stackoverflow.com/questions/861422/is-the-java-virtual-machine-really-a-virtual-machine-in-the-same-sense-as-my-vmw" title="Is the Java Virtual Machine really a virtual machine in the same sense as my VMWare or Parallels file?" target="_blank" rel="noopener">Is the Java Virtual Machine really a virtual machine in the same sense as my VMWare or Parallels file?</a><br><a href="https://blog.csdn.net/mycwq/article/details/45653897" title="erlangè™šæ‹Ÿæœºä»£ç æ‰§è¡ŒåŸç†" target="_blank" rel="noopener">erlangè™šæ‹Ÿæœºä»£ç æ‰§è¡ŒåŸç†</a><br><a href="https://markfaction.wordpress.com/2012/07/15/stack-based-vs-register-based-virtual-machine-architecture-and-the-dalvik-vm/" title="Stack based vs Register based Virtual Machine Architecture, and the Dalvik VM" target="_blank" rel="noopener">Stack based vs Register based Virtual Machine Architecture, and the Dalvik VM</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/08/28/parser_00/">ä»é›¶å¼€å§‹çš„ç¼–è¯‘åŸç†ä¹‹æ—…----Parserç¯‡(é›¶)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-08-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/parser/">parser</a>
			</span>
		
	</div>

	

	
		<h3 id="0-åºè¨€"><a href="#0-åºè¨€" class="headerlink" title="0 åºè¨€"></a>0 åºè¨€</h3><p>è‡ªä»å»å¹´å­¦äº†ç¼–è¯‘åŸç†å·²ç»è¿‡å»å¿«ä¸€å¹´äº†ï¼Œä¹‹å‰çš„ç¼–è¯‘çŸ¥è¯†ä½“ç³»çš„æ„å»ºå¤ªæ¾æ•£ï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡é‡æ–°æ¢³ç†ä¸€éç¼–è¯‘çš„çŸ¥è¯†è„‰ç»œï¼Œä½†æˆ‘çš„èƒ½åŠ›æ¯•ç«Ÿæœ‰é™ï¼Œéå¸¸å¸Œæœ›æœ‰èƒ½åŠ›çš„è¯»è€…èƒ½æŒ‡æ­£æˆ‘æ–‡ç« ä¸­çš„ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œç¼–ç¨‹ä¹‹é“ï¼Œç¼–è¯‘ä¹‹è·¯ä¹Ÿæ‰åˆšåˆšèµ·æ­¥ï¼Œèƒ½åŠ›æœ‰é™ä¹‹å¤„ä¹Ÿè¯·å¤§å®¶å¤šåŒ…æ¶µã€‚</p>
<p>æœ¬ç³»åˆ—æ–‡ç« é˜…è¯»å‰ç½®æ¡ä»¶</p>
<ul>
<li>ç†Ÿæ‚‰å¸¸è§çš„Grammarå®šä¹‰ï¼ˆReferenceé‡Œæœ‰bnfã€ebnfçš„grammar guideï¼Œä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥å»çœ‹çœ‹ï¼‰</li>
</ul>
<h3 id="1-ç›®å½•"><a href="#1-ç›®å½•" class="headerlink" title="1 ç›®å½•"></a>1 ç›®å½•</h3><p>æœ¬ç³»åˆ—æ—¨åœ¨å­¦ä¹ å„ç§parseræ€è·¯åŠæŠ€å·§ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol start="0">
<li><a href="https://belyenochi.github.io/2018/08/28/parser_00/#more" target="_blank" rel="noopener"> æ¸…æ™¨å…¥å¤å¯ºâ€”-è®ºä¸–é—´parserä¸ºä½•ç‰©<strong>[æœ¬ç¯‡]</strong></a></li>
<li><a href="https://belyenochi.github.io/2018/09/03/parser_01/#more" target="_blank" rel="noopener"> åˆæ—¥ç…§é«˜æ—â€”-åˆæ¢Firsté›†ï¼ŒFollowé›† </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_02/#more" target="_blank" rel="noopener"> æ›²å¾„é€šå¹½å¤„â€”-é¢„æµ‹åˆ†æè¡¨çš„æ„å»º </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> ç¦…æˆ¿èŠ±æœ¨æ·±â€”-å®ç°LL(1) parser </a></li>
<li><a href="https://belyenochi.github.io/2018/09/04/parser_06/#more" target="_blank" rel="noopener"> å±±å…‰æ‚¦é¸Ÿæ€§â€”-é€’å½’ä¸‹é™çš„ä¸¤ç§å®ç° </a></li>
<li>æ½­å½±ç©ºäººå¿ƒâ€”-æµ…è°ˆrecursive ascent parser(SLR,LALR(1))</li>
<li>ä¸‡ç±æ­¤ä¿±å¯‚â€”-parser combinatorï¼ˆä»ohm.jsæºç è¯´èµ·ï¼‰</li>
<li>ä½†ä½™é’Ÿç£¬éŸ³â€”-åæ€ä¸æ€»ç»“</li>
</ol>
<h3 id="2-è®ºä¸–é—´parserä¸ºä½•ç‰©"><a href="#2-è®ºä¸–é—´parserä¸ºä½•ç‰©" class="headerlink" title="2 è®ºä¸–é—´parserä¸ºä½•ç‰©"></a>2 è®ºä¸–é—´parserä¸ºä½•ç‰©</h3><p>ä»¥ä¸‹ä¸ºç‹å å‰è¾ˆåŸæ–‡çš„ç§‘æ™®ï¼ŒReferenceä¼šæåŠå»ºè®®å¤§å®¶è¯»ä¸€è¯»ï¼Œè¯´èµ·æ¥è‡ªå·±å…¥äº†PLçš„å‘è¿˜æ˜¯çœ‹å ç¥çš„åšå®¢å¼€å§‹çš„ã€‚</p>
<p>é¦–å…ˆæ¥ç§‘æ™®ä¸€ä¸‹ã€‚æ‰€è°“parserï¼Œä¸€èˆ¬æ˜¯æŒ‡æŠŠæŸç§æ ¼å¼çš„æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰è½¬æ¢æˆæŸç§æ•°æ®ç»“æ„çš„è¿‡ç¨‹ã€‚æœ€å¸¸è§çš„parserï¼Œæ˜¯æŠŠç¨‹åºæ–‡æœ¬è½¬æ¢æˆç¼–è¯‘å™¨å†…éƒ¨çš„ä¸€ç§å«åšâ€œæŠ½è±¡è¯­æ³•æ ‘â€ï¼ˆASTï¼‰çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿæœ‰ç®€å•ä¸€äº›çš„parserï¼Œç”¨äºå¤„ç†CSVï¼ŒJSONï¼ŒXMLä¹‹ç±»çš„æ ¼å¼ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå¤„ç†ç®—æ•°è¡¨è¾¾å¼çš„parserï¼Œå¯ä»¥æŠŠâ€œ1+2â€è¿™æ ·çš„ï¼Œå«æœ‰1ï¼Œ+ï¼Œ2ä¸‰ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼ˆobjectï¼‰ã€‚è¿™ä¸ªå¯¹è±¡å°±åƒnew BinaryExpression(ADD, new Number(1), new Number(2))è¿™æ ·çš„Javaæ„é€ å‡½æ•°è°ƒç”¨ç”Ÿæˆå‡ºæ¥çš„é‚£æ ·ã€‚</p>
<p>ä¹‹æ‰€ä»¥éœ€è¦åšè¿™ç§ä»å­—ç¬¦ä¸²åˆ°æ•°æ®ç»“æ„çš„è½¬æ¢ï¼Œæ˜¯å› ä¸ºç¼–è¯‘å™¨æ˜¯æ— æ³•ç›´æ¥æ“ä½œâ€œ1+2â€è¿™æ ·çš„å­—ç¬¦ä¸²çš„ã€‚å®é™…ä¸Šï¼Œä»£ç çš„æœ¬è´¨æ ¹æœ¬å°±ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒæœ¬æ¥å°±æ˜¯ä¸€ä¸ªå…·æœ‰å¤æ‚æ‹“æ‰‘çš„æ•°æ®ç»“æ„ï¼Œå°±åƒç”µè·¯ä¸€æ ·ã€‚â€œ1+2â€è¿™ä¸ªå­—ç¬¦ä¸²åªæ˜¯å¯¹è¿™ç§æ•°æ®ç»“æ„çš„ä¸€ç§â€œç¼–ç â€ï¼Œå°±åƒZIPæˆ–è€…JPEGåªæ˜¯å¯¹å®ƒä»¬å‹ç¼©çš„æ•°æ®çš„ç¼–ç ä¸€æ ·ã€‚</p>
<p>è¿™ç§ç¼–ç å¯ä»¥æ–¹ä¾¿ä½ æŠŠä»£ç å­˜åˆ°ç£ç›˜ä¸Šï¼Œæ–¹ä¾¿ä½ ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ¥ä¿®æ”¹å®ƒä»¬ï¼Œç„¶è€Œä½ å¿…é¡»çŸ¥é“ï¼Œæ–‡æœ¬å¹¶ä¸æ˜¯ä»£ç æœ¬èº«ã€‚æ‰€ä»¥ä»ç£ç›˜è¯»å–äº†æ–‡æœ¬ä¹‹åï¼Œä½ å¿…é¡»å…ˆâ€œè§£ç â€ï¼Œæ‰èƒ½æ–¹ä¾¿åœ°æ“ä½œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸Šé¢çš„Javaä»£ç ç”Ÿæˆçš„ASTèŠ‚ç‚¹å«nodeï¼Œä½ å°±å¯ä»¥ç”¨node.operatoræ¥è®¿é—®ADDï¼Œç”¨node.leftæ¥è®¿é—®1ï¼Œnode.rightæ¥è®¿é—®2ã€‚è¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p>
<p>å¯¹äºç¨‹åºè¯­è¨€ï¼Œè¿™ç§è§£ç çš„åŠ¨ä½œå°±å«åšparsingï¼Œç”¨äºè§£ç çš„é‚£æ®µä»£ç å°±å«åšparserã€‚</p>
<h3 id="3-ä¸ºä»€ä¹ˆéœ€è¦parser"><a href="#3-ä¸ºä»€ä¹ˆéœ€è¦parser" class="headerlink" title="3 ä¸ºä»€ä¹ˆéœ€è¦parser"></a>3 ä¸ºä»€ä¹ˆéœ€è¦parser</h3><p>æ­£å¦‚ä¸Šæ–‡ä¸­ç‹å è¯´çš„ï¼Œç¨‹åºçš„è¿è¡Œå…¶å®æ˜¯åœ¨ä¸åŒçš„æ•°æ®ç»“æ„ä¹‹é—´åšè½¬æ¢ï¼Œå†™è¿‡Web applicationçš„åŒå­¦è‚¯å®šå¯¹JSONï¼ŒXMLè¿™ç±»æ•°æ®æ ¼å¼å¾ˆç†Ÿæ‚‰ï¼Œé‚£ä¹ˆä¼ è¾“è¿‡ç¨‹ä¸­ç»å¸¸æ¶‰åŠåˆ°å°†ç³»ç»Ÿä¸­çš„æŸç§æ•°æ®ç»“æ„parseråˆ°æŸç§ä¼ è¾“æ ¼å¼ä¸Šï¼ŒåŒ…æ‹¬å¾ˆå¤šæ—¶å€™ä»I/Oä¸­æå–æ•°æ®ä¹Ÿæ˜¯ä¸ªparserçš„è¿‡ç¨‹ï¼Œåªä¸è¿‡è¿™äº›parserç¡®å®æ¯”è¾ƒç®€å•ï¼Œä½†ç¡®å®æ˜¯æ—¥å¸¸ç”Ÿæ´»å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼Œè€Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å…¶å®parserå°±ä½“ç°äº†å°†ç¨‹åºä»é«˜äººç±»å¯è¯»æ€§ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²ï¼‰è½¬æ¢æˆé«˜æœºå™¨å¯è¯»æ€§ï¼ˆASTï¼‰ï¼ˆè¿™é‡Œçš„é«˜æœºå™¨å¯è¯»å’ŒVMtranslatorï¼Œæ±‡ç¼–å™¨ï¼ŒæŒ‡ä»¤é›†æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œåªæ˜¯ä¸ºäº†æè¿°é«˜åº¦ç»“æ„åŒ–çš„ASTå¯ä»¥ä½¿ä»£ç ç”Ÿæˆæ›´åŠ å®¹æ˜“ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘è¿‡ç¨‹å‹å¥½ï¼‰ï¼Œè€Œæ²¡æœ‰parserå°±æ„å‘³ç€æ‰‹å†™ASTè¿™ä¸ªè¿‡ç¨‹å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´å¹¶ä¸æ˜¯é‚£ä¹ˆç›´è§‚ï¼Œä¸è¿‡è¿™ç¡®å®å¯¹äºLispå®¶æ—ç¨‹åºå‘˜æ˜¯ä¸€ä»¶éå¸¸ç¾å¦™çš„äº‹æƒ…ï¼ŒS-Expressionä¸‡å²~</p>
<h3 id="4-å¦‚ä½•ä½¿ç”¨parser"><a href="#4-å¦‚ä½•ä½¿ç”¨parser" class="headerlink" title="4 å¦‚ä½•ä½¿ç”¨parser"></a>4 å¦‚ä½•ä½¿ç”¨parser</h3><ol>
<li>å®šä¹‰å¥½ä¸€ç»„æ–‡æ³•ï¼ˆCFGç­‰ï¼‰</li>
<li>æ„å»ºå¥½é¢„æµ‹è¡¨å¹¶é€‰æ‹©å¯¹åº”èƒ½å¤Ÿè§£æè¯¥æ–‡æ³•çš„ç®—æ³•ï¼ˆLL(1)ç­‰ï¼‰<font color="red">ã€å¯é€‰ã€‘</font>ï¼ˆå¯ä»¥ä½¿ç”¨yaccï¼ŒBisonç­‰è§£æï¼‰</li>
<li>å°†è¾“å…¥æ•°æ®è¯»å…¥paser<font color="red">ã€å¯é€‰ã€‘</font>ï¼ˆå¯ä»¥æ‰‹å†™tokenizerï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Lexç”Ÿæˆï¼‰</li>
</ol>
<p>æ­¤æ—¶å¾—åˆ°äº†å¦ä¸€ç§æ•°æ®ç»“æ„ï¼Œåœ¨ç¼–è¯‘ä¸­å¾€å¾€æ˜¯ç»“æ„åŒ–çš„ASTï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯XMLæˆ–è€…JSON,æ¥ä¸‹æ¥å°±æ˜¯åº”ç”¨è¿™ç§æ•°æ®ç»“æ„çš„äº‹äº†ã€‚</p>
<h3 id="5-parserå›¾è§£"><a href="#5-parserå›¾è§£" class="headerlink" title="5 parserå›¾è§£"></a>5 parserå›¾è§£</h3><p>ç”±ohm.jsç”Ÿæˆçš„ASTç»“æ„ï¼Œå°†1+2*3æ˜ å°„åˆ°ASTï¼Œä¾¿äºå¤§å®¶æ„Ÿæ€§ç†è§£<br><img src="/images/parser_00/example.jpg" alt=""></p>
<h3 id="6-Reference"><a href="#6-Reference" class="headerlink" title="6 Reference"></a>6 Reference</h3><p><a href="https://github.com/harc/ohm" title="ohm.js" target="_blank" rel="noopener">ohm.js</a><br><a href="https://www.quora.com/What-exactly-does-parsing-mean-in-programming" title="What-exactly-does-parsing-mean-in-programming" target="_blank" rel="noopener">What-exactly-does-parsing-mean-in-programming</a><br><a href="http://www.yinwang.org/blog-cn/2015/09/19/parser" title="ç‹å å‰è¾ˆ----å¯¹parserçš„è¯¯è§£" target="_blank" rel="noopener">ç‹å å‰è¾ˆâ€”-å¯¹parserçš„è¯¯è§£</a><br><a href="http://matt.might.net/articles/grammars-bnf-ebnf/" title="Grammar" target="_blank" rel="noopener">Grammar</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/08/27/regex-engine-00/">ä»é›¶å¼€å§‹çš„æ­£åˆ™å¼•æ“ä¹‹æ—…(é›¶)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-08-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç¼–è¯‘åŸç†/">ç¼–è¯‘åŸç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/RegexEngine/">RegexEngine</a>
			</span>
		
	</div>

	

	
		<h3 id="1-åºè¨€"><a href="#1-åºè¨€" class="headerlink" title="1 åºè¨€"></a>1 åºè¨€</h3><p>è·ç¦»æŒ–è¿™ä¸ªå‘å·²ç»è¿‡å»3ä¸ªæœˆäº†ï¼Œå—¯ï¼Œæˆ‘æ²¡è®°é”™çš„çš„è¯4ä¸ªæœˆå‰æˆ‘è¿˜æŒ–äº†ä¸€ä¸ªbrainfuckè§£é‡Šå™¨çš„å‘ï¼Œå°±ä½œä¸ºä¸‹å‘¨çš„ä½œä¸šå§~<br>åºŸè¯ä¸å¤šè¯´ï¼Œæœ¬ç³»åˆ—æ—¨åœ¨</p>
<ol>
<li>ç†è§£æŒæ¡ä¸€ä¸ªç®€å•parserçš„æ‰€ä½œæ‰€ä¸ºã€‚</li>
<li>æ¢³ç†æ­£åˆ™å¼•æ“æ„å»ºå’Œä¼˜åŒ–è¿‡ç¨‹ä¸­çš„å„ç§è¯¥ç®—æ³•</li>
<li>é€ å‡ºä¸€ä¸ªèƒ½ç”¨çš„æ­£åˆ™å¼•æ“ï¼ˆC++ï¼‰</li>
<li>å°†è¯¥æ­£åˆ™å¼•æ“ä½œä¸ºNode.jsçš„C++æ‰©å±•</li>
</ol>
<h3 id="2-é˜¶æ®µæ„å»ºå›¾"><a href="#2-é˜¶æ®µæ„å»ºå›¾" class="headerlink" title="2 é˜¶æ®µæ„å»ºå›¾"></a>2 é˜¶æ®µæ„å»ºå›¾</h3><p><img src="/images/regex_engine_00/milestone.jpg" alt=""></p>
<ol>
<li>å®ç°ä¸€ä¸ªLL(1)çš„é€’å½’ä¸‹é™parserè§£æregexæ–‡æ³•</li>
<li>å°†part1ç”Ÿæˆçš„ASTè½¬åŒ–ä¸ºNFA</li>
<li>å°†NFAè½¬åŒ–ä¸ºDFA</li>
<li>ä¼˜åŒ–DFAï¼Œæœ€å°åŒ–ç­‰</li>
<li><strong>ã€è‹±é›„éš¾åº¦å‰¯æœ¬ã€‘</strong>parseråˆ°VM codeæ‰§è¡Œ</li>
<li><strong>ã€å²è¯—éš¾åº¦å‰¯æœ¬ã€‘</strong>é‡‡ç”¨JITä¼˜åŒ–å¼•æ“<br>åä¸¤ä¸ªé˜¶æ®µæˆ‘ç°åœ¨å¹¶æ²¡æœ‰å¾ˆå¤§çš„æŠŠæ¡åšå¥½ï¼Œä½†æˆ‘ä¼šå°½åŠ›è€Œä¸ºçš„ï¼Œä¹Ÿæ¬¢è¿ç†Ÿæ‚‰è¿™ä¸€å—çš„åŒå­¦èƒ½å¤Ÿç»™äºˆæˆ‘ä¸€äº›å»ºè®®ä¸æŒ‡æ­£ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚</li>
</ol>
<h3 id="3-Reference"><a href="#3-Reference" class="headerlink" title="3 Reference"></a>3 Reference</h3><p><a href="https://swtch.com/~rsc/regexp/" title="Implementing Regular Expressions Russ Cox " target="_blank" rel="noopener">Implementing Regular Expressions Russ Cox </a><br><a href="https://github.com/miura1729/ytljit/blob/master/sample/regexp.rb" title="ytljit" target="_blank" rel="noopener">ytljit</a><br><a href="https://www.zhihu.com/question/27434493" title="å¦‚ä½•ä»é›¶å†™ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Ÿ" target="_blank" rel="noopener">å¦‚ä½•ä»é›¶å†™ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Ÿ</a><br><a href="https://en.wikipedia.org/wiki/Comparison_of_regular_expression_engines" title="Comparison of regular expression engines" target="_blank" rel="noopener">Comparison of regular expression engines</a><br><a href="https://swtch.com/~rsc/regexp/regexp1.html" title="Regular Expression Matching Can Be Simple And Fast " target="_blank" rel="noopener">Regular Expression Matching Can Be Simple And Fast </a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2018/08/27/jsys_06_summary/">è®¡ç®—çš„è¦ç´ -ç¬¬å…­ç« å°ç»“</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2018-08-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è®¡ç®—æœºä½“ç³»ç»“æ„/">è®¡ç®—æœºä½“ç³»ç»“æ„</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nand2tetris/">Nand2tetris</a>
			</span>
		
	</div>

	

	
		<p><em>Whatâ€™s in a name?That which we call a rose by any other name would smell as sweet</em></p>
<p>ç»å†äº†å‰äº”ä¸ªå°èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ç»ˆäºä»ç¡¬ä»¶è„±èº«äº†ï¼Œè¯·è®©æˆ‘æ¾ä¸€å£æ°”ï¼Œæ¯•ç«Ÿç†Ÿæ‚‰å„ç§å„æ ·çš„ç¡¬ä»¶ç»†èŠ‚å¯ä¸æ˜¯æˆ‘çš„çˆ±å¥½â€¦<br>å¥½äº†ï¼Œç°åœ¨ç¡¬ä»¶å¯¹äºæˆ‘ä»¬æ¥è¯´å°±æ˜¯ä¸€å±‚æŠ½è±¡äº†ï¼Œå·¥ç¨‹ä¸Šçš„ä¼˜åŠ¿ä½“ç°äº†å‡ºæ¥ï¼ŒæŠ½è±¡å±è”½ä½¿å¾—æˆ‘ä»¬åœ¨å†™å†…å­˜ç®¡ç†çš„æ—¶å€™ä¸ç”¨å»æ€è€ƒç”µä¿¡å·:)<br>æ¥ä¸‹æ¥æˆ‘ä¼šæ€»ç»“ä¸€äº›å…³äºç¬¬å…­ç« æ±‡ç¼–å™¨çš„çŸ¥è¯†ï¼Œç„¶åå°½åŠ›çš„é¢å¤–æ‰©å……ä¸€äº›çŸ¥è¯†ï¼Œä»¥åâ€æœ‰æ—¶é—´â€å»å¡«å‘</p>
<h3 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1 èƒŒæ™¯"></a>1 èƒŒæ™¯</h3><h4 id="1-1-æœºå™¨è¯­è¨€"><a href="#1-1-æœºå™¨è¯­è¨€" class="headerlink" title="1.1 æœºå™¨è¯­è¨€"></a>1.1 æœºå™¨è¯­è¨€</h4><p>æœºå™¨è¯­è¨€åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»ç§°ä½œç¬¦å·å‹ï¼ˆsymbolicï¼‰å’ŒäºŒè¿›åˆ¶å‹ï¼ˆbinaryï¼‰ï¼Œå½“ç„¶ç¡¬ä»¶å®é™…æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯äºŒè¿›åˆ¶å‹å·ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦ç¬¦å·å‹å‘¢ï¼Œç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸ºè®©æœºå™¨è¯»æ‡‚æŒ‡ä»¤å¾ˆå®¹æ˜“ï¼Œä½†è®©ç¨‹åºå‘˜è¯»æ‡‚äºŒè¿›åˆ¶å‹çš„æœºå™¨æŒ‡ä»¤ï¼ˆç‰¹åˆ«è¿˜ä¸æ˜¯ä»–è‡ªå·±å†™çš„ï¼‰å°±å¾ˆå›°éš¾äº†ï¼Œå¯ä»¥æƒ³è±¡å¦‚æœæœ‰æˆåƒä¸Šç™¾æ¡ä¸åŒçš„æŒ‡ä»¤ï¼Œé‚£ä¹ˆå¯¹ç›´æ¥è¯»å–äºŒè¿›åˆ¶çš„ç¨‹åºå‘˜æ¥è¯´æƒ³å¿…å¹¶ä¸èˆ’æœã€‚æ­¤æ—¶ï¼Œé’ˆå¯¹ç¡¬ä»¶å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æœºå™¨è¯­è¨€çš„æŠ½è±¡äº§ç”Ÿäº†ï¼Œè¯´æ˜¯æŠ½è±¡å…¶å®æ˜¯å¢åŠ äº†å¯è¯»æ€§ï¼Œæ­¤æ—¶å¯ä»¥ç”¨Loadä»£è¡¨10000000ï¼ˆå‡å®šæŒ‡ä»¤é•¿åº¦8ä½ï¼‰çš„å‰5ä½ï¼Œè¿™ç§ç­‰æ•ˆæ›¿æ¢ä¹Ÿå‡ºç°åœ¨äº†marcoï¼Œå„ç§è®¾è®¡æ¨¡å¼ä¸­ï¼Œæœ¬è´¨æ˜¯å¯¹å¯è¯»æ€§çš„è€ƒè™‘ã€‚</p>
<h4 id="1-2-ç¬¦å·è§£æ"><a href="#1-2-ç¬¦å·è§£æ" class="headerlink" title="1.2 ç¬¦å·è§£æ"></a>1.2 ç¬¦å·è§£æ</h4><p>åˆ©ç”¨ç¬¦å·è¡¨è¿›è¡Œç¬¦å·è§£æ</p>
<h4 id="1-3-æ±‡ç¼–ç¼–è¯‘å™¨"><a href="#1-3-æ±‡ç¼–ç¼–è¯‘å™¨" class="headerlink" title="1.3 æ±‡ç¼–ç¼–è¯‘å™¨"></a>1.3 æ±‡ç¼–ç¼–è¯‘å™¨</h4><p>æ±‡ç¼–ç¼–è¯‘å™¨çš„è¾“å…¥æ˜¯ä¸€ä¸²æ±‡ç¼–å‘½ä»¤ï¼Œç„¶åäº§ç”Ÿä¸€ä¸²ç­‰ä»·çš„äºŒè¿›åˆ¶æŒ‡ä»¤ä½œä¸ºè¾“å‡ºã€‚ç”Ÿæˆçš„ä»£ç è¢«åŠ è½½åˆ°è®¡ç®—æœºçš„å†…å­˜ä¸­ç„¶åè¢«ç¡¬ä»¶æ‰§è¡Œã€‚<font color="blue">å¯è§ï¼Œæ±‡ç¼–ç¼–è¯‘å™¨ä¸»è¦æ˜¯ä¸ªæ–‡æœ¬å¤„ç†ç¨‹åºï¼Œè®¾è®¡ç›®çš„æ˜¯ç”¨æ¥æä¾›ç¿»è¯‘æœåŠ¡ã€‚</font>ç¼–å†™æ±‡ç¼–ç¼–è¯‘å™¨çš„ç¨‹åºå‘˜å¿…é¡»æœ‰å®Œæ•´çš„æ±‡ç¼–è¯­æ³•è¯´æ˜æ–‡æ¡£å’Œç›¸åº”çš„äºŒè¿›åˆ¶ä»£ç ã€‚æœ‰äº†è¿™æ ·çš„çº¦å®šï¼ˆé€šå¸¸ç§°ä¸ºæœºå™¨è¯­è¨€è§„èŒƒï¼‰ï¼Œå°±ä¸éš¾ç¼–å†™ç¨‹åºï¼Œè®©å…¶å¯¹æ¯ä¸ªç¬¦å·å‘½ä»¤æ‰§è¡Œä¸‹é¢çš„ä»»åŠ¡ï¼ˆé¡ºåºæ— å…³ï¼‰</p>
<ul>
<li>è§£æå‡ºç¬¦å·å‘½ä»¤å†…åœ¨çš„åŸŸ</li>
<li>å¯¹æ¯ä¸ªåŸŸï¼Œäº§ç”Ÿæœºå™¨è¯­è¨€ä¸­ç›¸åº”çš„ä½åŸŸ</li>
<li>ç”¨å†…å­˜å•å…ƒçš„æ•°å­—åœ°å€æ¥æ›¿æ¢æ‰€æœ‰çš„ç¬¦å·å¼•ç”¨</li>
<li>å°†äºŒè¿›åˆ¶ç æ±‡ç¼–æˆå®Œæ•´çš„æœºå™¨æŒ‡ä»¤</li>
</ul>
<h3 id="2-æŒ‡ä»¤"><a href="#2-æŒ‡ä»¤" class="headerlink" title="2 æŒ‡ä»¤"></a>2 æŒ‡ä»¤</h3><p>Hackçš„æŒ‡ä»¤é›†æ¯”è¾ƒIA-32çš„æŒ‡ä»¤å¯ä»¥è¯´æ˜¯å¾ˆç®€å•äº†ï¼Œhackçš„æŒ‡ä»¤åˆ†ä¸ºå¯»å€æŒ‡ä»¤ï¼ˆA-æŒ‡ä»¤ï¼ŒAddressing Instructionï¼‰å’Œè®¡ç®—æŒ‡ä»¤ï¼ˆC-æŒ‡ä»¤ï¼ŒComput Instructionï¼‰<br><img src="/images/jsys_06/instruction.jpg" alt=""><br>AæŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†valueè¯»å…¥Aå¯„å­˜å™¨ï¼Œæ¯”å¦‚ä½ è¦è®¿é—®å†…å­˜åœ°å€ä¸º12çš„å€¼ï¼Œæ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>@12 // å°†12è¿™ä¸ªåœ°å€å€¼è¯»å…¥Aå¯„å­˜å™¨</li>
<li>M     // Mçš„é»˜è®¤è¡Œä¸ºæ˜¯å°†Aå¯„å­˜å™¨ä¸­çš„å€¼ä½œä¸ºåœ°å€è®¿é—®è¯¥åœ°å€å­˜å‚¨çš„å€¼<br><img src="/images/jsys_06/memory.jpg" alt=""></li>
</ol>
<h3 id="3-ç¬¦å·å®šä¹‰"><a href="#3-ç¬¦å·å®šä¹‰" class="headerlink" title="3 ç¬¦å·å®šä¹‰"></a>3 ç¬¦å·å®šä¹‰</h3><p>ç¬¦å·åˆ†ä¸º3ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<h4 id="3-1-é¢„å®šä¹‰ç¬¦å·"><a href="#3-1-é¢„å®šä¹‰ç¬¦å·" class="headerlink" title="3.1 é¢„å®šä¹‰ç¬¦å·"></a>3.1 é¢„å®šä¹‰ç¬¦å·</h4><p>é¢„å®šä¹‰ç¬¦å·æŒ‡ä»£çš„æ˜¯å¯¹åº”çš„ç¬¦å·åœ¨æ•°æ®å†…å­˜ä¸­çš„ä½ç½®ï¼ˆRAMï¼‰<br><img src="/images/jsys_06/preDefine.jpg" alt=""></p>
<h4 id="3-2-æ ‡ç­¾ç¬¦å·"><a href="#3-2-æ ‡ç­¾ç¬¦å·" class="headerlink" title="3.2 æ ‡ç­¾ç¬¦å·"></a>3.2 æ ‡ç­¾ç¬¦å·</h4><p>æ ‡ç­¾ç¬¦å·ä¸­ç¬¦å·å¯¹åº”çš„æ˜¯æŒ‡ä»¤å†…å­˜ä¸­çš„ä½ç½®ï¼ˆROMï¼‰ï¼Œä¸”æ¯ä¸ªæ ‡ç­¾åªèƒ½è¢«å®šä¹‰ä¸€æ¬¡ï¼Œå¯ä»¥åœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ŒåŒ…æ‹¬åœ¨å®šä¹‰ä½ç½®ä¹‹å‰ï¼Œè¿™è®©æˆ‘è”æƒ³åˆ°äº†JSçš„é¢„å®šä¹‰ï¼Œä¼°è®¡ä¹Ÿæ˜¯å…ˆæ‰«äº†ä¸€éç¬¦å·è¡¨ï¼Œè¿™é‡Œçš„ç¬¦å·è¡¨å’Œç¼–è¯‘å™¨å‰ç«¯parserçš„ç¬¦å·è¡¨ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œè™½ç„¶éƒ½æ˜¯å¯¹ç¬¦å·çš„æŸç§æ˜ å°„ï¼Œä½†æ±‡ç¼–å™¨çš„ç¬¦å·è¡¨æ›´åŠ åº•å±‚ï¼Œå®ƒå°†ç¬¦å·æ˜ å°„åˆ°åœ°å€ï¼Œè€Œparserçš„ç¬¦å·è¡¨æ˜¯ä¸€ç§ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè¿™ä¸ªåœ¨åé¢æ€»ç»“parserçš„æ—¶å€™ä¼šå†æåˆ°ã€‚</p>
<p>æ ‡ç­¾ç¬¦å·ä¾‹å­ï¼š<br>(LOOP) å®ƒçš„ä½œç”¨ä»…ä»…æ˜¯æ›´æ–°ç¬¦å·è¡¨ï¼Œå…¶å€¼ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œè¿™ä¸ªåœ¨x86_64çš„åæ±‡ç¼–ä¹ŸåŒæ ·ï¼Œå¯ä»¥çœ‹åˆ°æ ‡ç­¾è¯­å¥æ˜¯æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å€¼çš„</p>
<h4 id="3-3-å˜é‡ç¬¦å·"><a href="#3-3-å˜é‡ç¬¦å·" class="headerlink" title="3.3 å˜é‡ç¬¦å·"></a>3.3 å˜é‡ç¬¦å·</h4><p>ä»»ä½•å‡ºç°åœ¨æ±‡ç¼–ç¨‹åºä¸­çš„ç¬¦å·Xxxï¼Œä¸æ˜¯é¢„å®šä¹‰ç¬¦å·æˆ–æ ‡ç­¾ç¬¦å·ï¼Œå°±å°†ä»–ä½œä¸ºå˜é‡ç¬¦å·å¤„ç†ï¼Œå˜é‡ç¬¦å·çš„åœ°å€é»˜è®¤ä»RAM[16]å¼€å§‹é€ä¸€åˆ†é…,æ˜¯çš„ä½ æ²¡çœ‹é”™ï¼Œé€ä¸€åˆ†é…æ„å‘³ç€åœ¨ä¸€ä¸ªç¨‹åºä¸­å·²ç»åºŸå¼ƒçš„å˜é‡ä¹Ÿä¼šæ°¸ä¹…æŒæœ‰å†…å­˜ï¼Œåœ¨ç¬¬13ç« æˆ‘ä¼šå°è¯•ç”¨GCæ¥è§£å†³éƒ¨åˆ†å †å†…å­˜é—®é¢˜ï¼Œä½†è¿™é‡Œçš„åˆ†é…é—®é¢˜åº”è¯¥æ˜¯æŒ‡ä»¤é›†å±‚é¢çš„è€ƒé‡æ‰€ä»¥é™¤éä¿®æ”¹åˆ†é…ç­–ç•¥å¦åˆ™æ— è§£ã€‚</p>
<p>å˜é‡ä¾‹å­ï¼š<br>@i è¿™é‡Œçš„iå¯ä»¥ä»£è¡¨å¾ªç¯å˜é‡ï¼Œé»˜è®¤å˜é‡ä»RAMåœ°å€16å¤„å¼€å§‹åˆ†é…</p>
<h3 id="4-Q-amp-A"><a href="#4-Q-amp-A" class="headerlink" title="4 Q&amp;A"></a>4 Q&amp;A</h3><ul>
<li><p><font color="red">Qï¼šå¦‚ä½•å®Œæˆäº¤å‰æ±‡ç¼–ç¨‹åºä»¥åŠç”Ÿæˆçš„ä»£ç å¦‚ä½•è¯»å–.asmçš„æ–‡æœ¬è¾“å…¥ä»¥åŠå¦‚ä½•ç»´æŠ¤å…¶ç¬¦å·è¡¨?</font><br><strong>Aï¼šè¿™äº›åœ¨è¿™é—¨è¯¾éƒ½æ²¡æœ‰æ¶‰åŠï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å­¦ä¹ <a href="http://www.davidsalomon.name/assem.advertis/AssemAd.html" title="Assemblers And Loaders." target="_blank" rel="noopener">Assemblers And Loaders.</a></strong></p>
</li>
<li><p><font color="red">Qï¼šå®é™…è®¡ç®—æœºä¸­çš„æ±‡ç¼–ç¨‹åºå¦‚ä½•å·¥ä½œï¼Ÿæˆ‘ç¡®ä¿¡å®ƒä¸ä¼šä½¿ç”¨é«˜çº§è¯­è¨€å°†.asmæ–‡ä»¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶â€¦â€¦å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿä½¿ç”¨æœºå™¨ä»£ç æœ¬èº«ï¼Ÿ</font><br><strong>A1ï¼š40å¹´å‰ï¼Œè®¸å¤šå¤§å‹è®¡ç®—æœºç¨‹åºä»ç„¶ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œå› ä¸ºæ¯ä¸ªå­—èŠ‚éƒ½è®¡ç®—åœ¨å†…ã€‚ä¾‹å¦‚ï¼ŒIBM 370å‹å·145æ˜¯IBMçš„ç¬¬ä¸€å°å¸¦æœ‰åŠå¯¼ä½“å†…å­˜çš„å¤§å‹æœºï¼Œå®ƒçš„æœ€å¤§é…ç½®ä¸º512 åƒå­—èŠ‚RAMã€‚åŸºæœ¬é…ç½®ä»…ä¸º112 KBã€‚å­˜å‚¨å™¨å‘¨æœŸé€Ÿç‡çº¦ä¸º3 MHzã€‚ éšç€å†…å­˜è¶Šæ¥è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å†æ‹…å¿ƒç¨‹åºçš„å¤§å°ï¼Œè€Œæ˜¯ä½¿ç”¨æ›´é«˜çº§åˆ«çš„è¯­è¨€æ¥ä½¿ç¼–ç¨‹æ›´å¿«ï¼Œæ›´ä¸å®¹æ˜“å‡ºé”™ã€‚ ç°ä»£è®¡ç®—æœºçš„è£…é…å·¥å‡ ä¹è‚¯å®šæ˜¯ç”¨é«˜çº§è¯­è¨€ç¼–å†™çš„ï¼Œå¾ˆå¯èƒ½æ˜¯â€™Câ€™ã€‚ä¾‹å¦‚ï¼Œå‚è§<a href="http://en.wikipedia.org/wiki/GNU_Assemblerã€‚" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/GNU_Assemblerã€‚</a> </strong><br><strong>A2ï¼šä¸ä»»ä½•å…¶ä»–ç§‘å­¦é¢†åŸŸä¸€æ ·ï¼Œè®¡ç®—æœºç§‘å­¦é¢†åŸŸç”±ä¼—å¤šç§‘å­¦å®¶å’Œç ”ç©¶è€…å»ºé€ ï¼Œæ¯ä¸ªç§‘å­¦å®¶å’Œç ”ç©¶è€…éƒ½è´¡çŒ®äº†ä¸€å°éƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œæœ‰å¾ˆå¤šè‹±é›„ã€‚ æ¯ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ— è®ºæ˜¯ä½çº§æ±‡ç¼–è¯­è¨€è¿˜æ˜¯é«˜çº§ç°ä»£è¯­è¨€ï¼Œéƒ½æ˜¯ä¸€ç§æŠ½è±¡ã€‚æŠ½è±¡æ˜¯ç”±è¯­è¨€è®¾è®¡å¸ˆåˆ›é€ çš„ï¼Œä»–ä»¬æ˜¯ä¸€äº›æœ‰æƒ³æ³•çš„äººã€‚<br>ä¸ºäº†å®ç°æŠ½è±¡ï¼Œå³å°†è¯­è¨€ä»æ­£å¼è§„èŒƒè½¬æ¢ä¸ºå®ç”¨å·¥å…·ï¼Œæ‚¨å¿…é¡»èƒ½å¤Ÿå°†ç”¨è¯¥è¯­è¨€ç¼–å†™çš„ç¨‹åºç¿»è¯‘æˆæˆ‘ä»¬å·²ç»çŸ¥é“è¦æ‰§è¡Œçš„å¦ä¸€ç§è¯­è¨€ã€‚æ ¹æ®æˆ‘ä»¬å¸Œæœ›ç¿»è¯‘çš„è¯­è¨€çš„æŠ½è±¡çº§åˆ«ï¼Œæ­¤ç¿»è¯‘ä»£ç†ç§°ä¸ºâ€œç¼–è¯‘å™¨â€ï¼Œâ€œVMç¿»è¯‘å™¨â€ï¼Œâ€œæ±‡ç¼–ç¨‹åºâ€ç­‰ã€‚æ— è®ºåç§°å¦‚ä½•ï¼Œå®ƒæ€»æ˜¯ç¿»è¯‘ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆä¾‹å¦‚åŒ…å«Cä»£ç ï¼‰åˆ°å¦ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆä¾‹å¦‚åŒ…å«æ±‡ç¼–ä»£ç ï¼‰ã€‚å› ä¸ºè¿™ä¸ªç¿»è¯‘å™¨æœ¬è´¨ä¸Šæ˜¯éå¸¸ç²¾ç¾çš„æ–‡æœ¬å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨ä½ é€‰æ‹©çš„ä»»ä½•è¯­è¨€ç¼–å†™ã€‚<br>å°½ç®¡ç¬¬ä¸€ä¸ªæ±‡ç¼–ç¨‹åºæ˜¯ç”¨æœºå™¨è¯­è¨€ç¼–å†™çš„ï¼Œä½†ä½ æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯ä¸€æ—¦å®ç°äº†ç¬¬ä¸€æ­¥ï¼Œç”Ÿæˆçš„æ±‡ç¼–ç¨‹åºå°±å¯ä»¥ç”¨æ¥ç¿»è¯‘ç¬¦å·ç¨‹åºï¼Œæ‰€ä»¥ä»é‚£æ—¶èµ·å°±ä¸å†éœ€è¦ç”¨äºŒè¿›åˆ¶ä»£ç ç¼–å†™ä»£ç äº†ã€‚å‰©ä¸‹çš„å°±æ˜¯å†å²â€¦â€¦â€œæ™ºèƒ½æ˜¯åˆ¶é€ äººé€ ç‰©å“çš„èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯åˆ¶é€ å·¥å…·çš„å·¥å…·ã€‚â€ ï¼ˆHenry Bergsonï¼Œ1859-1941ï¼‰</strong></p>
</li>
<li><p><font color="red">Qï¼šå¦‚æœå®é™…è®¡ç®—æœºä¸­çš„æ±‡ç¼–ç¨‹åºæœ¬èº«æ˜¯ç”¨æœºå™¨ä»£ç ç¼–å†™çš„ï¼Œé‚£ä¹ˆæˆ‘æ˜¯å¦å¯ä»¥ä½¿ç”¨hackæ±‡ç¼–è¯­è¨€æœ¬èº«å®ç°â€œé¡¹ç›®6â€ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨é«˜çº§è¯­è¨€ï¼Ÿ</font><br><strong>Aï¼šä½¿ç”¨Hackæ±‡ç¼–è¯­è¨€ç¼–å†™æ±‡ç¼–ç¨‹åºçš„é™åˆ¶å› ç´ æ˜¯è®¡ç®—æœºæ¨¡æ‹Ÿå™¨æ²¡æœ‰I / Oå·¥å…·æ¥è®¿é—®ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚ï¼ˆä½†å„ç§é«˜çº§è¯­è¨€æœ‰I/Oåº“ï¼‰å¯¹äºé¡¹ç›®6ï¼Œæ‚¨éœ€è¦å¤„ç†å­˜å‚¨åœ¨è®¡ç®—æœºä¸Šçš„.ASMæ–‡ä»¶ï¼Œå¹¶ç¼–å†™å°†åŠ è½½åˆ°æ¨¡æ‹Ÿå™¨ä¸­çš„.HACKæ–‡ä»¶ã€‚ </strong></p>
</li>
<li><p><font color="red">Qï¼šæˆ‘ç†è§£æ¶æ„ä»¥åŠROMä¸­çš„äºŒè¿›åˆ¶å€¼å¦‚ä½•å·¥ä½œï¼Œä½†æˆ‘ä¸çŸ¥é“æˆ‘ä»¬å¦‚ä½•ä»å…·æœ‰æœºå™¨ä»£ç ï¼ˆ.hackï¼‰çš„æ–‡æœ¬æ–‡ä»¶è½¬åˆ°ROMä¸­çš„å®é™…äºŒè¿›åˆ¶å€¼ã€‚ å› ä¸ºå®ƒæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œæ‰€ä»¥æ¯ä¸ªâ€œ1â€å’Œâ€œ0â€éƒ½æ˜¯ASCIIå­—ç¬¦ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä»ç¡¬ä»¶ä¸Šçš„ASCIIè½¬æ¢ä¸ºçœŸæ­£çš„äºŒè¿›åˆ¶å€¼ï¼Ÿ</font><br><strong>Aï¼šå°†æ±‡ç¼–ç¨‹åºçš„è¾“å‡ºè§†ä¸ºå¦ä¸€ç§ä¸­é—´â€œè¯­è¨€â€ã€‚è¿˜æœ‰å¦ä¸€ç§å·¥å…·å¯ä»¥è¯»å–è¯¥è¯­è¨€å¹¶å°†å…¶åŠ è½½åˆ°å¯ä»¥æ‰§è¡Œè¯¥è¯­è¨€çš„è®¡ç®—æœºä¸­ã€‚<br>åœ¨åƒPCè¿™æ ·çš„é€šç”¨è®¡ç®—æœºä¸­ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ç”±ç§°ä¸ºåŠ è½½å™¨çš„æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†åŠ è½½åˆ°å­˜å‚¨å™¨ä¸­ã€‚åœ¨åŸºäºROMçš„è®¡ç®—æœºä¸­ï¼Œä½¿ç”¨ç§°ä¸ºROMç¼–ç¨‹å™¨çš„ç¡¬ä»¶å·¥å…·æ¥ç¼–å†™ROMã€‚<br>Hack CPU Emulatorä¸Šçš„â€œåŠ è½½ç¨‹åºâ€å‘½ä»¤æ˜¯æ¨¡æ‹ŸROM programmerã€‚<br>æ±‡ç¼–å™¨è¾“å‡ºå’Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹é—´çš„è½¯ä»¶é“¾ä¸­é€šå¸¸è¿˜æœ‰å¦ä¸€ä¸ªæ­¥éª¤ã€‚ä¸€ä¸ªè¿æ¥å™¨  ç»“åˆäº†å¤šä¸ªæ±‡ç¼–ç›®æ ‡æ–‡ä»¶  å’Œåº“ åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸ºäº†æ”¯æŒé“¾æ¥ï¼Œç›®æ ‡æ–‡ä»¶åŒ…å«é¢å¤–çš„ä¿¡æ¯ï¼Œå‘Šè¯‰ä»–ä»¬éœ€è¦å“ªäº›å¤–éƒ¨å‡½æ•°ä»¥åŠå¤–éƒ¨å‡½æ•°å¯ä»¥è°ƒç”¨çš„å‡½æ•°ã€‚ </strong></p>
</li>
</ul>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/3">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2021 Jason | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
